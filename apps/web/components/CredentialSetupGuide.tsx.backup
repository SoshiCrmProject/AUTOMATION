import { useState } from "react";
import { useRouter } from "next/router";

interface Step {
  number: number;
  title: { en: string; ja: string };
  description: { en: string; ja: string };
  details: { en: string[]; ja: string[] };
  image?: string;
  link?: { text: { en: string; ja: string }; url: string };
}

interface Props {
  platform: "shopee" | "amazon";
}

const SHOPEE_STEPS: Step[] = [
  {
    number: 1,
    title: { 
      en: "Register on Shopee Open Platform",
      ja: "Shopee Open Platformã«ç™»éŒ²"
    },
    description: { 
      en: "Create your developer account to access the API",
      ja: "APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®é–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ"
    },
    details: {
      en: [
        "Go to https://open.shopee.com/",
        "Click 'Sign Up' in the top right corner",
        "Use your Shopee seller account email",
        "Verify your email address",
        "Complete the registration form"
      ],
      ja: [
        "https://open.shopee.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹",
        "å³ä¸Šã®ã€Œã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã€ã‚’ã‚¯ãƒªãƒƒã‚¯",
        "Shopeeã‚»ãƒ©ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨",
        "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª",
        "ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Œæˆ"
      ]
    },
    link: { 
      text: { en: "Visit Shopee Open Platform", ja: "Shopee Open Platformã«ã‚¢ã‚¯ã‚»ã‚¹" },
      url: "https://open.shopee.com/" 
    }
  },
  {
    number: 2,
    title: { 
      en: "Create a New App",
      ja: "æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚’ä½œæˆ"
    },
    description: { 
      en: "Set up your application to get API credentials",
      ja: "APIèªè¨¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®š"
    },
    details: {
      en: [
        "Log in to Shopee Open Platform",
        "Go to 'My Apps' section",
        "Click 'Create App' button",
        "Enter your app name (e.g., 'AutoShip X Integration')",
        "Select 'Order Management' permissions",
        "Submit and wait for approval (usually instant)"
      ],
      ja: [
        "Shopee Open Platformã«ãƒ­ã‚°ã‚¤ãƒ³",
        "ã€Œãƒã‚¤ã‚¢ãƒ—ãƒªã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•",
        "ã€Œã‚¢ãƒ—ãƒªã‚’ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯",
        "ã‚¢ãƒ—ãƒªåã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã€ŒAutoShip X Integrationã€ï¼‰",
        "ã€Œæ³¨æ–‡ç®¡ç†ã€æ¨©é™ã‚’é¸æŠ",
        "é€ä¿¡ã—ã¦æ‰¿èªã‚’å¾…ã¤ï¼ˆé€šå¸¸ã¯å³æ™‚ï¼‰"
      ]
    }
  },
  {
    number: 3,
    title: { 
      en: "Get Partner ID & Partner Key",
      ja: "Partner IDã¨Partner Keyã‚’å–å¾—"
    },
    description: { 
      en: "Copy these credentials from your app settings",
      ja: "ã‚¢ãƒ—ãƒªè¨­å®šã‹ã‚‰ã“ã‚Œã‚‰ã®èªè¨¼æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼"
    },
    details: {
      en: [
        "Open your newly created app",
        "Find 'App Credentials' section",
        "Copy the Partner ID (numeric, e.g., 1234567)",
        "Click 'Show' on Partner Key and copy it",
        "âš ï¸ Keep Partner Key secret - never share it!",
        "Store both values securely"
      ],
      ja: [
        "æ–°ã—ãä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚’é–‹ã",
        "ã€Œã‚¢ãƒ—ãƒªèªè¨¼æƒ…å ±ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹",
        "Partner IDï¼ˆæ•°å­—ã€ä¾‹ï¼š1234567ï¼‰ã‚’ã‚³ãƒ”ãƒ¼",
        "Partner Keyã®ã€Œè¡¨ç¤ºã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ”ãƒ¼",
        "âš ï¸ Partner Keyã¯ç§˜å¯†ã«ä¿ã¤ - æ±ºã—ã¦å…±æœ‰ã—ãªã„ï¼",
        "ä¸¡æ–¹ã®å€¤ã‚’å®‰å…¨ã«ä¿å­˜"
      ]
    }
  },
  {
    number: 4,
    title: { 
      en: "Get Shop ID",
      ja: "Shop IDã‚’å–å¾—"
    },
    description: { 
      en: "Find your shop's unique identifier",
      ja: "ã‚·ãƒ§ãƒƒãƒ—ã®ä¸€æ„ã®è­˜åˆ¥å­ã‚’è¦‹ã¤ã‘ã‚‹"
    },
    details: {
      en: [
        "Go to Shopee Seller Center",
        "Click on 'Settings' or 'Shop Settings'",
        "Look for 'Shop ID' (usually in URL or shop info)",
        "Alternative: Use Shopee API test endpoint to get shop list",
        "Copy the numeric Shop ID (e.g., 987654)",
        "Each shop has a unique ID"
      ],
      ja: [
        "Shopeeã‚»ãƒ©ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼ã«ç§»å‹•",
        "ã€Œè¨­å®šã€ã¾ãŸã¯ã€Œã‚·ãƒ§ãƒƒãƒ—è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯",
        "ã€ŒShop IDã€ã‚’æ¢ã™ï¼ˆé€šå¸¸ã¯URLã¾ãŸã¯ã‚·ãƒ§ãƒƒãƒ—æƒ…å ±å†…ï¼‰",
        "ä»£æ›¿æ–¹æ³•ï¼šShopee APIãƒ†ã‚¹ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚·ãƒ§ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚’å–å¾—",
        "æ•°å€¤ã®Shop IDï¼ˆä¾‹ï¼š987654ï¼‰ã‚’ã‚³ãƒ”ãƒ¼",
        "å„ã‚·ãƒ§ãƒƒãƒ—ã«ã¯ä¸€æ„ã®IDãŒã‚ã‚Šã¾ã™"
      ]
    }
  },
  {
    number: 5,
    title: { 
      en: "OAuth Authorization (Optional)",
      ja: "OAuthèªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
    },
    description: { 
      en: "Get Access Token for advanced features",
      ja: "é«˜åº¦ãªæ©Ÿèƒ½ã®ãŸã‚ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—"
    },
    details: {
      en: [
        "Generate authorization URL with your Partner ID",
        "Authorize the app in Shopee as the shop owner",
        "Receive authorization code",
        "Exchange code for Access Token via API",
        "Access Token expires - set up refresh flow",
        "Note: Some features work without Access Token"
      ],
      ja: [
        "Partner IDã§èªè¨¼URLã‚’ç”Ÿæˆ",
        "ã‚·ãƒ§ãƒƒãƒ—ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦Shopeeã§ã‚¢ãƒ—ãƒªã‚’èªè¨¼",
        "èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å—ä¿¡",
        "APIçµŒç”±ã§ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨äº¤æ›",
        "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯æœŸé™åˆ‡ã‚Œ - æ›´æ–°ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®š",
        "æ³¨ï¼šä¸€éƒ¨ã®æ©Ÿèƒ½ã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§å‹•ä½œ"
      ]
    }
  },
  {
    number: 6,
    title: { 
      en: "Enter Credentials in Settings",
      ja: "è¨­å®šã«èªè¨¼æƒ…å ±ã‚’å…¥åŠ›"
    },
    description: { 
      en: "Save your credentials in AutoShip X",
      ja: "AutoShip Xã«èªè¨¼æƒ…å ±ã‚’ä¿å­˜"
    },
    details: {
      en: [
        "Go to Settings page in AutoShip X",
        "Select 'Shopee' tab",
        "Enter Partner ID (numeric only)",
        "Enter Partner Key (copy/paste carefully)",
        "Enter Shop ID (numeric only)",
        "Click 'Save Shopee Credentials (Encrypted)'",
        "Test connection using the 'Test Connection' button"
      ],
      ja: [
        "AutoShip Xã®è¨­å®šãƒšãƒ¼ã‚¸ã«ç§»å‹•",
        "ã€ŒShopeeã€ã‚¿ãƒ–ã‚’é¸æŠ",
        "Partner IDï¼ˆæ•°å­—ã®ã¿ï¼‰ã‚’å…¥åŠ›",
        "Partner Keyï¼ˆæ…é‡ã«ã‚³ãƒ”ãƒ¼/è²¼ã‚Šä»˜ã‘ï¼‰ã‚’å…¥åŠ›",
        "Shop IDï¼ˆæ•°å­—ã®ã¿ï¼‰ã‚’å…¥åŠ›",
        "ã€ŒShopeeèªè¨¼æƒ…å ±ã‚’ä¿å­˜ï¼ˆæš—å·åŒ–ï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯",
        "ã€Œæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ"
      ]
    }
  }
];

const AMAZON_STEPS: Step[] = [
  {
    number: 1,
    title: "Prepare Your Amazon Seller Account",
    description: "Ensure your account is active and accessible",
    details: [
      "Have an active Amazon Seller Central account",
      "Know your login email/phone number",
      "Know your account password",
      "Disable 2FA temporarily (or use app-based 2FA)",
      "Ensure you have a payment method saved",
      "Add a default shipping address"
    ]
  },
  {
    number: 2,
    title: "Set Up Default Shipping Address",
    description: "Configure where orders will be shipped",
    details: [
      "Log in to Amazon Seller Central or Amazon.com",
      "Go to 'Your Addresses'",
      "Add or select your dropship warehouse address",
      "Make it the default shipping address",
      "Verify the address is complete and correct",
      "Save changes"
    ]
  },
  {
    number: 3,
    title: "Save Payment Method",
    description: "Ensure automatic checkout works smoothly",
    details: [
      "Go to 'Payment Options' in Amazon",
      "Add a valid credit/debit card",
      "Or link your bank account",
      "Make it the default payment method",
      "Verify the payment method is active",
      "Ensure sufficient credit/balance"
    ]
  },
  {
    number: 4,
    title: "Enter Credentials in AutoShip X",
    description: "Securely store your Amazon login",
    details: [
      "Go to Settings page in AutoShip X",
      "Select 'Amazon' tab",
      "Enter your Amazon email or phone number",
      "Enter your Amazon password",
      "âš ï¸ Credentials are encrypted with AES-256-GCM",
      "We NEVER share credentials with third parties",
      "Click 'Save Amazon Credentials'"
    ]
  },
  {
    number: 5,
    title: "How Automation Works",
    description: "Understanding the Playwright automation",
    details: [
      "We use Playwright (headless browser)",
      "System logs in with your credentials",
      "Searches for the mapped Amazon product",
      "Adds item to cart automatically",
      "Proceeds to checkout",
      "Completes purchase with saved payment/address",
      "No Amazon API used - pure browser automation"
    ]
  },
  {
    number: 6,
    title: "Security & Best Practices",
    description: "Keep your account safe",
    details: [
      "Enable app-based 2FA (Google Authenticator)",
      "Monitor Amazon purchase notifications",
      "Check Dashboard and Orders page regularly",
      "Use dry-run mode to test before going live",
      "Set profit thresholds to avoid losses",
      "Review manual review queue daily",
      "Report any suspicious activity immediately"
    ]
  }
];

export default function CredentialSetupGuide({ platform }: Props) {
  const [expandedStep, setExpandedStep] = useState<number | null>(null);
  const steps = platform === "shopee" ? SHOPEE_STEPS : AMAZON_STEPS;
  const [showGuide, setShowGuide] = useState(false);

  return (
    <>
      {/* Trigger Button */}
      <button
        onClick={() => setShowGuide(true)}
        style={{
          marginTop: 12,
          width: "100%",
          padding: "12px 16px",
          background: "var(--color-info-bg)",
          color: "var(--color-info)",
          border: "2px solid var(--color-info)",
          borderRadius: "var(--radius-md)",
          fontSize: 14,
          fontWeight: 600,
          cursor: "pointer",
          transition: "all 0.2s ease",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 8
        }}
      >
        ğŸ“– How to Get {platform === "shopee" ? "Shopee" : "Amazon"} Credentials (Step-by-Step Guide)
      </button>

      {/* Full Guide Modal */}
      {showGuide && (
        <>
          {/* Backdrop */}
          <div
            style={{
              position: "fixed",
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: "rgba(0, 0, 0, 0.5)",
              backdropFilter: "blur(8px)",
              zIndex: 9998,
              animation: "fadeIn 0.3s ease"
            }}
            onClick={() => setShowGuide(false)}
          />

          {/* Modal */}
          <div
            style={{
              position: "fixed",
              top: "50%",
              left: "50%",
              transform: "translate(-50%, -50%)",
              background: "white",
              borderRadius: "var(--radius-lg)",
              boxShadow: "var(--shadow-xl)",
              maxWidth: 800,
              width: "90%",
              maxHeight: "90vh",
              overflow: "hidden",
              zIndex: 9999,
              animation: "slideUp 0.3s ease",
              display: "flex",
              flexDirection: "column"
            }}
          >
            {/* Header */}
            <div style={{
              padding: 24,
              borderBottom: "2px solid var(--color-border)",
              background: "linear-gradient(135deg, var(--color-primary), var(--color-secondary))",
              color: "white"
            }}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                <div>
                  <h2 style={{ margin: 0, fontSize: 24, fontWeight: 800 }}>
                    {platform === "shopee" ? "ğŸ›ï¸ Shopee" : "ğŸ“¦ Amazon"} Credential Setup Guide
                  </h2>
                  <p style={{ margin: "8px 0 0 0", fontSize: 14, opacity: 0.9 }}>
                    Follow these {steps.length} simple steps to get your credentials
                  </p>
                </div>
                <button
                  onClick={() => setShowGuide(false)}
                  style={{
                    background: "rgba(255, 255, 255, 0.2)",
                    border: "2px solid white",
                    borderRadius: "var(--radius-full)",
                    width: 40,
                    height: 40,
                    fontSize: 24,
                    cursor: "pointer",
                    color: "white",
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    fontWeight: 700
                  }}
                  aria-label="Close"
                >
                  Ã—
                </button>
              </div>
            </div>

            {/* Steps Content - Scrollable */}
            <div style={{
              flex: 1,
              overflowY: "auto",
              padding: 24
            }}>
              {steps.map((step) => {
                const isExpanded = expandedStep === step.number;
                return (
                  <div
                    key={step.number}
                    style={{
                      marginBottom: 16,
                      border: "2px solid var(--color-border)",
                      borderRadius: "var(--radius-lg)",
                      overflow: "hidden",
                      transition: "all 0.3s ease"
                    }}
                  >
                    {/* Step Header */}
                    <div
                      onClick={() => setExpandedStep(isExpanded ? null : step.number)}
                      style={{
                        padding: 16,
                        background: isExpanded ? "var(--color-primary)" : "var(--color-elevated)",
                        color: isExpanded ? "white" : "var(--color-text)",
                        cursor: "pointer",
                        display: "flex",
                        alignItems: "center",
                        gap: 16,
                        transition: "all 0.2s ease"
                      }}
                    >
                      {/* Step Number */}
                      <div style={{
                        width: 40,
                        height: 40,
                        borderRadius: "var(--radius-full)",
                        background: isExpanded ? "white" : "var(--color-primary)",
                        color: isExpanded ? "var(--color-primary)" : "white",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "center",
                        fontSize: 18,
                        fontWeight: 800,
                        flexShrink: 0
                      }}>
                        {step.number}
                      </div>

                      {/* Step Title */}
                      <div style={{ flex: 1 }}>
                        <h3 style={{ margin: 0, fontSize: 16, fontWeight: 700 }}>
                          {step.title}
                        </h3>
                        <p style={{
                          margin: "4px 0 0 0",
                          fontSize: 13,
                          opacity: isExpanded ? 0.9 : 0.6
                        }}>
                          {step.description}
                        </p>
                      </div>

                      {/* Expand Icon */}
                      <div style={{
                        fontSize: 20,
                        transform: isExpanded ? "rotate(180deg)" : "rotate(0deg)",
                        transition: "transform 0.3s ease"
                      }}>
                        â–¼
                      </div>
                    </div>

                    {/* Step Details */}
                    {isExpanded && (
                      <div style={{
                        padding: 20,
                        background: "white",
                        animation: "fadeIn 0.3s ease"
                      }}>
                        <ol style={{
                          margin: 0,
                          paddingLeft: 20,
                          lineHeight: 2,
                          fontSize: 14
                        }}>
                          {step.details.map((detail, idx) => (
                            <li key={idx} style={{
                              marginBottom: 8,
                              color: detail.startsWith("âš ï¸") ? "var(--color-warning)" : "var(--color-text)"
                            }}>
                              {detail}
                            </li>
                          ))}
                        </ol>

                        {/* Link */}
                        {step.link && (
                          <div style={{ marginTop: 16 }}>
                            <a
                              href={step.link.url}
                              target="_blank"
                              rel="noopener noreferrer"
                              style={{
                                display: "inline-flex",
                                alignItems: "center",
                                gap: 8,
                                padding: "10px 16px",
                                background: "var(--color-primary)",
                                color: "white",
                                borderRadius: "var(--radius-md)",
                                fontSize: 13,
                                fontWeight: 600,
                                textDecoration: "none",
                                transition: "all 0.2s ease"
                              }}
                            >
                              ğŸ”— {step.link.text} â†’
                            </a>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

            {/* Footer */}
            <div style={{
              padding: 20,
              borderTop: "2px solid var(--color-border)",
              background: "var(--color-elevated)",
              display: "flex",
              justifyContent: "space-between",
              alignItems: "center",
              gap: 16,
              flexWrap: "wrap"
            }}>
              <div style={{ fontSize: 13, color: "var(--color-text-muted)" }}>
                ğŸ’¡ <strong>Need help?</strong> Check{" "}
                <a href="/SHOPEE_CREDENTIALS_GUIDE.md" target="_blank" style={{ color: "var(--color-primary)", fontWeight: 600 }}>
                  documentation
                </a>
              </div>
              <button
                onClick={() => setShowGuide(false)}
                className="btn btn-ghost"
                style={{ minWidth: 120 }}
              >
                Close Guide
              </button>
            </div>
          </div>
        </>
      )}

      <style jsx>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translate(-50%, -45%);
          }
          to {
            opacity: 1;
            transform: translate(-50%, -50%);
          }
        }
      `}</style>
    </>
  );
}
