"use strict";(()=>{var e={};e.id=411,e.ids=[411,660],e.modules={8136:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>m,default:()=>p,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>S,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>D,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>f});var a=t(8877),n=t(4591),i=t(6021),l=t(552),o=t.n(l),d=t(4076),c=t(2669),u=e([c]);c=(u.then?(await u)():u)[0];let p=(0,i.l)(c,"default"),h=(0,i.l)(c,"getStaticProps"),x=(0,i.l)(c,"getStaticPaths"),g=(0,i.l)(c,"getServerSideProps"),m=(0,i.l)(c,"config"),v=(0,i.l)(c,"reportWebVitals"),f=(0,i.l)(c,"unstable_getStaticProps"),j=(0,i.l)(c,"unstable_getStaticPaths"),y=(0,i.l)(c,"unstable_getStaticParams"),b=(0,i.l)(c,"unstable_getServerProps"),D=(0,i.l)(c,"unstable_getServerSideProps"),S=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/review",pathname:"/review",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:c});s()}catch(e){s(e)}})},1522:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>l});var a=t(9648),n=e([a]);let i=(a=(n.then?(await n)():n)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});i.defaults.adapter,i.interceptors.request.use(e=>{let r=e.url||"";if(r.startsWith("/api/orders/"))e.url=r.replace("/api","");else for(let t of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(r.startsWith(t)){e.url=r.replace("/api","");break}return e}),i.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let l=i;s()}catch(e){s(e)}})},2669:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>x,getStaticProps:()=>g});var a=t(997),n=t(6689),i=t(5941),l=t(5460),o=t(1377),d=t(1522),c=t(5681),u=t(3877),p=t(7029),h=e([i,d]);[i,d]=h.then?(await h)():h;let m=e=>d.Z.get(e).then(e=>e.data);function x(){let{t:e}=(0,o.useTranslation)("common"),[r,t]=(0,n.useState)(""),[s,l]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1),[g,v]=(0,n.useState)(!1),[f,j]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[D,S]=(0,n.useState)("APPROVE"),[R,A]=(0,n.useState)(0),[w,P]=(0,n.useState)(""),{data:C,error:k,mutate:E}=(0,i.default)("/orders/errors",m,{revalidateOnFocus:!1}),{data:N,mutate:z}=(0,i.default)(r?`/api/returns?shopId=${r}`:null,m),O=Array.isArray(C)?C.filter(e=>e.reason?.toLowerCase().includes("manual review")||e.reason?.toLowerCase().includes("review")):[],I=Array.isArray(N)?N:[],q=async e=>{b(e);try{await d.Z.post(`/orders/retry/${e}`),(0,p.M)("Order retry successful","success"),E()}catch(e){(0,p.M)(e?.response?.data?.error||"Retry failed","error")}finally{b(null)}},L=async()=>{if(s){j(!0);try{let e="APPROVE"===D?`/api/returns/${s.id}/approve`:`/api/returns/${s.id}/reject`;await d.Z.post(e,{refundAmount:"APPROVE"===D?R:void 0,notes:w}),(0,p.M)(`Return ${D.toLowerCase()}d successfully`,"success"),v(!1),l(null),P(""),z()}catch(e){(0,p.M)(e.response?.data?.error||"Failed to process return","error")}finally{j(!1)}}},M=async e=>{j(!0);try{await d.Z.post(`/api/returns/${e}/complete`),(0,p.M)("Return completed successfully","success"),z()}catch(e){(0,p.M)(e.response?.data?.error||"Failed to complete return","error")}finally{j(!1)}},W=e=>{switch(e){case"PENDING":return"warning";case"APPROVED":default:return"info";case"REJECTED":return"error";case"REFUNDED":case"COMPLETED":return"success"}},$=(0,n.useMemo)(()=>({pending:I.filter(e=>"PENDING"===e.status).length,approved:I.filter(e=>"APPROVED"===e.status).length,refunded:I.filter(e=>"REFUNDED"===e.status).length,total:I.length,totalRefundAmount:I.filter(e=>"REFUNDED"===e.status||"APPROVED"===e.status).reduce((e,r)=>e+r.refundAmount,0)}),[I]),Z=(0,n.useMemo)(()=>[{label:"Pending returns",value:$.pending.toLocaleString(),helper:"Awaiting approval",color:"var(--color-warning)"},{label:"Approved",value:$.approved.toLocaleString(),helper:"Ready to refund",color:"var(--color-info)"},{label:"Refunded",value:$.refunded.toLocaleString(),helper:"Completed in period",color:"var(--color-success)"}],[$]),F=a.jsx(u.Ct,{variant:$.pending>0?"warning":"success",size:"lg",children:$.pending>0?`${$.pending} pending approvals`:"All returns cleared"}),V=a.jsx("div",{style:{display:"grid",gap:12},children:Z.map(e=>(0,a.jsxs)("div",{style:{padding:16,borderRadius:"var(--radius-lg)",background:"rgba(255,255,255,0.9)",border:"1px solid rgba(255,255,255,0.6)",boxShadow:"var(--shadow-sm)"},children:[a.jsx("span",{style:{fontSize:12,letterSpacing:.4,textTransform:"uppercase",color:"rgba(15,23,42,0.6)"},children:e.label}),a.jsx("div",{style:{fontSize:28,fontWeight:800,color:e.color},children:e.value}),a.jsx("p",{style:{margin:0,fontSize:13,color:"rgba(15,23,42,0.7)"},children:e.helper})]},e.label))}),T=a.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:14},children:r?`Tracking shop ${r}. Total refunded \xa5${$.totalRefundAmount.toLocaleString()}.`:"Enter a Shop ID to load return activity."}),_=()=>{if(!r){(0,p.M)(e("enterShopIDReturns")||"Enter a Shop ID to fetch returns.","error");return}z()},B=(0,a.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,a.jsxs)(u.zx,{type:"button",variant:"ghost",onClick:()=>E(),children:["\uD83D\uDD01 ",e("refreshManualQueue")||"Refresh manual queue"]}),(0,a.jsxs)(u.zx,{type:"button",onClick:_,children:["♻️ ",e("refreshReturns")||"Refresh returns"]})]}),G=(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"flex-end"},children:[a.jsx("div",{style:{flex:"1 1 260px",minWidth:240},children:a.jsx(u.II,{label:e("shopId")||"Shop ID",value:r,onChange:e=>t(e.target.value),placeholder:e("enterShopIDReturns")})}),(0,a.jsxs)(u.zx,{type:"button",variant:"ghost",onClick:()=>t(""),children:["\uD83E\uDDFC ",e("clearForm")||"Clear"]}),(0,a.jsxs)(u.zx,{type:"button",onClick:_,children:["\uD83D\uDD04 ",e("loadReturns")||"Load returns"]})]}),U=(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsxs)(u.Zb,{hover:!1,children:[a.jsx(u.Ol,{title:e("returnPlaybook")||"Return playbook",subtitle:e("triageGuidance")||"Guidelines for manual review",icon:"\uD83D\uDCD8"}),(0,a.jsxs)("ul",{style:{margin:0,paddingLeft:18,display:"flex",flexDirection:"column",gap:6,color:"var(--color-text-muted)",fontSize:13},children:[a.jsx("li",{children:e("respondPendingWithin24h")||"Respond to pending returns within 24h to keep SLAs green."}),a.jsx("li",{children:e("requirePhotos")||"Require supporting photos before approving refunds above \xa53,000."}),a.jsx("li",{children:e("captureNotes")||"Capture operator notes for every rejection to keep the audit trail complete."})]})]}),(0,a.jsxs)(u.Zb,{hover:!1,children:[a.jsx(u.Ol,{title:e("shortcuts")||"Shortcuts",subtitle:e("dailyWorkflows")||"Jump to related tools",icon:"⚡"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[{href:"/orders",label:e("navOrders")||"Orders",icon:"\uD83E\uDDFE"},{href:"/notifications",label:e("navNotifications")||"Notifications",icon:"\uD83D\uDD14"},{href:"/settings",label:e("navSettings")||"Settings",icon:"⚙️"}].map(e=>a.jsx(u.zx,{type:"button",variant:"ghost",onClick:()=>{},children:`${e.icon} ${e.label}`},e.href))})]})]}),J=(0,a.jsxs)(u.Zb,{children:[a.jsx(u.Ol,{title:"⚠️ Manual Review Queue",subtitle:e("ordersRequiringAttention"),icon:"\uD83D\uDC41️"}),k&&a.jsx(u.bZ,{variant:"error",title:e("errorLoadingReviewItems"),children:k.message}),0===O.length?(0,a.jsxs)("div",{style:{padding:"60px",textAlign:"center"},children:[a.jsx("div",{style:{fontSize:"64px",marginBottom:"16px"},children:"✅"}),a.jsx("h3",{style:{marginBottom:"8px"},children:e("noManualReview")||"No items need review"}),a.jsx("p",{style:{color:"var(--color-text-muted)"},children:e("manualReviewClear")||"All orders are processing normally"})]}):a.jsx(u.iA,{columns:[{key:"orderId",header:"Order ID"},{key:"reason",header:"Reason"},{key:"date",header:"Date",width:"150px",render:e=>a.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-muted)"},children:new Date(e.createdAt).toLocaleString()})},{key:"actions",header:"Actions",width:"140px",render:e=>a.jsx(u.zx,{size:"sm",onClick:()=>q(e.shopeeOrderId),disabled:y===e.shopeeOrderId,children:y===e.shopeeOrderId?"Retrying...":"Retry"})}],data:O.map(e=>({orderId:e.shopeeOrderId||"-",reason:e.reason,createdAt:e.createdAt,shopeeOrderId:e.shopeeOrderId}))})]}),Q=(0,a.jsxs)(u.Zb,{children:[a.jsx(u.Ol,{title:"\uD83D\uDD04 Returns Management",subtitle:e("manageReturns"),icon:"\uD83D\uDCB0"}),!r&&a.jsx("div",{style:{padding:"0 24px 24px"},children:a.jsx(u.bZ,{variant:"info",children:e("enterShopIDReturnsPrompt")||"Enter your Shop ID above to manage returns and refunds."})}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-4",style:{gap:"16px",padding:"0 24px 24px"},children:[a.jsx(u.Rm,{icon:"\uD83D\uDCCB",label:"Total Returns",value:$.total.toString(),color:"primary"}),a.jsx(u.Rm,{icon:"⏳",label:"Pending",value:$.pending.toString(),color:"warning"}),a.jsx(u.Rm,{icon:"✅",label:"Approved",value:$.approved.toString(),color:"info"}),a.jsx(u.Rm,{icon:"\uD83D\uDCB0",label:"Total Refunded",value:`\xa5${$.totalRefundAmount.toLocaleString()}`,color:"success"})]}),I.length>0?a.jsx(u.mQ,{tabs:[{id:"pending",label:"Pending",icon:"⏳",badge:$.pending,content:a.jsx("div",{style:{padding:"24px"},children:a.jsx(u.iA,{columns:[{key:"rma",header:"RMA#",width:"120px"},{key:"customer",header:"Customer",render:e=>(0,a.jsxs)("div",{children:[a.jsx("div",{style:{fontWeight:600},children:e.customerName}),a.jsx("div",{style:{fontSize:"13px",color:"var(--color-text-muted)"},children:e.customerEmail})]})},{key:"reason",header:"Reason"},{key:"amount",header:"Amount",width:"120px",render:e=>(0,a.jsxs)("span",{style:{fontWeight:600,color:"var(--color-error)"},children:["\xa5",e.refundAmount.toLocaleString()]})},{key:"date",header:"Requested",width:"150px",render:e=>a.jsx("span",{style:{fontSize:"13px",color:"var(--color-text-muted)"},children:new Date(e.requestedAt).toLocaleDateString()})},{key:"actions",header:"Actions",width:"180px",render:e=>(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[a.jsx(u.zx,{size:"sm",variant:"ghost",onClick:()=>{l(e),x(!0)},children:"Details"}),a.jsx(u.zx,{size:"sm",variant:"success",onClick:()=>{l(e),A(e.refundAmount),v(!0)},children:"Process"})]})}],data:I.filter(e=>"PENDING"===e.status)})})},{id:"approved",label:"Approved",icon:"✅",badge:$.approved,content:a.jsx("div",{style:{padding:"24px"},children:a.jsx(u.iA,{columns:[{key:"rma",header:"RMA#",width:"120px",render:e=>e.rmaNumber},{key:"customer",header:"Customer",render:e=>e.customerName},{key:"amount",header:"Refund Amount",width:"120px",render:e=>`\xa5${e.refundAmount.toLocaleString()}`},{key:"approved",header:"Approved",width:"150px",render:e=>new Date(e.approvedAt).toLocaleDateString()},{key:"actions",header:"Actions",width:"140px",render:e=>a.jsx(u.zx,{size:"sm",variant:"success",onClick:()=>M(e.id),disabled:f,children:"Complete"})}],data:I.filter(e=>"APPROVED"===e.status)})})},{id:"all",label:"All Returns",icon:"\uD83D\uDCCB",badge:I.length,content:a.jsx("div",{style:{padding:"24px"},children:a.jsx(u.iA,{columns:[{key:"rma",header:"RMA#",width:"120px",render:e=>e.rmaNumber},{key:"customer",header:"Customer",render:e=>e.customerName},{key:"reason",header:"Reason"},{key:"status",header:"Status",width:"120px",render:e=>a.jsx(u.Ct,{variant:W(e.status),children:e.status})},{key:"amount",header:"Amount",width:"120px",render:e=>`\xa5${e.refundAmount.toLocaleString()}`},{key:"date",header:"Requested",width:"130px",render:e=>new Date(e.requestedAt).toLocaleDateString()}],data:I})})}]}):a.jsx(u.ub,{icon:"\uD83D\uDD04",title:e("noReturnsFound"),description:e("descriptionReturnRequests")})]})]});return(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{}),a.jsx(c.Z,{activeHref:"/review",title:"\uD83D\uDD04 Returns & Manual Review Center",description:e("reviewHeroDescription")||"Process returns, manage refunds, and handle manual review items.",heroBadge:F,heroAside:V,heroFooter:T,heroBackground:"linear-gradient(120deg, #fdf2f8 0%, #ede9fe 40%, #cffafe 100%)",toolbar:G,actions:B,sidebar:U,children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[J,Q]})}),"*** End Patch",s&&a.jsx(u.u_,{isOpen:h,onClose:()=>{x(!1),l(null)},title:`Return Details - ${s.rmaNumber}`,children:a.jsx("div",{style:{padding:"24px"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Customer"}),a.jsx("div",{style:{fontSize:"15px",fontWeight:600},children:s.customerName}),a.jsx("div",{style:{fontSize:"13px",color:"var(--color-text-muted)"},children:s.customerEmail})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Order ID"}),a.jsx("div",{style:{fontSize:"15px"},children:s.shopOrderId})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Return Reason"}),a.jsx("div",{style:{fontSize:"15px"},children:s.reason})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Refund Amount"}),(0,a.jsxs)("div",{style:{fontSize:"20px",fontWeight:700,color:"var(--color-error)"},children:["\xa5",s.refundAmount.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Status"}),a.jsx(u.Ct,{variant:W(s.status),children:s.status})]}),s.notes&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Notes"}),a.jsx("div",{style:{padding:"12px",background:"var(--color-elevated)",borderRadius:"var(--radius-md)",fontSize:"14px"},children:s.notes})]}),(0,a.jsxs)("div",{className:"grid grid-2",style:{gap:"12px",fontSize:"13px",color:"var(--color-text-muted)"},children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Requested:"})," ",new Date(s.requestedAt).toLocaleString()]}),s.approvedAt&&(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Approved:"})," ",new Date(s.approvedAt).toLocaleString()]})]})]})})}),a.jsx(u.u_,{isOpen:g,onClose:()=>{v(!1),l(null),P("")},title:e("processReturnRequest"),children:(0,a.jsxs)("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[s&&(0,a.jsxs)(u.bZ,{variant:"info",children:["Processing return for ",a.jsx("strong",{children:s.customerName})," (",s.rmaNumber,")"]}),a.jsx(u.Ph,{label:"Action",value:D,onChange:e=>S(e.target.value),options:[{value:"APPROVE",label:"✅ Approve Return"},{value:"REJECT",label:"❌ Reject Return"}]}),"APPROVE"===D&&a.jsx(u.II,{label:"Refund Amount (\xa5)",type:"number",value:R,onChange:e=>A(Number(e.target.value))}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Notes"}),a.jsx("textarea",{className:"input",value:w,onChange:e=>P(e.target.value),placeholder:e("addInternalNotes"),rows:4,style:{width:"100%",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px",marginTop:"8px"},children:[a.jsx(u.zx,{onClick:L,disabled:f,variant:"APPROVE"===D?"success":"danger",fullWidth:!0,children:f?"Processing...":`${"APPROVE"===D?"Approve":"Reject"} Return`}),a.jsx(u.zx,{onClick:()=>v(!1),variant:"ghost",fullWidth:!0,children:e("cancel")})]})]})})]})}async function g({locale:e}){return{props:{...await (0,l.serverSideTranslations)(e,["common"])}}}s()}catch(e){s(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[332,839,552,754,20],()=>t(8136));module.exports=s})();