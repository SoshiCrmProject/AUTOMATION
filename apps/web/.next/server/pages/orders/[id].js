"use strict";(()=>{var e={};e.id=750,e.ids=[750,660],e.modules={5326:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>m,default:()=>u,getServerSideProps:()=>h,getStaticPaths:()=>g,getStaticProps:()=>x,reportWebVitals:()=>f,routeModule:()=>D,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>y});var s=t(8877),i=t(4591),l=t(6021),o=t(552),n=t.n(o),d=t(4076),c=t(4754),p=e([c]);c=(p.then?(await p)():p)[0];let u=(0,l.l)(c,"default"),x=(0,l.l)(c,"getStaticProps"),g=(0,l.l)(c,"getStaticPaths"),h=(0,l.l)(c,"getServerSideProps"),m=(0,l.l)(c,"config"),f=(0,l.l)(c,"reportWebVitals"),y=(0,l.l)(c,"unstable_getStaticProps"),v=(0,l.l)(c,"unstable_getStaticPaths"),j=(0,l.l)(c,"unstable_getStaticParams"),b=(0,l.l)(c,"unstable_getServerProps"),S=(0,l.l)(c,"unstable_getServerSideProps"),D=new s.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/orders/[id]",pathname:"/orders/[id]",bundlePath:"",filename:""},components:{App:d.default,Document:n()},userland:c});a()}catch(e){a(e)}})},5697:(e,r,t)=>{t.d(r,{Z:()=>s});var a=t(997);function s({status:e,labels:r}){let t=e?.toUpperCase?.()||"",s="#cbd5e1",i="#0f172a",l=e;return["FULFILLED","PLACED"].includes(t)?(s="#dcfce7",i="#166534",l=r.success):["FAILED","SKIPPED"].includes(t)?(s="#fee2e2",i="#991b1b",l=r.error):["QUEUED","PROCESSING","UNPROCESSED"].includes(t)?(s="#e0f2fe",i="#075985",l=r.pending):["MANUAL_REVIEW"].includes(t)&&(s="#e2e8f0",i="#0f172a",l=r.manual),a.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:s,color:i},children:l})}},1522:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{Z:()=>o});var s=t(9648),i=e([s]);let l=(s=(i.then?(await i)():i)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});l.defaults.adapter,l.interceptors.request.use(e=>{let r=e.url||"";if(r.startsWith("/api/orders/"))e.url=r.replace("/api","");else for(let t of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(r.startsWith(t)){e.url=r.replace("/api","");break}return e}),l.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let o=l;a()}catch(e){a(e)}})},4754:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>m,getServerSideProps:()=>y});var s=t(997),i=t(5460),l=t(1377),o=t(5632),n=t(6689),d=t(5941),c=t(5681),p=t(7029),u=t(5697),x=t(1522),g=t(3877),h=e([d,x]);[d,x]=h.then?(await h)():h;let f=e=>x.Z.get(e).then(e=>e.data);function m(){let{t:e}=(0,l.useTranslation)("common"),r=(0,o.useRouter)(),{id:t}=r.query,{data:a,mutate:i}=(0,d.default)(t?`/api/orders/${t}`:null,f),[h,m]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1),[j,b]=(0,n.useState)(!1),S=(0,n.useMemo)(()=>a?.rawPayload?.amazonProductUrl||a?.errorItems?.[0]?.amazonProductUrl||null,[a]),D=(0,n.useMemo)(()=>({success:e("statusProcessed"),error:e("statusError"),pending:e("statusPending"),manual:e("ordersTableManual")}),[e]),P=(0,n.useMemo)(()=>a?[{label:e("total")||"Total",value:void 0!==a.orderTotal&&null!==a.orderTotal?`${a.currency||""} ${a.orderTotal.toLocaleString()}`:"â€”",helper:e("orderDetailTotalHelper")||"Shopee order amount"},{label:e("profit")||"Profit",value:void 0!==a.expectedProfit&&null!==a.expectedProfit?`${a.expectedProfitCurrency||a.currency||""} ${a.expectedProfit.toLocaleString()}`:"â€”",helper:e("orderDetailProfitHelper")||"Projected margin"},{label:e("shippingDaysLabel")||"Shipping days",value:void 0!==a.shippingDays&&null!==a.shippingDays?`${a.shippingDays}`:"â€”",helper:e("orderDetailShippingHelper")||"Estimated delivery time"}]:[],[a,e]),z=a?s.jsx(u.Z,{status:a.processingStatus,labels:D}):s.jsx(g.Ct,{variant:"info",size:"lg",children:e("loading")}),w=a?s.jsx("div",{style:{display:"grid",gap:12},children:P.map(e=>(0,s.jsxs)("div",{style:{padding:16,borderRadius:"var(--radius-lg)",background:"rgba(255,255,255,0.92)",border:"1px solid rgba(148,163,184,0.4)",boxShadow:"var(--shadow-xs)"},children:[s.jsx("p",{style:{margin:0,fontSize:12,color:"var(--color-text-muted)",letterSpacing:.6,textTransform:"uppercase"},children:e.label}),s.jsx("strong",{style:{display:"block",fontSize:26,marginTop:4},children:e.value}),s.jsx("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:e.helper})]},e.label))}):null,C=(0,n.useMemo)(()=>{if(!a)return e("loading");let r=a.amazonOrder?.placedAt||a.rawPayload?.createdAt;return r?`${e("lastUpdated")||"Last updated"}: ${new Date(r).toLocaleString()}`:e("ordersTableStatus")},[a,e]),$=a?(0,s.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:[s.jsx(g.Ct,{variant:"info",children:`${e("shop")}: ${a.shop?.name??e("unknown")}`}),s.jsx(g.Ct,{variant:"warning",children:`${e("ordersTableStatus")}: ${a.processingStatus}`}),a.processingMode&&s.jsx(g.Ct,{variant:"success",children:`${e("processingMode")||"Mode"}: ${a.processingMode}`}),S&&(0,s.jsxs)(g.zx,{variant:"ghost",onClick:()=>window.open(S,"_blank"),children:["\uD83D\uDD17 ",e("viewOnAmazon")]})]}):null,k=(0,s.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[S&&(0,s.jsxs)(g.zx,{variant:"ghost",onClick:()=>window.open(S,"_blank"),children:["\uD83D\uDD17 ",e("viewOnAmazon")]}),(0,s.jsxs)(g.zx,{variant:"ghost",onClick:()=>r.push("/orders"),children:["â† ",e("back")]})]}),O=a?(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,s.jsxs)(g.Zb,{hover:!1,children:[s.jsx(g.Ol,{title:e("orderQuickFacts")||"Quick facts",subtitle:e("orderQuickFactsSubtitle")||"Key metadata for troubleshooting",icon:"\uD83D\uDDC2ï¸"}),(0,s.jsxs)("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:12,fontSize:13},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:e("ordersTableStatus")}),s.jsx("strong",{children:a.processingStatus})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:e("processingMode")||"Mode"}),s.jsx("strong",{children:a.processingMode||"â€”"})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:e("shippingDaysLabel")||"Shipping"}),s.jsx("strong",{children:a.shippingDays??"â€”"})]})]})]}),(0,s.jsxs)(g.Zb,{hover:!1,children:[s.jsx(g.Ol,{title:e("amazonOrderId"),subtitle:e("amazonOrderStatus")||"Amazon fulfillment status",icon:"\uD83D\uDCE6"}),s.jsx("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:8,fontSize:14},children:a.amazonOrder?(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{children:s.jsx("strong",{children:a.amazonOrder.amazonOrderId??e("statusPending")})}),s.jsx("div",{style:{color:"var(--color-text-muted)",fontSize:13},children:a.amazonOrder.status}),void 0!==a.amazonOrder.purchasePrice&&(0,s.jsxs)("div",{children:[e("total"),": ",a.amazonOrder.purchasePrice??"â€”"]}),a.amazonOrder.placedAt&&(0,s.jsxs)("div",{children:[e("createdAt"),": ",new Date(a.amazonOrder.placedAt).toLocaleString()]})]}):s.jsx("p",{style:{margin:0,color:"var(--color-text-muted)",fontSize:13},children:e("amazonOrderMissing")||"No Amazon order has been created yet."})})]})]}):null;if(!a)return(0,s.jsxs)(s.Fragment,{children:[s.jsx(c.Z,{activeHref:"/orders",title:e("orders"),description:e("loading"),heroBadge:s.jsx(g.Ct,{variant:"info",size:"lg",children:e("loading")}),heroBackground:"linear-gradient(135deg, rgba(226,232,240,0.8) 0%, rgba(248,250,252,0.9) 100%)",children:s.jsx(g.TK,{text:e("loading")||"Loading"})}),s.jsx(p.Z,{})]});let M=async()=>{v(!0);try{await x.Z.post(`/api/orders/retry/${a.id}`),(0,p.M)(e("retrySuccess")),i()}catch(r){(0,p.M)(r?.response?.data?.error??e("actionRetryError"),"error")}finally{v(!1)}},A=async()=>{b(!0);try{await x.Z.post(`/api/orders/manual/${a.id}`,{manualNote:h}),m(""),(0,p.M)(e("actionManualFulfillSuccess")),i()}catch(r){(0,p.M)(r?.response?.data?.error??e("actionManualFulfillError"),"error")}finally{b(!1)}},E=a.errorItems?.length?(0,s.jsxs)(g.Zb,{children:[s.jsx(g.Ol,{title:e("error"),subtitle:e("errorTimeline")||"Latest automation issues",icon:"\uD83D\uDEA8"}),s.jsx("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:16},children:a.errorItems.map(r=>(0,s.jsxs)("div",{style:{border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:16},children:[s.jsx("strong",{children:r.reason||r.errorCode}),(0,s.jsxs)("div",{style:{color:"var(--color-text-muted)",fontSize:13,marginTop:4},children:[r.errorCode,r.filterFailureType?` â€¢ ${r.filterFailureType}`:"",null!==r.profitValue&&void 0!==r.profitValue?` â€¢ profit=${r.profitValue}`:"",null!==r.shippingDays&&void 0!==r.shippingDays?` â€¢ days=${r.shippingDays}`:""]}),s.jsx("div",{style:{color:"#94a3b8",fontSize:12,marginTop:4},children:new Date(r.createdAt).toLocaleString()}),r.metadata?.screenshot&&s.jsx("div",{style:{marginTop:8},children:s.jsx("a",{href:r.metadata.screenshot,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:e("openLink")})})]},r.id))})]}):null,T=(0,s.jsxs)(g.Zb,{children:[s.jsx(g.Ol,{title:e("manualActions"),subtitle:e("manualActionsSubtitle")||"Override automation and leave context for teammates",icon:"\uD83D\uDEE0ï¸"}),(0,s.jsxs)("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:16},children:[s.jsx(g.gx,{label:e("manualNote")||"Manual note",placeholder:e("manualNotePlaceholder")||e("manualNote")||"Add operator note",value:h,onChange:e=>m(e.target.value)}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[s.jsx(g.zx,{variant:"ghost",onClick:M,loading:y,children:y?e("loading"):e("retry")}),s.jsx(g.zx,{onClick:A,loading:j,children:j?e("loading"):e("manualFulfill")})]})]})]}),L=(0,s.jsxs)(g.Zb,{children:[s.jsx(g.Ol,{title:`${e("orders")} ${a.shopeeOrderSn}`,subtitle:e("orderSummarySubtitle")||"Shopee payload and linked assets",icon:"\uD83D\uDCC4"}),(0,s.jsxs)("div",{style:{padding:"0 24px 24px",display:"grid",gap:16},children:[(0,s.jsxs)("div",{children:[s.jsx("p",{style:{fontSize:12,color:"var(--color-text-muted)",marginBottom:4},children:e("shop")}),s.jsx("strong",{children:a.shop?.name??"â€”"})]}),(0,s.jsxs)("div",{children:[s.jsx("p",{style:{fontSize:12,color:"var(--color-text-muted)",marginBottom:4},children:e("amazon")}),S?s.jsx("a",{href:S,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:S}):s.jsx("span",{children:"â€”"})]}),(0,s.jsxs)("div",{children:[s.jsx("p",{style:{fontSize:12,color:"var(--color-text-muted)",marginBottom:4},children:e("expectedProfit")||e("profit")}),s.jsx("strong",{children:void 0!==a.expectedProfit&&null!==a.expectedProfit?`${a.expectedProfitCurrency||a.currency||""} ${a.expectedProfit.toLocaleString()}`:"â€”"})]}),(0,s.jsxs)("div",{children:[s.jsx("p",{style:{fontSize:12,color:"var(--color-text-muted)",marginBottom:4},children:e("shippingDaysLabel")||"Shipping days"}),s.jsx("strong",{children:a.shippingDays??"â€”"})]})]})]});return(0,s.jsxs)(s.Fragment,{children:[s.jsx(c.Z,{activeHref:"/orders",title:`ðŸ§¾ ${e("orders")} ${a.shopeeOrderSn}`,description:e("orderDetailSubtitle")||"Detailed automation context for this order",heroBadge:z,heroAside:w,heroFooter:C,toolbar:$,actions:k,sidebar:O,heroBackground:"linear-gradient(135deg, rgba(239,246,255,0.95) 0%, rgba(224,242,254,0.9) 100%)",children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[a.errorItems?.length?s.jsx(g.bZ,{variant:"warning",title:e("errorsDetected")||"Errors detected",children:e("orderHasErrors")||"Automation flagged issues for this order. Review the timeline below before retrying."}):null,L,T,E]})}),s.jsx(p.Z,{})]})}let y=async({locale:e})=>({props:{...await (0,i.serverSideTranslations)(e||"en",["common"])}});a()}catch(e){a(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[332,839,552,754,20],()=>t(5326));module.exports=a})();