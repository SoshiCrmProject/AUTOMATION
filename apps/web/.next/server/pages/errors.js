"use strict";(()=>{var e={};e.id=298,e.ids=[298,660],e.modules={8954:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>m,default:()=>u,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>y,routeModule:()=>w,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>f});var o=t(8877),s=t(4591),l=t(6021),i=t(552),n=t.n(i),d=t(4076),c=t(3356),p=e([c]);c=(p.then?(await p)():p)[0];let u=(0,l.l)(c,"default"),h=(0,l.l)(c,"getStaticProps"),x=(0,l.l)(c,"getStaticPaths"),g=(0,l.l)(c,"getServerSideProps"),m=(0,l.l)(c,"config"),y=(0,l.l)(c,"reportWebVitals"),f=(0,l.l)(c,"unstable_getStaticProps"),b=(0,l.l)(c,"unstable_getStaticPaths"),j=(0,l.l)(c,"unstable_getStaticParams"),v=(0,l.l)(c,"unstable_getServerProps"),S=(0,l.l)(c,"unstable_getServerSideProps"),w=new o.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/errors",pathname:"/errors",bundlePath:"",filename:""},components:{App:d.default,Document:n()},userland:c});a()}catch(e){a(e)}})},8335:(e,r,t)=>{t.d(r,{Z:()=>s});var a=t(997),o=t(1377);function s({items:e,selectable:r,selected:t,onToggle:s}){let{t:l}=(0,o.useTranslation)("common");return e.length?(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[r&&a.jsx("th",{}),a.jsx("th",{style:{textAlign:"left"},children:l("orders")}),a.jsx("th",{style:{textAlign:"left"},children:l("reason")}),a.jsx("th",{style:{textAlign:"left"},children:l("amazon")}),a.jsx("th",{style:{textAlign:"left"},children:l("createdAt")})]})}),a.jsx("tbody",{children:e.map(e=>{let o=e.shopeeOrderId??e.id,i=t?.has(o)??!1;return(0,a.jsxs)("tr",{children:[r&&a.jsx("td",{children:a.jsx("input",{type:"checkbox",checked:i,onChange:()=>s?.(e.id,e.shopeeOrderId??void 0)})}),a.jsx("td",{style:{padding:"6px 4px"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("strong",{children:e.shopeeOrderId??o}),e.amazonProductUrl?a.jsx("a",{href:e.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:l("amazonPage")}):null]})}),a.jsx("td",{children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[a.jsx("span",{children:e.reason||e.errorCode}),e.errorCode&&a.jsx("span",{style:{color:"#475569",fontSize:12},children:e.errorCode}),e.filterFailureType&&a.jsx("span",{style:{color:"#475569",fontSize:12},children:e.filterFailureType}),null!==e.profitValue&&void 0!==e.profitValue&&(0,a.jsxs)("span",{style:{color:"#475569",fontSize:12},children:[l("minProfit"),": ",e.profitValue]}),null!==e.shippingDays&&void 0!==e.shippingDays&&(0,a.jsxs)("span",{style:{color:"#475569",fontSize:12},children:[l("shippingDaysLabel")??"Shipping days",": ",e.shippingDays]}),e.metadata?.screenshot&&a.jsx("a",{href:e.metadata.screenshot,target:"_blank",rel:"noreferrer",style:{color:"#2563eb",fontSize:12},children:l("openLink")})]})}),a.jsx("td",{children:e.amazonProductUrl?a.jsx("a",{href:e.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:l("amazonPage")}):"—"}),a.jsx("td",{children:new Date(e.createdAt).toLocaleString()})]},e.id)})})]}):a.jsx("p",{children:l("noErrors")})}},1522:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{Z:()=>i});var o=t(9648),s=e([o]);let l=(o=(s.then?(await s)():s)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});l.defaults.adapter,l.interceptors.request.use(e=>{let r=e.url||"";if(r.startsWith("/api/orders/"))e.url=r.replace("/api","");else for(let t of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(r.startsWith(t)){e.url=r.replace("/api","");break}return e}),l.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let i=l;a()}catch(e){a(e)}})},3356:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>g,getStaticProps:()=>m});var o=t(997),s=t(6689),l=t(5941),i=t(5460),n=t(1377),d=t(5681),c=t(8335),p=t(1522),u=t(3877),h=t(7029),x=e([l,p]);[l,p]=x.then?(await x)():x;let y=e=>p.Z.get(e).then(e=>e.data);function g(){let{t:e}=(0,n.useTranslation)("common"),{data:r,error:t}=(0,l.default)("/api/orders/errors",y,{revalidateOnFocus:!1}),[a,i]=(0,s.useState)(""),[x,g]=(0,s.useState)(new Set),[m,f]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!1),[v,S]=(0,s.useState)("desc"),w=r?.length??0,P=x.size>0,z=!r&&!t,D=async()=>{f(!0);try{let r=await p.Z.get("/api/orders/errors/export",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([r.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",e("errorItemsFile")),document.body.appendChild(a),a.click()}catch(r){(0,h.M)(r?.response?.data?.error??e("downloadError"),"error")}finally{f(!1)}},C=async()=>{j(!0);try{await Promise.all(Array.from(x).map(e=>p.Z.post(`/api/orders/retry/${e}`))),g(new Set),(0,h.M)(e("actionRetrySelectedSuccess"))}catch(r){(0,h.M)(r?.response?.data?.error??e("actionRetrySelectedError"),"error")}finally{j(!1)}},k=(0,s.useMemo)(()=>(r??[]).filter(e=>{let r=a.toLowerCase();return(e.reason??"").toLowerCase().includes(r)||(e.errorCode??"").toLowerCase().includes(r)||(e.amazonProductUrl??"").toLowerCase().includes(r)||(e.shopeeOrderId??"").toLowerCase().includes(r)}).sort((e,r)=>{let t=new Date(e.createdAt).getTime(),a=new Date(r.createdAt).getTime();return"asc"===v?t-a:a-t}),[r,a,v]),T=o.jsx(u.Ct,{variant:P?"warning":"default",size:"sm",children:P?`${x.size} ${e("selected")||"selected"}`:e("noSelection")||"No rows selected"}),L=(0,o.jsxs)("div",{className:"grid grid-2",style:{width:"100%"},children:[(0,o.jsxs)("div",{style:{border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"16px",background:"rgba(255,255,255,0.6)",backdropFilter:"blur(6px)"},children:[o.jsx("p",{className:"label",style:{marginBottom:4},children:e("trackedErrors")||"Tracked errors"}),o.jsx("div",{style:{fontSize:28,fontWeight:800},children:w.toLocaleString()}),o.jsx("p",{style:{margin:0,color:"var(--color-text-muted)",fontSize:13},children:k[0]?.createdAt&&new Date(k[0].createdAt).toLocaleString()||e("noRecentData")||"No recent data"})]}),(0,o.jsxs)("div",{style:{border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"16px",background:"rgba(59,130,246,0.08)",color:"var(--color-text)"},children:[o.jsx("p",{className:"label",style:{marginBottom:4},children:e("triageQueue")||"Triage queue"}),o.jsx("div",{style:{fontSize:24,fontWeight:700},children:P?x.size:0}),o.jsx("p",{style:{margin:0,color:"var(--color-text-muted)",fontSize:13},children:P?e("readyToRetry")||"Ready to retry":e("selectRowsHint")||"Select rows to enable batch actions"})]})]}),A=(0,o.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:16,alignItems:"center",width:"100%"},children:[o.jsx(u.II,{placeholder:e("search")||"Search",value:a,onChange:e=>i(e.target.value),icon:o.jsx("span",{role:"img","aria-label":"search",children:"\uD83D\uDD0D"}),style:{marginBottom:0,maxWidth:320}}),o.jsx(u.zx,{variant:"ghost",type:"button",onClick:()=>S(e=>"asc"===e?"desc":"asc"),children:(e("createdAt")||"Created")+("asc"===v?" ↑":" ↓")}),T]}),F=(0,o.jsxs)("div",{children:[(0,o.jsxs)(u.Zb,{hover:!1,children:[o.jsx(u.Ol,{title:e("errorPlaybook")||"Triage playbook",subtitle:e("errorPlaybookDesc")||"Quick tips for resolving high volume failures.",icon:"\uD83E\uDDED"}),(0,o.jsxs)("ul",{style:{paddingLeft:18,margin:"0 0 16px",color:"var(--color-text-muted)",fontSize:14,lineHeight:1.6},children:[o.jsx("li",{children:e("errorTipFilter")||"Filter for the same reason code to spot systemic issues."}),o.jsx("li",{children:e("errorTipRetry")||"Retry small batches before bulk replays."}),o.jsx("li",{children:e("errorTipExport")||"Export logs if you need to escalate to support."})]}),o.jsx(u.zx,{variant:"ghost",fullWidth:!0,type:"button",onClick:()=>g(new Set),disabled:!P,children:e("clearSelection")||"Clear selection"})]}),(0,o.jsxs)(u.Zb,{hover:!1,children:[o.jsx(u.Ol,{title:e("needExport")||"Need a full export?",icon:"⬇️"}),o.jsx("p",{style:{color:"var(--color-text-muted)",marginBottom:16},children:e("errorExportHint")||"Download the full CSV to share with your ops team."}),o.jsx(u.zx,{type:"button",onClick:D,loading:m,fullWidth:!0,variant:"primary",children:e("openFile")||"Download CSV"})]})]});return(0,o.jsxs)(d.Z,{activeHref:"/errors",title:e("errorFile"),description:e("errorFileDesc")||"Realtime automation issues from Shopee and Amazon",heroBadge:o.jsx(u.Ct,{variant:w>0?"warning":"success",size:"sm",children:e("liveFeed")||"Live feed"}),actions:(0,o.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[o.jsx(u.zx,{type:"button",variant:"ghost",onClick:D,loading:m,children:m?e("loading")||"Loading":e("openFile")||"Download CSV"}),P&&o.jsx(u.zx,{type:"button",onClick:C,loading:b,children:b?e("loading")||"Loading":e("retrySelectedLabel",{count:x.size})})]}),heroAside:L,heroFooter:o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"center",color:"var(--color-text-muted)",fontSize:14},children:o.jsx("span",{children:e("errorHeroFooter")||"Use the filters below to narrow down chronic issues before exporting."})}),toolbar:A,sidebar:F,children:[t&&o.jsx(u.bZ,{variant:"error",title:e("genericError")||"Something went wrong",children:e("errorPageLoadFailed")||"We couldn't load the latest error runs. Please refresh and try again."}),(0,o.jsxs)(u.Zb,{hover:!1,children:[o.jsx(u.Ol,{title:e("errorTableTitle")||"Failed automation runs",subtitle:e("errorTableSubtitle")||"Review, filter, and retry problematic orders.",icon:"⚠️",action:T}),z&&o.jsx(u.TK,{text:e("loading")||"Loading"}),!z&&(!r||0===r.length)&&!t&&o.jsx(u.ub,{icon:"\uD83C\uDF89",title:e("noErrorsTitle")||"All clear",description:e("noErrorsDesc")||"There are no failed runs right now.",action:o.jsx(u.zx,{type:"button",variant:"ghost",onClick:D,children:e("downloadLatestReport")||"Download latest report"})}),!z&&r&&r.length>0&&o.jsx("div",{className:"table-responsive",children:o.jsx(c.Z,{selectable:!0,selected:x,onToggle:(e,r)=>{let t=r??e,a=new Set(x);a.has(t)?a.delete(t):a.add(t),g(a)},items:k})})]})]})}async function m({locale:e}){return{props:{...await (0,i.serverSideTranslations)(e,["common"])}}}a()}catch(e){a(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[332,839,552,754,20],()=>t(8954));module.exports=a})();