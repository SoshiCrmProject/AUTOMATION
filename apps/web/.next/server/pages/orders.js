"use strict";(()=>{var e={};e.id=984,e.ids=[984,660],e.modules={1090:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{config:()=>S,default:()=>u,getServerSideProps:()=>x,getStaticPaths:()=>g,getStaticProps:()=>h,reportWebVitals:()=>m,routeModule:()=>v,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>P,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>b});var a=s(8877),n=s(4591),l=s(6021),o=s(552),i=s.n(o),d=s(5270),c=s(9456),p=e([c]);c=(p.then?(await p)():p)[0];let u=(0,l.l)(c,"default"),h=(0,l.l)(c,"getStaticProps"),g=(0,l.l)(c,"getStaticPaths"),x=(0,l.l)(c,"getServerSideProps"),S=(0,l.l)(c,"config"),m=(0,l.l)(c,"reportWebVitals"),b=(0,l.l)(c,"unstable_getStaticProps"),f=(0,l.l)(c,"unstable_getStaticPaths"),j=(0,l.l)(c,"unstable_getStaticParams"),y=(0,l.l)(c,"unstable_getServerProps"),P=(0,l.l)(c,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/orders",pathname:"/orders",bundlePath:"",filename:""},components:{App:d.default,Document:i()},userland:c});t()}catch(e){t(e)}})},5697:(e,r,s)=>{s.d(r,{Z:()=>a});var t=s(997);function a({status:e,labels:r}){let s=e?.toUpperCase?.()||"",a="#cbd5e1",n="#0f172a",l=e;return["FULFILLED","PLACED"].includes(s)?(a="#dcfce7",n="#166534",l=r.success):["FAILED","SKIPPED"].includes(s)?(a="#fee2e2",n="#991b1b",l=r.error):["QUEUED","PROCESSING","UNPROCESSED"].includes(s)?(a="#e0f2fe",n="#075985",l=r.pending):["MANUAL_REVIEW"].includes(s)&&(a="#e2e8f0",n="#0f172a",l=r.manual),t.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:a,color:n},children:l})}},9456:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{default:()=>S,getStaticProps:()=>m});var a=s(997),n=s(5941),l=s(5460),o=s(1377),i=s(2684),d=s(9097),c=s.n(d),p=s(6689),u=s(1522),h=s(7029),g=s(5697),x=e([n,u]);[n,u]=x.then?(await x)():x;let b=e=>u.Z.get(e).then(e=>e.data);function S(){let{t:e}=(0,o.useTranslation)("common"),{data:r,error:s}=(0,n.default)("/api/orders/recent",b,{revalidateOnFocus:!1}),[t,l]=(0,p.useState)("all"),[d,x]=(0,p.useState)(""),[S,m]=(0,p.useState)(1),[f,j]=(0,p.useState)(!1),[y,P]=(0,p.useState)(new Set),[v,E]=(0,p.useState)(new Set),[w,C]=(0,p.useState)("order"),[I,O]=(0,p.useState)("desc"),M=async()=>{j(!0);try{await u.Z.post("/api/orders/poll-now",{}),(0,h.M)(e("actionPollSuccess"))}catch(r){(0,h.M)(r?.response?.data?.error??e("actionPollError"),"error")}finally{j(!1)}},N=async r=>{P(e=>new Set(e).add(r));try{await u.Z.post(`/api/orders/retry/${r}`),(0,h.M)(e("retrySuccess"))}catch(r){(0,h.M)(r?.response?.data?.error??e("actionRetryError"),"error")}finally{P(e=>{let s=new Set(e);return s.delete(r),s})}},D=async r=>{E(e=>new Set(e).add(r));try{await u.Z.post(`/api/orders/manual/${r}`),(0,h.M)(e("actionManualSuccess"))}catch(r){(0,h.M)(r?.response?.data?.error??e("actionManualError"),"error")}finally{E(e=>{let s=new Set(e);return s.delete(r),s})}},L=r=>a.jsx(g.Z,{status:r.processingStatus,labels:{success:e("statusProcessed"),error:e("statusError"),pending:e("statusPending"),manual:e("ordersTableManual")}}),U=(0,p.useMemo)(()=>r?r.filter(e=>"processed"===t?"FULFILLED"===e.processingStatus:"error"===t?"FAILED"===e.processingStatus||"SKIPPED"===e.processingStatus||e.errorItems.length:"pending"!==t||!e.amazonOrder&&("QUEUED"===e.processingStatus||"PROCESSING"===e.processingStatus||"UNPROCESSED"===e.processingStatus)).filter(e=>e.shopeeOrderSn.toLowerCase().includes(d.toLowerCase())).sort((e,r)=>"order"===w?"asc"===I?e.shopeeOrderSn.localeCompare(r.shopeeOrderSn):r.shopeeOrderSn.localeCompare(e.shopeeOrderSn):"asc"===I?e.processingStatus.localeCompare(r.processingStatus):r.processingStatus.localeCompare(e.processingStatus)):[],[r,t,d,w,I]);return(0,a.jsxs)("div",{className:"container",children:[a.jsx(i.Z,{activeHref:"/orders"}),(0,a.jsxs)("div",{className:"card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{children:e("orders")}),a.jsx("p",{children:e("ordersDesc")})]}),a.jsx("div",{style:{display:"flex",gap:8},children:a.jsx("button",{className:"btn",onClick:M,disabled:f,children:f?e("loading"):e("pollButton")})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap",alignItems:"center"},children:[["all","processed","error","pending"].map(r=>(0,a.jsxs)("button",{className:"button",style:{background:t===r?"#2563eb":"#cbd5e1",color:t===r?"#fff":"#0f172a"},onClick:()=>l(r),children:["all"===r&&e("filterAll"),"processed"===r&&e("filterProcessed"),"error"===r&&e("filterError"),"pending"===r&&e("filterPending")]},r)),a.jsx("input",{className:"input",placeholder:e("searchOrderId"),style:{maxWidth:240,marginBottom:0},value:d,onChange:e=>{x(e.target.value),m(1)}})]}),!r&&!s&&a.jsx("p",{children:e("loading")}),s&&a.jsx("p",{style:{color:"#ef4444"},children:e("genericError")}),0===U.length&&r&&a.jsx("p",{children:e("noOrdersMsg")??e("noOrders")}),U.length>0&&a.jsx("div",{className:"table-responsive",children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:720},children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{style:{cursor:"pointer"},onClick:()=>{C("order"),O(e=>"asc"===e?"desc":"asc")},children:[e("orders")," ","order"===w?"asc"===I?"↑":"↓":""]}),(0,a.jsxs)("th",{style:{cursor:"pointer"},onClick:()=>{C("status"),O(e=>"asc"===e?"desc":"asc")},children:[e("ordersTableStatus")," ","status"===w?"asc"===I?"↑":"↓":""]}),a.jsx("th",{children:e("ordersTableDecision")}),a.jsx("th",{children:e("ordersTableAmazon")}),a.jsx("th",{children:e("ordersTableAction")}),a.jsx("th",{children:e("ordersTableManual")})]})}),a.jsx("tbody",{children:U.slice((S-1)*10,10*S).map(r=>(0,a.jsxs)("tr",{children:[a.jsx("td",{children:a.jsx(c(),{href:`/orders/${r.id}`,style:{color:"#2563eb"},children:r.shopeeOrderSn})}),a.jsx("td",{children:L(r)}),a.jsx("td",{children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[r.errorItems.length?r.errorItems[0].reason||r.errorItems[0].errorCode:r.processingStatus,r.processingMode?a.jsx("span",{style:{color:"#475569",fontSize:12},children:r.processingMode}):null]})}),a.jsx("td",{children:r.amazonOrder?r.amazonOrder.amazonOrderId||e("statusPending"):"-"}),a.jsx("td",{children:"FULFILLED"!==r.processingStatus&&a.jsx("button",{className:"btn btn-ghost",onClick:()=>N(r.id),disabled:y.has(r.id),children:y.has(r.id)?e("loading"):e("retry")})}),a.jsx("td",{children:(0,a.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[r.rawPayload?.amazonProductUrl||r.errorItems[0]?.amazonProductUrl?a.jsx("a",{className:"btn btn-ghost",href:r.rawPayload?.amazonProductUrl||r.errorItems[0]?.amazonProductUrl,target:"_blank",rel:"noreferrer",children:e("amazonPage")}):null,a.jsx("button",{className:"btn btn-ghost",onClick:()=>D(r.id),disabled:v.has(r.id),children:v.has(r.id)?e("loading"):e("manualOrder")})]})})]},r.id))})]})}),U.length>10&&(0,a.jsxs)("div",{style:{display:"flex",gap:8,marginTop:12},children:[a.jsx("button",{className:"btn btn-ghost",disabled:1===S,onClick:()=>m(e=>Math.max(1,e-1)),children:e("prev")}),a.jsx("button",{className:"btn btn-ghost",disabled:10*S>=U.length,onClick:()=>m(e=>e+1),children:e("next")})]})]})]})}async function m({locale:e}){return{props:{...await (0,l.serverSideTranslations)(e,["common"])}}}t()}catch(e){t(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[332,839,552,754,52],()=>s(1090));module.exports=t})();