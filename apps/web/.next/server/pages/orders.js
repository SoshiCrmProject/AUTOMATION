"use strict";(()=>{var e={};e.id=984,e.ids=[984,660],e.modules={1090:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>m,default:()=>h,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>p,reportWebVitals:()=>S,routeModule:()=>D,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>j});var a=t(8877),l=t(4591),i=t(6021),n=t(552),o=t.n(n),d=t(5270),c=t(9456),u=e([c]);c=(u.then?(await u)():u)[0];let h=(0,i.l)(c,"default"),p=(0,i.l)(c,"getStaticProps"),x=(0,i.l)(c,"getStaticPaths"),g=(0,i.l)(c,"getServerSideProps"),m=(0,i.l)(c,"config"),S=(0,i.l)(c,"reportWebVitals"),j=(0,i.l)(c,"unstable_getStaticProps"),y=(0,i.l)(c,"unstable_getStaticPaths"),v=(0,i.l)(c,"unstable_getStaticParams"),f=(0,i.l)(c,"unstable_getServerProps"),b=(0,i.l)(c,"unstable_getServerSideProps"),D=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/orders",pathname:"/orders",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:c});s()}catch(e){s(e)}})},9456:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>m,getStaticProps:()=>S});var a=t(997),l=t(5941),i=t(5460),n=t(1377),o=t(2684),d=t(6689),c=t(1522),u=t(7029),h=t(3688),p=t(1935),x=t(3877),g=e([l,c]);[l,c]=g.then?(await g)():g;let j=e=>c.Z.get(e).then(e=>e.data);function m(){let{t:e}=(0,n.useTranslation)("common"),[r,t]=(0,d.useState)("all"),[s,i]=(0,d.useState)(!1),[g,m]=(0,d.useState)(""),[S,y]=(0,d.useState)(null),[v,f]=(0,d.useState)(!1),[b,D]=(0,d.useState)(!1),[z,w]=(0,d.useState)(new Set),{data:C,error:O,mutate:P}=(0,l.default)("/orders/recent",j,{revalidateOnFocus:!1}),k=!C&&!O,I=Array.isArray(C)?C:[],E=(0,d.useMemo)(()=>{if(!I.length)return{total:0,fulfilled:0,failed:0,pending:0,todayProcessed:0};let e=new Date().toDateString();return{total:I.length,fulfilled:I.filter(e=>"FULFILLED"===e.processingStatus).length,failed:I.filter(e=>"FAILED"===e.processingStatus||"SKIPPED"===e.processingStatus).length,pending:I.filter(e=>!e.amazonOrder&&["QUEUED","PROCESSING","UNPROCESSED"].includes(e.processingStatus)).length,todayProcessed:I.filter(r=>new Date(r.updatedAt).toDateString()===e).length}},[I]),L=(0,d.useMemo)(()=>I.filter(e=>{let t="all"===r||"fulfilled"===r&&"FULFILLED"===e.processingStatus||"failed"===r&&("FAILED"===e.processingStatus||"SKIPPED"===e.processingStatus)||"pending"===r&&!e.amazonOrder&&["QUEUED","PROCESSING","UNPROCESSED"].includes(e.processingStatus),s=!g||e.shopeeOrderSn.toLowerCase().includes(g.toLowerCase())||e.amazonOrder?.amazonOrderId?.toLowerCase().includes(g.toLowerCase());return t&&s}),[I,r,g]),F=async()=>{D(!0);try{await c.Z.post("/orders/poll-now"),(0,u.M)("Order polling triggered successfully","success"),P()}catch(e){(0,u.M)(e.response?.data?.error||"Failed to trigger polling","error")}finally{D(!1)}},M=async e=>{D(!0);try{await c.Z.post(`/orders/retry/${e}`),(0,u.M)("Order retry initiated","success"),P()}catch(e){(0,u.M)(e.response?.data?.error||"Failed to retry order","error")}finally{D(!1)}},A=async e=>{D(!0);try{await c.Z.post(`/orders/manual/${e}`),(0,u.M)("Order marked as manually processed","success"),P()}catch(e){(0,u.M)(e.response?.data?.error||"Failed to mark order","error")}finally{D(!1)}},N=async()=>{if(0===z.size){(0,u.M)("No orders selected","error");return}D(!0);try{await Promise.all(Array.from(z).map(e=>c.Z.post(`/orders/retry/${e}`))),(0,u.M)(`${z.size} orders retry initiated`,"success"),w(new Set),P()}catch(e){(0,u.M)("Some orders failed to retry","error")}finally{D(!1)}},R=async()=>{try{let e=await c.Z.get("/orders/processed/export",{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=r,t.setAttribute("download",`orders_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(t),t.click(),t.remove(),(0,u.M)("Orders exported successfully","success")}catch(e){(0,u.M)(e.response?.data?.error||"Failed to export orders","error")}},U=e=>{switch(e){case"FULFILLED":return a.jsx(x.Ct,{variant:"success",children:"Fulfilled"});case"FAILED":case"SKIPPED":return a.jsx(x.Ct,{variant:"error",children:"Failed"});case"PROCESSING":return a.jsx(x.Ct,{variant:"warning",children:"Processing"});case"QUEUED":return a.jsx(x.Ct,{variant:"info",children:"Queued"});default:return a.jsx(x.Ct,{variant:"default",children:e})}};return(0,a.jsxs)("div",{className:"shell",children:[a.jsx(o.Z,{activeHref:"/orders"}),(0,a.jsxs)("div",{className:"container",children:[a.jsx("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",padding:"48px 32px",borderRadius:"var(--radius-xl)",marginBottom:32,boxShadow:"var(--shadow-lg)"},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:16},children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{style:{fontSize:36,margin:0,color:"#fff"},children:"\uD83D\uDCE6 Order Management"}),a.jsx("p",{style:{color:"rgba(255,255,255,0.9)",marginTop:8,fontSize:16},children:"Track, process, and manage all orders across platforms"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[a.jsx(x.zx,{onClick:F,disabled:b,variant:"ghost",children:"\uD83D\uDD04 Poll Now"}),a.jsx(x.zx,{onClick:R,variant:"ghost",children:"\uD83D\uDCCA Export CSV"})]})]})}),k&&a.jsx(x.TK,{}),O&&(0,a.jsxs)(x.bZ,{variant:"error",children:[a.jsx("strong",{children:"Failed to load orders"}),a.jsx("p",{style:{marginTop:4},children:"Please try refreshing the page"})]}),!k&&!O&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-4",style:{marginBottom:24},children:[a.jsx(x.Rm,{icon:"\uD83D\uDCE6",label:"Total Orders",value:E.total.toLocaleString(),color:"primary"}),a.jsx(x.Rm,{icon:"✅",label:"Fulfilled",value:E.fulfilled.toLocaleString(),color:"success"}),a.jsx(x.Rm,{icon:"⚠️",label:"Failed",value:E.failed.toLocaleString(),color:"error"}),a.jsx(x.Rm,{icon:"⏳",label:"Pending",value:E.pending.toLocaleString(),color:"warning"})]}),a.jsx("div",{style:{marginBottom:24},children:(0,a.jsxs)(x.Zb,{children:[(0,a.jsxs)("div",{className:"grid grid-2",style:{gap:16,marginBottom:16},children:[a.jsx(x.II,{label:"Search Orders",value:g,onChange:e=>m(e.target.value),placeholder:"Search by Shopee or Amazon order ID..."}),a.jsx(x.Ph,{label:"Filter by Status",value:r,onChange:e=>t(e.target.value),options:[{value:"all",label:"All Orders"},{value:"fulfilled",label:"✅ Fulfilled"},{value:"failed",label:"⚠️ Failed"},{value:"pending",label:"⏳ Pending"}]})]}),z.size>0&&(0,a.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,a.jsxs)("span",{style:{fontSize:14,color:"var(--color-text-muted)"},children:[z.size," order(s) selected"]}),a.jsx(x.zx,{onClick:N,variant:"primary",size:"sm",disabled:b,children:"\uD83D\uDD04 Retry Selected"}),a.jsx(x.zx,{onClick:()=>w(new Set),variant:"ghost",size:"sm",children:"Clear Selection"})]})]})}),L.length>0?(0,a.jsxs)(x.Zb,{children:[a.jsx(x.Ol,{title:"\uD83D\uDCCB Order List",subtitle:`${L.length} orders`}),a.jsx(x.iA,{columns:[{key:"select",header:"",width:"50px",render:e=>a.jsx("input",{type:"checkbox",checked:z.has(e._order.id),onChange:r=>{let t=new Set(z);r.target.checked?t.add(e._order.id):t.delete(e._order.id),w(t)}})},{key:"shopeeOrder",header:"Shopee Order"},{key:"amazonOrder",header:"Amazon Order",width:"180px"},{key:"status",header:"Status",width:"120px"},{key:"mode",header:"Mode",width:"100px"},{key:"errors",header:"Errors",width:"80px"},{key:"date",header:"Updated",width:"130px"},{key:"actions",header:"Actions",width:"220px"}],data:L.map((e,r)=>({_order:e,select:null,shopeeOrder:a.jsx("div",{children:a.jsx("div",{style:{fontWeight:600,fontSize:14},children:e.shopeeOrderSn})}),amazonOrder:e.amazonOrder?.amazonOrderId?a.jsx("div",{style:{fontSize:13},children:a.jsx("code",{children:e.amazonOrder.amazonOrderId})}):a.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:13},children:"—"}),status:U(e.processingStatus),mode:e.processingMode?a.jsx(x.Ct,{variant:"info",children:e.processingMode}):a.jsx("span",{style:{color:"var(--color-text-muted)"},children:"—"}),errors:e.errorItems.length>0?a.jsx(x.Ct,{variant:"error",children:e.errorItems.length}):a.jsx("span",{style:{color:"var(--color-text-muted)"},children:"0"}),date:a.jsx("span",{style:{fontSize:13,color:"var(--color-text-muted)"},children:new Date(e.updatedAt).toLocaleDateString()}),actions:(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[a.jsx(x.zx,{variant:"ghost",size:"sm",onClick:()=>{y(e),f(!0)},children:"View"}),"FAILED"===e.processingStatus&&a.jsx(x.zx,{variant:"warning",size:"sm",onClick:()=>M(e.id),disabled:b,children:"Retry"}),!e.amazonOrder&&a.jsx(x.zx,{variant:"success",size:"sm",onClick:()=>A(e.id),disabled:b,children:"Manual"})]})})),onRowClick:e=>{y(e._order),f(!0)}})]}):a.jsx(x.ub,{icon:"\uD83D\uDCE6",title:"No Orders Found",description:"Try adjusting your filters or search term"})]}),S&&a.jsx(x.u_,{isOpen:v,onClose:()=>{f(!1),y(null)},title:`Order: ${S.shopeeOrderSn}`,size:"lg",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{style:{marginTop:0,marginBottom:12},children:"Order Information"}),(0,a.jsxs)("div",{className:"grid grid-2",style:{gap:16},children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Shopee Order SN"}),a.jsx("div",{style:{fontSize:14},children:a.jsx("code",{children:S.shopeeOrderSn})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Amazon Order ID"}),a.jsx("div",{style:{fontSize:14},children:S.amazonOrder?.amazonOrderId?a.jsx("code",{children:S.amazonOrder.amazonOrderId}):a.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Not available"})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Status"}),a.jsx("div",{children:U(S.processingStatus)})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Processing Mode"}),a.jsx("div",{style:{fontSize:14},children:S.processingMode||a.jsx("span",{style:{color:"var(--color-text-muted)"},children:"—"})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Created At"}),a.jsx("div",{style:{fontSize:14},children:new Date(S.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Updated At"}),a.jsx("div",{style:{fontSize:14},children:new Date(S.updatedAt).toLocaleString()})]})]})]}),S.errorItems.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{style:{marginTop:0,marginBottom:12},children:["Errors (",S.errorItems.length,")"]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:S.errorItems.map((e,r)=>(0,a.jsxs)("div",{style:{padding:16,background:"var(--color-elevated)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-error)"},children:[a.jsx("div",{style:{display:"flex",alignItems:"start",gap:8,marginBottom:8},children:a.jsx(x.Ct,{variant:"error",children:e.errorCode})}),a.jsx("p",{style:{margin:0,fontSize:14},children:e.reason}),e.amazonProductUrl&&a.jsx("a",{href:e.amazonProductUrl,target:"_blank",rel:"noopener noreferrer",style:{fontSize:13,color:"var(--color-primary)",marginTop:8,display:"inline-block"},children:"View Product →"})]},r))})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:["FAILED"===S.processingStatus&&a.jsx(x.zx,{onClick:()=>{M(S.id),f(!1)},variant:"warning",fullWidth:!0,disabled:b,children:"\uD83D\uDD04 Retry Order"}),!S.amazonOrder&&a.jsx(x.zx,{onClick:()=>{A(S.id),f(!1)},variant:"success",fullWidth:!0,disabled:b,children:"✅ Mark as Manual"}),a.jsx(x.zx,{onClick:()=>f(!1),variant:"ghost",fullWidth:!0,children:"Close"})]})]})}),a.jsx(u.Z,{}),a.jsx(h.Z,{pageName:"orders",steps:p.VU,onComplete:()=>i(!1)}),!s&&a.jsx(h.M,{onClick:()=>{}})]})]})}async function S({locale:e}){return{props:{...await (0,i.serverSideTranslations)(e,["common"])}}}s()}catch(e){s(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[332,839,552,754,52,877,438],()=>t(1090));module.exports=s})();