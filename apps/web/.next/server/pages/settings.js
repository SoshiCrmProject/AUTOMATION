"use strict";(()=>{var e={};e.id=662,e.ids=[662,660],e.modules={4806:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>g,default:()=>u,getServerSideProps:()=>x,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>P,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>j});var i=s(8877),r=s(4591),n=s(6021),l=s(552),c=s.n(l),d=s(5270),o=s(8106),p=e([o]);o=(p.then?(await p)():p)[0];let u=(0,n.l)(o,"default"),h=(0,n.l)(o,"getStaticProps"),m=(0,n.l)(o,"getStaticPaths"),x=(0,n.l)(o,"getServerSideProps"),g=(0,n.l)(o,"config"),v=(0,n.l)(o,"reportWebVitals"),j=(0,n.l)(o,"unstable_getStaticProps"),S=(0,n.l)(o,"unstable_getStaticPaths"),y=(0,n.l)(o,"unstable_getStaticParams"),f=(0,n.l)(o,"unstable_getServerProps"),b=(0,n.l)(o,"unstable_getServerSideProps"),P=new i.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/settings",pathname:"/settings",bundlePath:"",filename:""},components:{App:d.default,Document:c()},userland:o});a()}catch(e){a(e)}})},1021:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>d});var i=s(997),r=s(5941),n=s(1522),l=s(1377),c=e([r,n]);[r,n]=c.then?(await c)():c;let o=e=>n.Z.get(e).then(e=>e.data);function d(){let{t:e}=(0,l.useTranslation)("common"),{data:t}=(0,r.default)("/api/settings",o),s=t?.isActive,a=t?.isDryRun;return(0,i.jsxs)("div",{className:"card",children:[i.jsx("h3",{style:{marginTop:0},children:e("automationStatusTitle")}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[i.jsx("span",{className:"pill",style:{background:s?"#bbf7d0":"#fecdd3"},children:e(s?"on":"off")}),i.jsx("span",{className:"pill",style:{background:a?"#e0e7ff":"#e2e8f0"},children:e(a?"pillDryRun":"pillLive")})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:6,marginTop:12,color:"#475569",fontSize:14},children:[i.jsx("div",{children:e("profitRuleLabel",{value:t?.minExpectedProfit??"—"})}),i.jsx("div",{children:e("maxShippingLabel",{value:t?.maxShippingDays??"—"})}),(0,i.jsxs)("div",{children:[e(t?.includeAmazonPoints?"pointsIncluded":"pointsExcluded")," \xb7"," ",e(t?.includeDomesticShipping?"domesticIncluded":"domesticExcluded")]})]})]})}a()}catch(e){a(e)}})},5638:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>d});var i=s(997),r=s(6689),n=s(1522),l=s(1377),c=e([n]);function d(){let{t:e}=(0,l.useTranslation)("common"),[t,s]=(0,r.useState)(null),[a,c]=(0,r.useState)(!1),[d,p]=(0,r.useState)("");return(0,r.useEffect)(()=>{c(!0),n.Z.get("/api/ops/status").then(e=>s(e.data)).catch(t=>p(t?.response?.data?.error??e("genericError"))).finally(()=>c(!1))},[]),(0,i.jsxs)("div",{className:"grid grid-3",children:[a&&i.jsx("p",{children:e("loading")}),d&&i.jsx("p",{style:{color:"#ef4444"},children:d}),!a&&!d&&(0,i.jsxs)(i.Fragment,{children:[i.jsx(o,{title:e("statusShopeePoll"),value:t?.lastOrder?new Date(t.lastOrder).toLocaleString():"—",desc:e("statusLastOrderFetched")}),i.jsx(o,{title:e("statusAmazon"),value:t?.lastAmazon?new Date(t.lastAmazon.createdAt).toLocaleString():"—",desc:t?.lastAmazon?.status||e("statusNoOrders")}),i.jsx(o,{title:e("statusErrors"),value:t?.lastError?new Date(t.lastError.createdAt).toLocaleString():"—",desc:t?.lastError?.reason||e("statusNoRecentErrors")})]})]})}function o({title:e,value:t,desc:s}){return(0,i.jsxs)("div",{className:"card",style:{marginBottom:0},children:[i.jsx("p",{style:{margin:0,color:"#64748b",fontSize:12},children:e}),i.jsx("h3",{style:{margin:"4px 0"},children:t}),i.jsx("p",{style:{margin:0,color:"#475569",fontSize:13},children:s})]})}n=(c.then?(await c)():c)[0],a()}catch(e){a(e)}})},9372:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>u});var i=s(997),r=s(6689),n=s(1377),l=s(5148),c=s(2702),d=s(1522),o=s(7029),p=e([c,d]);function u(){let{t:e}=(0,n.useTranslation)("common"),[t,s]=(0,r.useState)([]),[a,p]=(0,r.useState)({includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:7,minExpectedProfit:0,shopIds:[],isActive:!1,isDryRun:!1,reviewBandPercent:0,overrides:[]}),[u,h]=(0,r.useState)(""),[m,x]=(0,r.useState)([]),[g,v]=(0,r.useState)(""),[j,S]=(0,r.useState)(""),[y,f]=(0,r.useState)(""),[b,P]=(0,r.useState)(!1),[N,D]=(0,r.useState)(!1),C=()=>{d.Z.get("/api/shops").then(e=>s(e.data)),d.Z.get("/api/settings").then(e=>{e.data&&p({includeAmazonPoints:e.data.includeAmazonPoints??!1,includeDomesticShipping:e.data.includeDomesticShipping??!1,domesticShippingCost:e.data.domesticShippingCost??0,maxShippingDays:e.data.maxShippingDays,minExpectedProfit:e.data.minExpectedProfit,shopIds:(e.data.shopSelections??[]).filter(e=>e?.isSelected).map(e=>e.shopId),isActive:e.data.isActive,isDryRun:e.data.isDryRun??!1,reviewBandPercent:e.data.reviewBandPercent??0,overrides:e.data.shopOverrides??[]})}),d.Z.get("/api/credentials/amazon").then(e=>{e.data?.email&&v(e.data.email)})};(0,r.useEffect)(()=>{C()},[]);let k=async s=>{s.preventDefault(),h("");let i=[];if(t.length&&0===a.shopIds.length&&i.push(e("shopSelection")),a.maxShippingDays<=0&&i.push(e("maxShippingDays")),(void 0===a.minExpectedProfit||null===a.minExpectedProfit||Number.isNaN(a.minExpectedProfit))&&i.push(e("minProfit")),i.length){x(i),(0,o.M)(e("fieldRequired"),"error");return}x([]),P(!0);try{await d.Z.post("/api/settings",a),h(e("saved")),(0,o.M)(e("settingsSaveSuccess"))}catch(s){let t=s?.response?.data?.error??e("settingsSaveError");h(t),(0,o.M)(t,"error")}finally{P(!1)}},T=async()=>{D(!0);try{await d.Z.post("/api/credentials/amazon",{email:g,password:j}),S(""),f(e("saved")),(0,o.M)(e("credentialsSaveSuccess"))}catch(s){let t=s?.response?.data?.error??e("credentialsSaveError");f(t),(0,o.M)(t,"error")}finally{D(!1)}},w=(e,t)=>e.find(e=>e.shopId===t.shopId)?e.map(e=>e.shopId===t.shopId?{...e,...t}:e):[...e,t];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("form",{onSubmit:k,children:[(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["① ",e("autoOrdering")]}),i.jsx("p",{children:e("autoOrderingDesc")}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:a.isActive,onChange:e=>p({...a,isActive:e.currentTarget.checked})})," ",a.isActive?e("on"):e("off")]})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["③ ",e("includePoints")]}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:a.includeAmazonPoints,onChange:e=>p({...a,includeAmazonPoints:e.currentTarget.checked})})," ",e("includePointsLabel")]})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["④ ",e("includeDomestic")]}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:a.includeDomesticShipping,onChange:e=>p({...a,includeDomesticShipping:e.target.checked})})," ",e("includeDomesticLabel")]}),i.jsx("input",{className:"input",type:"number",value:a.domesticShippingCost,onChange:e=>p({...a,domesticShippingCost:Number(e.currentTarget.value)}),placeholder:e("domesticShippingCost")})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["⑤ ",e("maxShippingDays")]}),i.jsx("input",{className:"input",type:"number",value:a.maxShippingDays,onChange:e=>p({...a,maxShippingDays:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["⑥ ",e("minProfit")]}),i.jsx("input",{className:"input",type:"number",value:a.minExpectedProfit,onChange:e=>p({...a,minExpectedProfit:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("div",{className:"card",children:[i.jsx("h3",{children:e("dryRun")}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:a.isDryRun,onChange:e=>p({...a,isDryRun:e.currentTarget.checked})})," ",e("dryRunDesc")]})]}),(0,i.jsxs)("div",{className:"card",children:[i.jsx("h3",{children:e("reviewBand")}),i.jsx("p",{style:{color:"#475569"},children:e("reviewBandDesc")}),i.jsx("input",{className:"input",type:"number",min:0,max:100,value:a.reviewBandPercent,onChange:e=>p({...a,reviewBandPercent:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("h3",{children:["⑦ ",e("shopSelection")]}),i.jsx(l.Z,{shops:t,selected:a.shopIds,onToggle:e=>{p(t=>({...t,shopIds:t.shopIds.includes(e)?t.shopIds.filter(t=>t!==e):[...t.shopIds,e]}))}})]}),(0,i.jsxs)("div",{className:"card",children:[i.jsx("h3",{children:e("shopOverrides")}),i.jsx("p",{style:{color:"#475569"},children:e("shopOverridesDesc")}),t.map(t=>{let s=a.overrides.find(e=>e.shopId===t.id);return(0,i.jsxs)("div",{style:{marginBottom:12,padding:12,border:"1px solid #e2e8f0",borderRadius:10},children:[i.jsx("strong",{children:t.name}),(0,i.jsxs)("div",{className:"grid grid-3",children:[i.jsx("input",{className:"input",placeholder:e("maxShippingDays"),type:"number",value:s?.maxShippingDays??"",onChange:e=>p(s=>({...s,overrides:w(s.overrides,{shopId:t.id,maxShippingDays:e.currentTarget.value?Number(e.currentTarget.value):void 0})}))}),i.jsx("input",{className:"input",placeholder:e("minProfit"),type:"number",value:s?.minExpectedProfit??"",onChange:e=>p(s=>({...s,overrides:w(s.overrides,{shopId:t.id,minExpectedProfit:e.currentTarget.value?Number(e.currentTarget.value):void 0})}))}),i.jsx("input",{className:"input",placeholder:e("domesticShippingCost"),type:"number",value:s?.domesticShippingCost??"",onChange:e=>p(s=>({...s,overrides:w(s.overrides,{shopId:t.id,domesticShippingCost:e.currentTarget.value?Number(e.currentTarget.value):void 0})}))})]}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:s?.includeAmazonPoints??a.includeAmazonPoints,onChange:e=>p(s=>({...s,overrides:w(s.overrides,{shopId:t.id,includeAmazonPoints:e.currentTarget.checked})}))})," ",e("includePointsLabel")]}),i.jsx("br",{}),(0,i.jsxs)("label",{children:[i.jsx("input",{type:"checkbox",checked:s?.includeDomesticShipping??a.includeDomesticShipping,onChange:e=>p(s=>({...s,overrides:w(s.overrides,{shopId:t.id,includeDomesticShipping:e.currentTarget.checked})}))})," ",e("includeDomesticLabel")]})]},t.id)})]}),i.jsx("button",{className:"button",type:"submit",children:b?e("loading"):e("saveActivate")}),u&&i.jsx("p",{children:u}),m.length>0&&i.jsx("ul",{style:{color:"#b91c1c"},children:m.map(e=>i.jsx("li",{children:e},e))})]}),i.jsx(c.Z,{onConnected:C}),(0,i.jsxs)("div",{className:"card",style:{marginTop:"16px"},children:[i.jsx("h3",{children:e("amazonCredentials")}),i.jsx("input",{className:"input",type:"email",placeholder:e("amazonEmail"),value:g,onChange:e=>v(e.target.value),required:!0}),i.jsx("input",{className:"input",type:"password",placeholder:e("amazonPassword"),value:j,onChange:e=>S(e.target.value),required:!0}),i.jsx("button",{className:"button",type:"button",onClick:T,children:N?e("loading"):e("saveCredentials")}),y&&i.jsx("p",{children:y})]})]})}[c,d]=p.then?(await p)():p,a()}catch(e){a(e)}})},5148:(e,t,s)=>{s.d(t,{Z:()=>i});var a=s(997);function i({shops:e,selected:t,onToggle:s}){return a.jsx("div",{children:e.map(e=>(0,a.jsxs)("label",{style:{display:"block",marginBottom:"6px"},children:[a.jsx("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>s(e.id)})," ",e.name]},e.id))})}},2702:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>o});var i=s(997),r=s(6689),n=s(9648),l=s(1377),c=s(7029),d=e([n]);function o({onConnected:e}){let{t}=(0,l.useTranslation)("common"),[s,a]=(0,r.useState)(""),[d,o]=(0,r.useState)(""),[p,u]=(0,r.useState)(""),[h,m]=(0,r.useState)("https://partner.shopeemobile.com"),[x,g]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[S,y]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[P,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=localStorage.getItem("token"),s={Authorization:`Bearer ${e}`};N(!0),n.default.get("/api/credentials/shopee",{headers:s}).then(e=>{e.data.partnerId&&a(e.data.partnerId),e.data.baseUrl&&m(e.data.baseUrl)}).catch(e=>(0,c.M)(e?.response?.data?.error??t("genericError"),"error")).finally(()=>N(!1))},[]);let D=async()=>{let a=localStorage.getItem("token");b(!0);try{await n.default.post("/api/credentials/shopee",{partnerId:s,partnerKey:d,accessToken:p,baseUrl:h,shopId:x,shopName:v},{headers:{Authorization:`Bearer ${a}`}}),o(""),u(""),y(t("saved")),(0,c.M)(t("shopeeSaveSuccess")),e?.()}catch(s){let e=s?.response?.data?.error??t("shopeeSaveError");y(e),(0,c.M)(e,"error")}finally{b(!1)}};return(0,i.jsxs)("div",{className:"card",children:[i.jsx("h3",{children:t("connectShopee")}),i.jsx("input",{className:"input",placeholder:t("partnerId"),value:s,onChange:e=>a(e.target.value)}),i.jsx("input",{className:"input",placeholder:t("partnerKey"),type:"password",value:d,onChange:e=>o(e.target.value)}),i.jsx("input",{className:"input",placeholder:t("accessToken"),type:"password",value:p,onChange:e=>u(e.target.value)}),i.jsx("input",{className:"input",placeholder:t("baseUrl"),value:h,onChange:e=>m(e.target.value)}),i.jsx("input",{className:"input",placeholder:t("shopId"),value:x,onChange:e=>g(e.target.value)}),i.jsx("input",{className:"input",placeholder:t("shopName"),value:v,onChange:e=>j(e.target.value)}),i.jsx("button",{className:"button",type:"button",onClick:D,children:f?t("loading"):t("saveCredentials")}),S&&i.jsx("p",{children:S}),P&&i.jsx("p",{children:t("loading")})]})}n=(d.then?(await d)():d)[0],a()}catch(e){a(e)}})},8106:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>u,getStaticProps:()=>h});var i=s(997),r=s(5460),n=s(1377),l=s(9372),c=s(5638),d=s(2684),o=s(1021),p=e([l,c,o]);function u(){let{t:e}=(0,n.useTranslation)("common");return(0,i.jsxs)("div",{className:"container",children:[i.jsx(d.Z,{activeHref:"/settings"}),i.jsx("h1",{children:e("autoShipping")}),(0,i.jsxs)("div",{className:"card",style:{marginBottom:16,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[i.jsx("p",{style:{marginTop:0,color:"#0f172a",fontWeight:700},children:e("instrNote")}),(0,i.jsxs)("ol",{style:{color:"#475569",lineHeight:1.5,paddingLeft:18},children:[i.jsx("li",{children:e("instr1")}),i.jsx("li",{children:e("instr2")}),i.jsx("li",{children:e("instr3")}),i.jsx("li",{children:e("instr4")}),i.jsx("li",{children:e("instr5")}),i.jsx("li",{children:e("instr6")}),i.jsx("li",{children:e("instr7")}),i.jsx("li",{children:e("instr8")})]}),i.jsx("p",{style:{color:"#0f172a",fontWeight:600},children:e("instrNote2")})]}),i.jsx(c.Z,{}),i.jsx("div",{style:{marginTop:12},children:i.jsx(o.Z,{})}),i.jsx(l.Z,{})]})}async function h({locale:e}){return{props:{...await (0,r.serverSideTranslations)(e,["common"])}}}[l,c,o]=p.then?(await p)():p,a()}catch(e){a(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[332,839,552,754,52],()=>s(4806));module.exports=a})();