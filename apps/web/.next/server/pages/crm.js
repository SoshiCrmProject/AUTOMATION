"use strict";(()=>{var e={};e.id=801,e.ids=[801,660],e.modules={6344:(e,t,l)=>{l.a(e,async(e,r)=>{try{l.r(t),l.d(t,{config:()=>y,default:()=>x,getServerSideProps:()=>m,getStaticPaths:()=>p,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>S,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>f,unstable_getStaticParams:()=>D,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>g});var a=l(8877),s=l(4591),i=l(6021),n=l(552),o=l.n(n),c=l(5270),d=l(8431),u=e([d]);d=(u.then?(await u)():u)[0];let x=(0,i.l)(d,"default"),h=(0,i.l)(d,"getStaticProps"),p=(0,i.l)(d,"getStaticPaths"),m=(0,i.l)(d,"getServerSideProps"),y=(0,i.l)(d,"config"),v=(0,i.l)(d,"reportWebVitals"),g=(0,i.l)(d,"unstable_getStaticProps"),j=(0,i.l)(d,"unstable_getStaticPaths"),D=(0,i.l)(d,"unstable_getStaticParams"),b=(0,i.l)(d,"unstable_getServerProps"),f=(0,i.l)(d,"unstable_getServerSideProps"),S=new a.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/crm",pathname:"/crm",bundlePath:"",filename:""},components:{App:c.default,Document:o()},userland:d});r()}catch(e){r(e)}})},8431:(e,t,l)=>{l.a(e,async(e,r)=>{try{l.r(t),l.d(t,{default:()=>y,getStaticProps:()=>v});var a=l(997),s=l(6689),i=l(5941),n=l(5460),o=l(1377),c=l(1522),d=l(6555),u=l(3688),x=l(1935),h=l(4202),p=l(7029),m=e([i,c]);[i,c]=m.then?(await m)():m;let g=e=>c.Z.get(e).then(e=>e.data);function y(){let{t:e}=(0,o.useTranslation)("common"),[t,l]=(0,s.useState)(""),[r,n]=(0,s.useState)(!1),[m,y]=(0,s.useState)(""),[v,j]=(0,s.useState)("all"),[D,b]=(0,s.useState)(null),[f,S]=(0,s.useState)(!1),[C,P]=(0,s.useState)(!1),[w,T]=(0,s.useState)(!1),[I,z]=(0,s.useState)("info"),[k,L]=(0,s.useState)("INQUIRY"),[N,E]=(0,s.useState)(""),[B,R]=(0,s.useState)("BRONZE"),[A,M]=(0,s.useState)(""),[O,F]=(0,s.useState)(!1),{data:W,mutate:Z}=(0,i.default)(t?`/api/crm/${t}`:null,g),{data:U}=(0,i.default)(t?`/api/crm/stats/${t}`:null,g),{data:$}=(0,i.default)(D?`/api/crm/${D.id}/interactions`:null,g),{data:_}=(0,i.default)(D?`/api/crm/${D.id}/loyalty`:null,g),q=!W&&t,V=(Array.isArray(W)?W:[]).filter(e=>{let t="all"===v||e.loyaltyTier===v,l=!m||e.name.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase());return t&&l}),G=async()=>{if(!D||!N.trim()){(0,p.M)("Please fill in all required fields","error");return}F(!0);try{await c.Z.post(`/api/crm/${D.id}/interactions`,{type:k,description:N}),(0,p.M)("Interaction added successfully","success"),P(!1),E("")}catch(e){(0,p.M)(e.response?.data?.error||"Failed to add interaction","error")}finally{F(!1)}},H=async e=>{F(!0);try{await c.Z.post(`/api/crm/interactions/${e}/resolve`),(0,p.M)("Interaction resolved","success")}catch(e){(0,p.M)(e.response?.data?.error||"Failed to resolve interaction","error")}finally{F(!1)}},Q=async()=>{if(!D||!A.trim()){(0,p.M)("Please provide a reason","error");return}F(!0);try{await c.Z.post(`/api/crm/${D.id}/loyalty`,{newTier:B,reason:A}),(0,p.M)("Loyalty tier updated","success"),T(!1),M(""),Z()}catch(e){(0,p.M)(e.response?.data?.error||"Failed to update loyalty","error")}finally{F(!1)}},Y=async(e,t)=>{F(!0);try{let l=t?`/api/crm/${e}/blacklist`:`/api/crm/${e}/unblacklist`;await c.Z.post(l),(0,p.M)(`Customer ${t?"blacklisted":"unblacklisted"} successfully`,"success"),Z()}catch(e){(0,p.M)(e.response?.data?.error||"Failed to update customer status","error")}finally{F(!1)}},K=e=>{switch(e){case"PLATINUM":return"var(--color-secondary)";case"GOLD":return"#f59e0b";case"SILVER":return"#94a3b8";case"BRONZE":return"#a16207";default:return"var(--color-text-muted)"}},X=e=>{switch(e){case"PLATINUM":return"\uD83D\uDC8E";case"GOLD":return"\uD83E\uDD47";case"SILVER":return"\uD83E\uDD48";case"BRONZE":return"\uD83E\uDD49";default:return"\uD83D\uDC64"}},J=e=>{switch(e){case"PURCHASE":return"\uD83D\uDED2";case"SUPPORT":return"\uD83C\uDFA7";case"COMPLAINT":return"⚠️";case"REFUND":return"\uD83D\uDCB8";case"INQUIRY":return"❓";default:return"\uD83D\uDCDD"}};return(0,a.jsxs)("div",{className:"shell",children:[a.jsx(d.Z,{activeHref:"/crm"}),(0,a.jsxs)("div",{className:"container",children:[a.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"48px 32px",borderRadius:"var(--radius-xl)",marginBottom:32,boxShadow:"var(--shadow-lg)"},children:a.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,a.jsxs)("div",{children:[a.jsx("h1",{style:{fontSize:36,margin:0,color:"#fff"},children:"\uD83D\uDC65 Customer Relationship Management"}),a.jsx("p",{style:{color:"rgba(255,255,255,0.9)",marginTop:8,fontSize:16},children:"Build relationships, track loyalty, and maximize customer lifetime value"})]})})}),a.jsx("div",{style:{marginBottom:24},children:a.jsx(h.Zb,{children:a.jsx(h.II,{label:"Shop ID",value:t,onChange:e=>l(e.target.value),placeholder:e("enterShopIDPlaceholder")})})}),!t&&(0,a.jsxs)(h.bZ,{variant:"info",children:[a.jsx("strong",{children:"Get Started"}),a.jsx("p",{style:{marginTop:4},children:"Enter your Shop ID above to view customer data"})]}),q&&a.jsx(h.TK,{}),t&&U&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-4",style:{marginBottom:24},children:[a.jsx(h.Rm,{icon:"\uD83D\uDC65",label:"Total Customers",value:U.totalCustomers.toLocaleString(),color:"primary"}),a.jsx(h.Rm,{icon:"\uD83D\uDCB0",label:"Avg Lifetime Value",value:`$${U.avgLifetimeValue.toFixed(2)}`,color:"success"}),a.jsx(h.Rm,{icon:"\uD83D\uDC8E",label:"Platinum Members",value:(U.loyaltyDistribution.PLATINUM||0).toString(),color:"info"}),a.jsx(h.Rm,{icon:"\uD83D\uDEAB",label:"Blacklisted",value:U.blacklistedCount.toString(),color:"error"})]}),a.jsx("div",{style:{marginBottom:24},children:(0,a.jsxs)(h.Zb,{children:[a.jsx(h.Ol,{title:"\uD83C\uDFC6 Loyalty Tier Distribution"}),a.jsx("div",{className:"grid grid-4",style:{gap:16},children:Object.entries(U.loyaltyDistribution).map(([e,t])=>(0,a.jsxs)("div",{style:{padding:20,background:"var(--color-elevated)",borderRadius:"var(--radius-lg)",textAlign:"center",border:"2px solid var(--color-border)"},children:[a.jsx("div",{style:{fontSize:36,marginBottom:8},children:X(e)}),a.jsx("div",{style:{fontSize:13,color:"var(--color-text-muted)",marginBottom:4,fontWeight:600},children:e}),a.jsx("div",{style:{fontSize:24,fontWeight:700,color:K(e)},children:t})]},e))})]})}),a.jsx("div",{style:{marginBottom:24},children:a.jsx(h.Zb,{children:(0,a.jsxs)("div",{className:"grid grid-2",style:{gap:16},children:[a.jsx(h.II,{label:"Search Customers",value:m,onChange:e=>y(e.target.value),placeholder:e("searchByNameOrEmail")}),a.jsx(h.Ph,{label:"Filter by Tier",value:v,onChange:e=>j(e.target.value),options:[{value:"all",label:"All Tiers"},{value:"PLATINUM",label:"\uD83D\uDC8E Platinum"},{value:"GOLD",label:"\uD83E\uDD47 Gold"},{value:"SILVER",label:"\uD83E\uDD48 Silver"},{value:"BRONZE",label:"\uD83E\uDD49 Bronze"}]})]})})}),"            ",V.length>0?(0,a.jsxs)(h.Zb,{children:[a.jsx(h.Ol,{title:"\uD83D\uDCCB Customer List",subtitle:`${V.length} customers`}),a.jsx(h.iA,{columns:[{key:"customer",header:"Customer"},{key:"tier",header:"Tier",width:"140px"},{key:"orders",header:"Orders",width:"100px"},{key:"ltv",header:"Lifetime Value",width:"140px"},{key:"lastPurchase",header:"Last Purchase",width:"130px"},{key:"status",header:"Status",width:"120px"},{key:"actions",header:"Actions",width:"140px"}],data:V.map(e=>({_customer:e,customer:(0,a.jsxs)("div",{children:[a.jsx("div",{style:{fontWeight:600},children:e.name}),a.jsx("div",{style:{fontSize:13,color:"var(--color-text-muted)"},children:e.email})]}),tier:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:20},children:X(e.loyaltyTier)}),a.jsx("span",{style:{fontWeight:600,color:K(e.loyaltyTier)},children:e.loyaltyTier})]}),orders:a.jsx(h.Ct,{variant:"info",children:e.totalOrders}),ltv:(0,a.jsxs)("span",{style:{color:"var(--color-success)",fontWeight:600},children:["$",e.lifetimeValue.toLocaleString(void 0,{minimumFractionDigits:2})]}),lastPurchase:a.jsx("span",{style:{fontSize:13,color:"var(--color-text-muted)"},children:new Date(e.lastPurchase).toLocaleDateString()}),status:e.isBlacklisted?a.jsx(h.Ct,{variant:"error",children:"Blacklisted"}):a.jsx(h.Ct,{variant:"success",children:"Active"}),actions:a.jsx(h.zx,{variant:"ghost",size:"sm",onClick:()=>{b(e),S(!0)},children:"View Details"})})),onRowClick:e=>{b(e._customer),S(!0)}})]}):a.jsx(h.ub,{icon:"\uD83D\uDC65",title:e("noCustomersFound"),description:e("descriptionAdjustFilters")})]}),D&&(0,a.jsxs)(h.u_,{isOpen:f,onClose:()=>{S(!1),b(null)},title:`Customer: ${D.name}`,size:"lg",children:[a.jsx(h.mQ,{defaultTab:I,onChange:z,tabs:[{id:"info",label:"Info",icon:"\uD83D\uDC64",content:a.jsx(a.Fragment,{})},{id:"interactions",label:"Interactions",icon:"\uD83D\uDCAC",badge:$?.length,content:a.jsx(a.Fragment,{})},{id:"loyalty",label:"Loyalty",icon:"\uD83C\uDFC6",content:a.jsx(a.Fragment,{})}]}),"info"===I&&(0,a.jsxs)("div",{style:{marginTop:24},children:[(0,a.jsxs)("div",{className:"grid grid-2",style:{gap:16,marginBottom:24},children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Email"}),a.jsx("div",{style:{fontSize:15,color:"var(--color-text)"},children:D.email})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Phone"}),a.jsx("div",{style:{fontSize:15,color:"var(--color-text)"},children:D.phone||"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Total Orders"}),a.jsx("div",{style:{fontSize:15,color:"var(--color-text)"},children:D.totalOrders})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Lifetime Value"}),(0,a.jsxs)("div",{style:{fontSize:15,color:"var(--color-success)",fontWeight:600},children:["$",D.lifetimeValue.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Loyalty Tier"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:20},children:X(D.loyaltyTier)}),a.jsx("span",{style:{fontSize:15,fontWeight:600,color:K(D.loyaltyTier)},children:D.loyaltyTier})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Member Since"}),a.jsx("div",{style:{fontSize:15,color:"var(--color-text)"},children:new Date(D.createdAt).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[a.jsx(h.zx,{onClick:()=>T(!0),variant:"primary",fullWidth:!0,children:"Update Loyalty Tier"}),a.jsx(h.zx,{onClick:()=>Y(D.id,!D.isBlacklisted),variant:D.isBlacklisted?"success":"danger",fullWidth:!0,children:D.isBlacklisted?"Unblacklist":"Blacklist"})]})]}),"interactions"===I&&(0,a.jsxs)("div",{style:{marginTop:24},children:[(0,a.jsxs)(h.zx,{onClick:()=>P(!0),variant:"primary",fullWidth:!0,style:{marginBottom:16},children:["+ ",e("addInteraction")]}),$&&$.length>0?a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:$.map(e=>(0,a.jsxs)("div",{style:{padding:16,background:"var(--color-elevated)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:20},children:J(e.type)}),a.jsx(h.Ct,{variant:e.resolved?"success":"warning",children:e.type})]}),a.jsx("span",{style:{fontSize:13,color:"var(--color-text-muted)"},children:new Date(e.createdAt).toLocaleDateString()})]}),a.jsx("p",{style:{margin:"8px 0",fontSize:14},children:e.description}),!e.resolved&&a.jsx(h.zx,{variant:"success",size:"sm",onClick:()=>H(e.id),disabled:O,children:"Mark Resolved"})]},e.id))}):a.jsx(h.ub,{icon:"\uD83D\uDCAC",title:e("noInteractions"),description:e("addFirstInteraction")})]}),"loyalty"===I&&a.jsx("div",{style:{marginTop:24},children:_&&_.length>0?a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:_.map(e=>(0,a.jsxs)("div",{style:{padding:16,background:"var(--color-elevated)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:16},children:X(e.previousTier)}),a.jsx("span",{style:{color:K(e.previousTier),fontWeight:600},children:e.previousTier}),a.jsx("span",{style:{margin:"0 8px",color:"var(--color-text-muted)"},children:"→"}),a.jsx("span",{style:{fontSize:16},children:X(e.newTier)}),a.jsx("span",{style:{color:K(e.newTier),fontWeight:600},children:e.newTier})]}),a.jsx("span",{style:{fontSize:13,color:"var(--color-text-muted)"},children:new Date(e.createdAt).toLocaleDateString()})]}),a.jsx("p",{style:{margin:0,fontSize:14,color:"var(--color-text-muted)"},children:e.reason})]},e.id))}):a.jsx(h.ub,{icon:"\uD83C\uDFC6",title:e("noLoyaltyHistory"),description:e("loyaltyChangesAppear")})})]}),a.jsx(h.u_,{isOpen:C,onClose:()=>{P(!1),E("")},title:e("addCustomerInteraction"),children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[a.jsx(h.Ph,{label:"Interaction Type",value:k,onChange:e=>L(e.target.value),options:[{value:"PURCHASE",label:"\uD83D\uDED2 Purchase"},{value:"SUPPORT",label:"\uD83C\uDFA7 Support"},{value:"COMPLAINT",label:"⚠️ Complaint"},{value:"REFUND",label:"\uD83D\uDCB8 Refund"},{value:"INQUIRY",label:"❓ Inquiry"}]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Description"}),a.jsx("textarea",{className:"input",value:N,onChange:e=>E(e.target.value),placeholder:e("describeInteraction"),rows:4,style:{width:"100%",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[a.jsx(h.zx,{onClick:G,variant:"primary",fullWidth:!0,disabled:O,children:e("addInteraction")}),a.jsx(h.zx,{onClick:()=>P(!1),variant:"ghost",fullWidth:!0,children:e("cancel")})]})]})}),a.jsx(h.u_,{isOpen:w,onClose:()=>{T(!1),M("")},title:e("updateLoyaltyTier"),children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[a.jsx(h.Ph,{label:"New Tier",value:B,onChange:e=>R(e.target.value),options:[{value:"BRONZE",label:"\uD83E\uDD49 Bronze"},{value:"SILVER",label:"\uD83E\uDD48 Silver"},{value:"GOLD",label:"\uD83E\uDD47 Gold"},{value:"PLATINUM",label:"\uD83D\uDC8E Platinum"}]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:"Reason"}),a.jsx("textarea",{className:"input",value:A,onChange:e=>M(e.target.value),placeholder:e("whyTierChanged"),rows:3,style:{width:"100%",resize:"vertical"}})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[a.jsx(h.zx,{onClick:Q,variant:"primary",fullWidth:!0,disabled:O,children:"Update Tier"}),a.jsx(h.zx,{onClick:()=>T(!1),variant:"ghost",fullWidth:!0,children:"Cancel"})]})]})}),a.jsx(p.Z,{}),a.jsx(u.Z,{pageName:"crm",steps:x.GS,onComplete:()=>n(!1)}),!r&&a.jsx(u.M,{onClick:()=>{}})]})]})}async function v({locale:e}){return{props:{...await (0,n.serverSideTranslations)(e,["common"])}}}r()}catch(e){r(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9816:e=>{e.exports=require("styled-jsx/style")},9648:e=>{e.exports=import("axios")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var l=e=>t(t.s=e),r=t.X(0,[332,839,552,754,107,202,438],()=>l(6344));module.exports=r})();