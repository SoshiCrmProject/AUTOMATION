(()=>{var e={};e.id=679,e.ids=[679,888,660,52],e.modules={1752:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>x,default:()=>u,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>h,reportWebVitals:()=>f,routeModule:()=>P,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>v});var a=s(8877),i=s(4591),n=s(6021),o=s(552),l=s.n(o),d=s(5270),p=s(760),c=e([p]);p=(c.then?(await c)():c)[0];let u=(0,n.l)(p,"default"),h=(0,n.l)(p,"getStaticProps"),m=(0,n.l)(p,"getStaticPaths"),g=(0,n.l)(p,"getServerSideProps"),x=(0,n.l)(p,"config"),f=(0,n.l)(p,"reportWebVitals"),v=(0,n.l)(p,"unstable_getStaticProps"),S=(0,n.l)(p,"unstable_getStaticPaths"),b=(0,n.l)(p,"unstable_getStaticParams"),j=(0,n.l)(p,"unstable_getServerProps"),y=(0,n.l)(p,"unstable_getServerSideProps"),P=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/mappings",pathname:"/mappings",bundlePath:"",filename:""},components:{App:d.default,Document:l()},userland:p});r()}catch(e){r(e)}})},2684:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var r=s(997),a=s(9097),i=s.n(a),n=s(1297),o=s(1377),l=s(6689);function d({activeHref:e}){let{t}=(0,o.useTranslation)("common"),[s,a]=(0,l.useState)(!1);(0,l.useEffect)(()=>{},[]);let d=[{href:"/",label:t("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:t("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:t("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:t("navSettings"),icon:"⚙️"},{href:"/errors",label:t("navErrors"),icon:"⚠️"},{href:"/review",label:t("navReview"),icon:"✅"},{href:"/ops",label:t("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:t("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:t("navAdmin"),icon:"\uD83D\uDC64"}];return(0,r.jsxs)("header",{className:"nav",children:[r.jsx("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,r.jsxs)("div",{className:"nav-links",children:[d.map(t=>(0,r.jsxs)(i(),{href:t.href,style:{fontWeight:t.href===e?700:500,color:t.href===e?"var(--color-text)":"var(--color-text-muted)",background:t.href===e?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[r.jsx("span",{children:t.icon}),t.label]},t.href)),!s&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(i(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===e?700:500,marginLeft:8},children:t("login")}),r.jsx(i(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===e?700:500},children:t("signup")})]}),r.jsx(n.Z,{})]})]})}},1297:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(997),a=s(5632),i=s(1377);function n(){let e=(0,a.useRouter)(),{t}=(0,i.useTranslation)("common"),{locale:s,pathname:n,asPath:o,query:l}=e,d="en"===s?"ja":"en",p=t("en"===d?"langEnglish":"langJapanese"),c=t("en"===d?"langEnglishShort":"langJapaneseShort");return r.jsx("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:n,query:l},o,{locale:d}),"aria-label":t("switchLanguage",{lang:p}),children:c})}},7029:(e,t,s)=>{"use strict";s.d(t,{M:()=>o,Z:()=>l});var r=s(997),a=s(6689),i=s(1377);let n=null;function o(e,t="success"){n&&n(e,t)}function l(){let{t:e}=(0,i.useTranslation)("common"),[t,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>(n=(e,t="success")=>{let r=Date.now();s(s=>[...s,{message:e,type:t,id:r}]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==r))},4e3)},()=>{n=null}),[]),r.jsx("div",{style:{position:"fixed",top:20,right:20,display:"grid",gap:8,zIndex:9999},children:t.map(t=>(0,r.jsxs)("div",{className:"card",style:{minWidth:240,borderLeft:`4px solid ${"error"===t.type?"#f87171":"#22c55e"}`,background:"rgba(15,23,42,0.9)"},role:"status","aria-live":"polite",children:[r.jsx("strong",{children:"error"===t.type?e("toastError"):e("toastSuccess")}),r.jsx("p",{style:{margin:0,color:"#cbd5e1"},children:t.message})]},t.id))})}},1522:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{Z:()=>l});var a=s(9648),i=e([a]);let n=(a=(i.then?(await i)():i)[0]).default.create(),o=n.defaults.adapter;if(n.interceptors.request.use(e=>e),"1"===process.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async s=>{let r=(s.url||"").replace(/^https?:\/\/[^/]+/,""),a=(s.method||"get").toLowerCase(),i=(e,t=200)=>Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:s});if("/api/auth/login"===r&&"post"===a||"/api/auth/signup"===r&&"post"===a)return i({token:"mock-token"});if("/api/shops"===r&&"get"===a)return i(e.shops);if("/api/credentials/shopee"===r&&"get"===a)return i(e.shopeeCred);if("/api/credentials/shopee"===r&&"post"===a)return e.shopeeCred={...s.data},i({success:!0});if("/api/credentials/amazon"===r&&"get"===a)return i(e.amazonCred);if("/api/credentials/amazon"===r&&"post"===a)return e.amazonCred={...s.data},i({success:!0});if("/api/settings"===r&&"get"===a)return i(e.settings);if("/api/settings"===r&&"post"===a)return e.settings={...s.data,shopSelections:e.settings.shopSelections},i({success:!0});if("/api/orders/recent"===r&&"get"===a)return i(e.orders);if("/api/orders/errors"===r&&"get"===a){let t=e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt})));return i(t)}if(r.startsWith("/api/orders/")&&r.endsWith("/retry")&&"post"===a||r.startsWith("/api/orders/retry/")&&"post"===a||r.startsWith("/api/orders/manual/")&&"post"===a||"/api/orders/poll-now"===r&&"post"===a)return i({success:!0});if("/api/orders/errors/export"===r&&"get"===a)return i("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===r&&"get"===a)return i("orderNumber,status\nSP-002,Processed",200);if(r.startsWith("/api/orders/")&&"get"===a){let t=r.split("/").pop(),s=e.orders.find(e=>e.id===t);return i(s||e.orders[0])}if("/api/ops/queue"===r&&"get"===a)return i({waiting:0,active:0,failed:0,delayed:0});if("/api/ops/amazon-test"===r&&"post"===a)return i({success:!0});if("/api/ops/status"===r&&"get"===a)return i({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}});if("/api/mappings"===r&&"get"===a)return i(e.mappings);if("/api/mappings"===r&&"post"===a)return e.mappings.push({id:`map-${Date.now()}`,...s.data||{}}),i({success:!0});if("/api/mappings/import"===r&&"post"===a||"/api/products/shopee"===r&&"post"===a||"/api/products/amazon"===r&&"post"===a)return i({success:!0});if("/api/products/shopee"===r&&"get"===a){let t=e.mappings.map(e=>e.shopeeProduct);return i(t)}if("/api/products/amazon"===r&&"get"===a){let t=e.mappings.map(e=>e.amazonProduct);return i(t)}return"/api/admin/users"===r&&"get"===a?i(e.adminUsers):r.includes("/api/admin/users/")&&r.endsWith("/toggle")&&"post"===a||r.includes("/api/admin/users/")&&r.endsWith("/reset-password")&&"post"===a?i({success:!0}):"/api/admin/audit"===r&&"get"===a?i(e.audit):o&&"function"==typeof o?o(s):i({},404)}}n.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let l=n;r()}catch(e){r(e)}})},6768:e=>{"use strict";e.exports={i18n:{defaultLocale:"en",locales:["en","ja"]},reloadOnPrerender:!1}},5270:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(997),a=s(1377),i=s(5237),n=s.n(i),o=s(5632);s(5748);var l=s(7029),d=s(6768),p=s.n(d);let c=n()(()=>s.e(272).then(s.bind(s,8272)),{loadableGenerated:{modules:["_app.tsx -> ../components/OnboardingModal"]},ssr:!1,loading:()=>null}),u=(0,a.appWithTranslation)(function({Component:e,pageProps:t}){let s=(0,o.useRouter)().pathname||"",a=s.startsWith("/login")||s.startsWith("/signup");return(0,r.jsxs)("div",{className:"shell",children:[r.jsx(e,{...t}),!a&&r.jsx(c,{}),r.jsx(l.Z,{})]})},p())},760:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>u,getStaticProps:()=>h});var a=s(997),i=s(6689),n=s(5460),o=s(1377),l=s(2684),d=s(1522),p=s(7029),c=e([d]);function u(){let{t:e}=(0,o.useTranslation)("common"),[t,s]=(0,i.useState)([]),[r,n]=(0,i.useState)([]),[c,u]=(0,i.useState)(""),[h,m]=(0,i.useState)(""),[g,x]=(0,i.useState)(""),[f,v]=(0,i.useState)(""),[S,b]=(0,i.useState)(""),[j,y]=(0,i.useState)(""),[P,D]=(0,i.useState)(""),[N,C]=(0,i.useState)(!1),[I,z]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),A=async()=>{C(!0);try{let[e,t]=await Promise.all([d.Z.get("/api/shops"),d.Z.get("/api/mappings")]);n(e.data||[]),s(t.data||[])}catch(t){(0,p.M)(t?.response?.data?.error??e("genericError"),"error")}finally{C(!1)}};(0,i.useEffect)(()=>{A()},[]);let T=async()=>{if(b(""),!c||!h||!g){(0,p.M)(e("fieldRequired"),"error");return}z(!0);try{await d.Z.post("/api/mappings",{shopId:c,shopeeItemId:h,amazonProductUrl:g,notes:f||void 0}),u(""),m(""),x(""),v(""),b(e("mappingSaved")),(0,p.M)(e("mappingSaved")),A()}catch(t){(0,p.M)(t?.response?.data?.error??e("genericError"),"error")}finally{z(!1)}},W=(0,i.useMemo)(()=>t.filter(e=>{let t=r.find(t=>t.id===e.shopId)?.name||"",s=j.toLowerCase();return e.shopeeItemId.toLowerCase().includes(s)||e.amazonProductUrl.toLowerCase().includes(s)||t.toLowerCase().includes(s)}),[j,t,r]);return(0,a.jsxs)("div",{className:"container",children:[a.jsx(l.Z,{activeHref:"/mappings"}),(0,a.jsxs)("div",{className:"card",children:[a.jsx("h1",{children:e("mappingsTitle")}),a.jsx("p",{style:{color:"#475569"},children:e("mappingsDescFull")}),(0,a.jsxs)("div",{className:"grid grid-3",style:{marginBottom:16},children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:e("shopSelection")}),(0,a.jsxs)("select",{className:"select",value:c,onChange:e=>u(e.target.value),children:[a.jsx("option",{value:"",children:e("selectPlaceholder")}),r.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:e("shopeeItemId")}),a.jsx("input",{className:"input",value:h,onChange:e=>m(e.target.value)})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label",children:e("amazonProduct")}),a.jsx("input",{className:"input",value:g,onChange:e=>x(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-1",style:{marginBottom:12},children:[a.jsx("label",{className:"label",children:e("notes")||"Notes"}),a.jsx("textarea",{className:"input",value:f,onChange:e=>v(e.target.value)})]}),a.jsx("button",{className:"btn",onClick:T,disabled:I,children:I?e("loading"):e("saveMappingBtn")}),S&&a.jsx("p",{children:S})]}),(0,a.jsxs)("div",{className:"card",children:[a.jsx("h3",{children:e("mappingsTitle")}),N&&a.jsx("p",{children:e("loading")}),a.jsx("input",{className:"input",placeholder:e("searchMappings")||"Search mappings...",style:{maxWidth:300},value:j,onChange:e=>y(e.target.value)}),0!==W.length||N?a.jsx("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table",style:{minWidth:720},children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:e("shopSelection")}),a.jsx("th",{children:e("shopeeProduct")}),a.jsx("th",{children:e("amazonProduct")}),a.jsx("th",{children:e("status")||"Status"})]})}),a.jsx("tbody",{children:W.map(t=>(0,a.jsxs)("tr",{children:[a.jsx("td",{children:r.find(e=>e.id===t.shopId)?.name??t.shopId}),a.jsx("td",{children:t.shopeeItemId}),(0,a.jsxs)("td",{children:[a.jsx("a",{href:t.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:t.amazonProductUrl}),t.notes?a.jsx("div",{style:{color:"#475569",fontSize:12},children:t.notes}):null]}),a.jsx("td",{children:t.isActive?e("on"):e("off")})]},t.id))})]})}):a.jsx("p",{children:e("noMappings")??"No mappings yet."})]}),(0,a.jsxs)("div",{className:"card",children:[a.jsx("h3",{children:e("bulkImportHint")}),a.jsx("textarea",{className:"input",style:{minHeight:120},placeholder:e("csvPlaceholder"),value:P,onChange:e=>D(e.target.value)}),a.jsx("button",{className:"btn btn-ghost",onClick:async()=>{w(!0);try{let t=P.split("\n").map(e=>e.trim()).filter(Boolean).map(e=>{let[t,s,r,a]=e.split(",");return{shopId:t,shopeeItemId:s,amazonProductUrl:r,notes:a}});await d.Z.post("/api/mappings/import",{rows:t}),D(""),A(),(0,p.M)(e("mappingSaved"))}catch(t){(0,p.M)(t?.response?.data?.error??e("genericError"),"error")}finally{w(!1)}},disabled:k,children:k?e("loading"):e("importCsvBtn")})]})]})}async function h({locale:e}){return{props:{...await (0,n.serverSideTranslations)(e,["common"])}}}d=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},5748:()=>{},1377:e=>{"use strict";e.exports=require("next-i18next")},5460:e=>{"use strict";e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},9648:e=>{"use strict";e.exports=import("axios")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},9796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[332,839,552,754],()=>s(1752));module.exports=r})();