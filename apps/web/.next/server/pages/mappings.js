"use strict";(()=>{var e={};e.id=679,e.ids=[679,660],e.modules={1752:(e,t,a)=>{a.a(e,async(e,l)=>{try{a.r(t),a.d(t,{config:()=>m,default:()=>u,getServerSideProps:()=>x,getStaticPaths:()=>g,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>C,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>S});var i=a(8877),s=a(4591),r=a(6021),n=a(552),o=a.n(n),p=a(4076),c=a(760),d=e([c]);c=(d.then?(await d)():d)[0];let u=(0,r.l)(c,"default"),h=(0,r.l)(c,"getStaticProps"),g=(0,r.l)(c,"getStaticPaths"),x=(0,r.l)(c,"getServerSideProps"),m=(0,r.l)(c,"config"),v=(0,r.l)(c,"reportWebVitals"),S=(0,r.l)(c,"unstable_getStaticProps"),j=(0,r.l)(c,"unstable_getStaticPaths"),b=(0,r.l)(c,"unstable_getStaticParams"),f=(0,r.l)(c,"unstable_getServerProps"),y=(0,r.l)(c,"unstable_getServerSideProps"),C=new i.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/mappings",pathname:"/mappings",bundlePath:"",filename:""},components:{App:p.default,Document:o()},userland:c});l()}catch(e){l(e)}})},1522:(e,t,a)=>{a.a(e,async(e,l)=>{try{a.d(t,{Z:()=>n});var i=a(9648),s=e([i]);let r=(i=(s.then?(await s)():s)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});r.defaults.adapter,r.interceptors.request.use(e=>{let t=e.url||"";if(t.startsWith("/api/orders/"))e.url=t.replace("/api","");else for(let a of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(t.startsWith(a)){e.url=t.replace("/api","");break}return e}),r.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let n=r;l()}catch(e){l(e)}})},760:(e,t,a)=>{a.a(e,async(e,l)=>{try{a.r(t),a.d(t,{default:()=>h,getStaticProps:()=>g});var i=a(997),s=a(6689),r=a(5460),n=a(1377),o=a(5681),p=a(1522),c=a(7029),d=a(3877),u=e([p]);function h(){let{t:e}=(0,n.useTranslation)("common"),[t,a]=(0,s.useState)([]),[l,r]=(0,s.useState)([]),[u,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[m,v]=(0,s.useState)(""),[S,j]=(0,s.useState)(""),[b,f]=(0,s.useState)(""),[y,C]=(0,s.useState)("all"),[w,D]=(0,s.useState)(""),[P,z]=(0,s.useState)(!1),[I,M]=(0,s.useState)(!1),[L,k]=(0,s.useState)(!1),T=async()=>{z(!0);try{let[e,t]=await Promise.all([p.Z.get("/api/shops"),p.Z.get("/api/mappings")]);r(e.data||[]),a(t.data||[])}catch(t){(0,c.M)(t?.response?.data?.error??e("genericError"),"error")}finally{z(!1)}};(0,s.useEffect)(()=>{T()},[]);let A=async()=>{if(!u||!g||!m){(0,c.M)(e("fieldRequired"),"error");return}M(!0);try{await p.Z.post("/api/mappings",{shopId:u,shopeeItemId:g,amazonProductUrl:m,notes:S||void 0}),h(""),x(""),v(""),j(""),(0,c.M)(e("mappingSaved")),await T()}catch(t){(0,c.M)(t?.response?.data?.error??e("genericError"),"error")}finally{M(!1)}},q=async()=>{if(!w.trim()){(0,c.M)(e("fieldRequired"),"error");return}let t=w.split("\n").map(e=>e.trim()).filter(Boolean).map(e=>{let[t,a,l,i]=e.split(",");return{shopId:t?.trim(),shopeeItemId:a?.trim(),amazonProductUrl:l?.trim(),notes:i?.trim()||void 0}}).filter(e=>e.shopId&&e.shopeeItemId&&e.amazonProductUrl);if(0===t.length){(0,c.M)(e("csvNoValidRows"),"error");return}k(!0);try{await p.Z.post("/api/mappings/import",{rows:t}),D(""),await T(),(0,c.M)(e("csvRowsImported"))}catch(t){(0,c.M)(t?.response?.data?.error??e("genericError"),"error")}finally{k(!1)}},Z=(0,s.useMemo)(()=>t.filter(e=>{let t=l.find(t=>t.id===e.shopId)?.name||"",a=b.toLowerCase(),i=e.shopeeItemId.toLowerCase().includes(a)||e.amazonProductUrl.toLowerCase().includes(a)||t.toLowerCase().includes(a),s="all"===y||e.shopId===y;return i&&s}),[b,t,l,y]),R=(0,s.useMemo)(()=>{let e=t.length,a=t.filter(e=>e.isActive).length,l=new Set(t.map(e=>e.shopId)).size,i=t.reduce((e,t)=>{if(!t.createdAt)return e;let a=new Date(t.createdAt).getTime();return a>e?a:e},0);return{total:e,active:a,inactive:Math.max(e-a,0),uniqueShops:l,lastCreated:i?new Date(i).toISOString():null}},[t]),B=(0,s.useMemo)(()=>[{label:e("totalMappingsLabel")||"Total mappings",value:R.total.toLocaleString(),helper:e("mappingsTotalHelper")||"Records synced across all shops"},{label:e("activeMappingsLabel")||"Active",value:R.active.toLocaleString(),helper:e("mappingsActiveHelper")||"Eligible for automation"},{label:e("shopCoverageLabel")||"Shop coverage",value:l.length?`${R.uniqueShops}/${l.length}`:R.uniqueShops.toString(),helper:e("mappingsCoverageHelper")||"Shops with at least one mapping"}],[R.active,R.total,R.uniqueShops,l.length,e]),F=i.jsx(d.Ct,{variant:R.total>0?"success":"warning",size:"lg",children:R.total>0?`${R.active}/${R.total} ${e("mappingsActiveShort")||"active"}`:e("mappingsAwaitingSetup")||"Awaiting setup"}),$=i.jsx("div",{style:{display:"grid",gap:12},children:B.map(e=>(0,i.jsxs)("div",{style:{padding:16,borderRadius:"var(--radius-lg)",background:"rgba(255,255,255,0.9)",border:"1px solid rgba(148,163,184,0.35)",boxShadow:"var(--shadow-xs)"},children:[i.jsx("p",{style:{margin:0,fontSize:13,color:"var(--color-text-muted)",textTransform:"uppercase",letterSpacing:.5},children:e.label}),i.jsx("strong",{style:{display:"block",fontSize:28,marginTop:4},children:e.value}),i.jsx("span",{style:{fontSize:12,color:"var(--color-text-muted)"},children:e.helper})]},e.label))}),_=i.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:13},children:R.lastCreated?`${e("lastMappingAdded")||"Last mapping added"}: ${new Date(R.lastCreated).toLocaleString()}`:e("mappingsHeroFooter")||"Create a mapping to start syncing Shopee items."}),E=(0,i.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"flex-end"},children:[i.jsx("div",{style:{flex:"1 1 240px",minWidth:220},children:i.jsx(d.II,{label:e("searchMappings")||"Search mappings",value:b,onChange:e=>f(e.target.value),placeholder:e("search")||"Search"})}),i.jsx("div",{style:{flex:"1 1 200px",minWidth:200},children:i.jsx(d.Ph,{label:e("shopSelection")||"Shop",value:y,onChange:e=>C(e.target.value),options:[{value:"all",label:e("allShops")||"All shops"},...l.map(e=>({value:e.id,label:e.name}))]})}),i.jsx(d.zx,{variant:"ghost",onClick:()=>{f(""),C("all")},children:e("clearFilters")||"Clear filters"})]}),H=i.jsx(d.zx,{variant:"ghost",onClick:T,loading:P,children:e("refreshData")||"Refresh data"}),W=(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,i.jsxs)(d.Zb,{hover:!1,children:[i.jsx(d.Ol,{title:e("bulkImportTips")||"Bulk import tips",subtitle:e("bulkImportHint")||"Paste CSV rows with shop, Shopee ID, and Amazon URL",icon:"\uD83D\uDCA1"}),i.jsx("ul",{style:{margin:0,paddingLeft:18,display:"flex",flexDirection:"column",gap:8,color:"var(--color-text-muted)",fontSize:13},children:[e("csvTipHeaders")||"Skip headers and keep columns comma-separated.",e("csvTipValidation")||"Only valid rows will be imported.",e("csvTipNotes")||"Trailing text fills the optional notes field."].map(e=>i.jsx("li",{children:e},e))}),(0,i.jsxs)("div",{style:{marginTop:16,display:"flex",gap:8,flexWrap:"wrap"},children:[i.jsx(d.zx,{size:"sm",onClick:()=>{D("shop-123,123456789,https://www.amazon.co.jp/dp/B0ABC12345,First SKU\nshop-456,987654321,https://www.amazon.co.jp/dp/B0XYZ67890,Backup SKU"),(0,c.M)(e("csvTemplateApplied")||"Sample CSV template applied","success")},children:e("applyTemplate")||"Apply template"}),i.jsx(d.zx,{size:"sm",variant:"ghost",onClick:()=>D(""),children:e("clearForm")||"Clear"})]})]}),(0,i.jsxs)(d.Zb,{hover:!1,children:[i.jsx(d.Ol,{title:e("mappingStatus")||"Mapping status",subtitle:e("mappingStatusSubtitle")||"Snapshot across your catalog",icon:"\uD83D\uDCCA"}),(0,i.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[i.jsx("span",{children:e("activeMappingsLabel")||"Active"}),i.jsx("strong",{children:R.active.toLocaleString()})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[i.jsx("span",{children:e("inactiveMappings")||"Inactive"}),i.jsx("strong",{children:R.inactive.toLocaleString()})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13},children:[i.jsx("span",{children:e("shopCoverageLabel")||"Shop coverage"}),i.jsx("strong",{children:l.length?`${R.uniqueShops}/${l.length}`:R.uniqueShops.toString()})]})]})]})]});return(0,i.jsxs)(i.Fragment,{children:[i.jsx(o.Z,{activeHref:"/mappings",title:`ðŸ”— ${e("mappingsTitle")}`,description:e("mappingsDescFull"),heroBadge:F,heroAside:$,heroFooter:_,toolbar:E,actions:H,sidebar:W,heroBackground:"linear-gradient(135deg, rgba(191,219,254,0.6) 0%, rgba(224,242,254,0.8) 100%)",children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(0,i.jsxs)(d.Zb,{children:[i.jsx(d.Ol,{title:e("mappingPulse")||"Catalog pulse",subtitle:e("mappingPulseSubtitle")||"Live view of mapping readiness",icon:"\uD83D\uDCC8"}),(0,i.jsxs)("div",{className:"grid grid-3",style:{gap:16},children:[i.jsx(d.Rm,{icon:"\uD83D\uDD17",label:e("totalMappingsLabel")||"Total mappings",value:R.total.toLocaleString(),color:"primary"}),i.jsx(d.Rm,{icon:"âš¡",label:e("activeMappingsLabel")||"Active",value:R.active.toLocaleString(),color:"success"}),i.jsx(d.Rm,{icon:"\uD83C\uDFEC",label:e("shopCoverageLabel")||"Shop coverage",value:l.length?`${R.uniqueShops}/${l.length}`:R.uniqueShops.toString(),color:"info"})]})]}),(0,i.jsxs)("div",{className:"grid grid-2",style:{gap:24},children:[(0,i.jsxs)(d.Zb,{children:[i.jsx(d.Ol,{title:e("mappingFormTitle"),subtitle:e("mappingFormSubtitle"),icon:"\uD83D\uDEE0ï¸"}),(0,i.jsxs)("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:16},children:[i.jsx(d.Ph,{label:e("shopSelection"),value:u,onChange:e=>h(e.target.value),options:[{value:"",label:e("selectPlaceholder")},...l.map(e=>({value:e.id,label:e.name}))]}),i.jsx(d.II,{label:e("shopeeItemId"),value:g,onChange:e=>x(e.target.value),placeholder:"12345678"}),i.jsx(d.II,{label:e("amazonProduct"),value:m,onChange:e=>v(e.target.value),placeholder:"https://www.amazon.co.jp/dp/B0XXXXXXX"}),i.jsx(d.gx,{label:e("notes")||"Notes",value:S,onChange:e=>j(e.target.value)}),i.jsx(d.zx,{onClick:A,loading:I,fullWidth:!0,children:e("saveMappingBtn")})]})]}),(0,i.jsxs)(d.Zb,{children:[i.jsx(d.Ol,{title:e("bulkImportHint"),subtitle:e("csvPlaceholder"),icon:"\uD83D\uDCE5"}),(0,i.jsxs)("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:16},children:[i.jsx(d.gx,{value:w,onChange:e=>D(e.target.value),placeholder:e("csvPlaceholder"),label:e("bulkImportHint")}),i.jsx(d.zx,{variant:"ghost",onClick:q,loading:L,children:e("importCsvBtn")}),(0,i.jsxs)("ul",{style:{margin:0,paddingLeft:20,color:"var(--color-text-muted)",fontSize:14},children:[i.jsx("li",{children:e("bulkImportHint")}),i.jsx("li",{children:e("searchMappings")})]})]})]})]}),(0,i.jsxs)(d.Zb,{children:[i.jsx(d.Ol,{title:e("mappingTableTitle"),subtitle:e("mappingTableSubtitle"),icon:"\uD83D\uDCCB"}),i.jsx("div",{style:{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:16},children:P?i.jsx(d.TK,{text:e("loading")??"Loading"}):0===Z.length?i.jsx(d.ub,{icon:"\uD83D\uDDC2ï¸",title:e("noMappings")??"No mappings yet",description:e("noMappingsDesc"),action:i.jsx(d.zx,{onClick:()=>{f(""),C("all")},variant:"ghost",children:e("clearFilters")||e("clearForm")||"Clear"})}):i.jsx("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table",style:{minWidth:720},children:[i.jsx("thead",{children:(0,i.jsxs)("tr",{children:[i.jsx("th",{children:e("shopSelection")}),i.jsx("th",{children:e("shopeeProduct")}),i.jsx("th",{children:e("amazonProduct")}),i.jsx("th",{children:e("status")||"Status"})]})}),i.jsx("tbody",{children:Z.map(t=>(0,i.jsxs)("tr",{children:[i.jsx("td",{children:l.find(e=>e.id===t.shopId)?.name??t.shopId}),i.jsx("td",{children:t.shopeeItemId}),(0,i.jsxs)("td",{children:[i.jsx("a",{href:t.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:t.amazonProductUrl}),t.notes?i.jsx("div",{style:{color:"#475569",fontSize:12},children:t.notes}):null]}),i.jsx("td",{children:t.isActive?e("on"):e("off")})]},t.id))})]})})})]})]})}),i.jsx(c.Z,{})]})}async function g({locale:e}){return{props:{...await (0,r.serverSideTranslations)(e,["common"])}}}p=(u.then?(await u)():u)[0],l()}catch(e){l(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),l=t.X(0,[332,839,552,754,20],()=>a(1752));module.exports=l})();