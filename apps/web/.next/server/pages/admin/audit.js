"use strict";(()=>{var e={};e.id=19,e.ids=[19,660],e.modules={3951:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>g,default:()=>p,getServerSideProps:()=>m,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>w,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>f});var i=a(8877),s=a(4591),n=a(6021),l=a(552),o=a.n(l),c=a(4076),d=a(6),u=e([d]);d=(u.then?(await u)():u)[0];let p=(0,n.l)(d,"default"),h=(0,n.l)(d,"getStaticProps"),x=(0,n.l)(d,"getStaticPaths"),m=(0,n.l)(d,"getServerSideProps"),g=(0,n.l)(d,"config"),v=(0,n.l)(d,"reportWebVitals"),f=(0,n.l)(d,"unstable_getStaticProps"),S=(0,n.l)(d,"unstable_getStaticPaths"),b=(0,n.l)(d,"unstable_getStaticParams"),j=(0,n.l)(d,"unstable_getServerProps"),y=(0,n.l)(d,"unstable_getServerSideProps"),w=new i.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/admin/audit",pathname:"/admin/audit",bundlePath:"",filename:""},components:{App:c.default,Document:o()},userland:d});r()}catch(e){r(e)}})},1522:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>l});var i=a(9648),s=e([i]);let n=(i=(s.then?(await s)():s)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});n.defaults.adapter,n.interceptors.request.use(e=>{let t=e.url||"";if(t.startsWith("/api/orders/"))e.url=t.replace("/api","");else for(let a of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(t.startsWith(a)){e.url=t.replace("/api","");break}return e}),n.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let l=n;r()}catch(e){r(e)}})},6:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>h,getStaticProps:()=>x});var i=a(997),s=a(6689),n=a(5460),l=a(1377),o=a(5681),c=a(1522),d=a(7029),u=a(3877),p=e([c]);function h(){let{t:e}=(0,l.useTranslation)("common"),[t,a]=(0,s.useState)([]),[r,n]=(0,s.useState)(!1),[p,h]=(0,s.useState)(""),[x,m]=(0,s.useState)("all");(0,s.useEffect)(()=>{n(!0),c.Z.get("/api/admin/audit").then(e=>a(e.data)).catch(t=>(0,d.M)(t?.response?.data?.error??e("genericError"),"error")).finally(()=>n(!1))},[]);let g=Array.from(new Set(t.map(e=>e.action))),v=Date.now(),f=t.filter(e=>new Date(e.createdAt).getTime()>v-864e5).length,S=new Set(t.map(e=>e.user?.email)).size,b=(0,s.useMemo)(()=>t.filter(e=>{let t="all"===x||e.action===x,a=e.user?.email?.toLowerCase().includes(p.toLowerCase())||e.action.toLowerCase().includes(p.toLowerCase());return t&&a}),[t,x,p]),j=i.jsx("div",{style:{display:"grid",gap:16,gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:[{label:e("adminEvents24h")||"Events (24h)",value:f,helper:e("adminEventsHint")||"Recent privileged changes"},{label:e("uniqueActors")||"Unique actors",value:S,helper:e("uniqueActorsHint")||"Distinct accounts"},{label:e("actionsTracked")||"Actions tracked",value:g.length,helper:e("actionsTrackedHint")||"Signals tracked"}].map(e=>(0,i.jsxs)("div",{className:"stat-card",style:{padding:20},children:[i.jsx("p",{style:{fontSize:12,textTransform:"uppercase",color:"var(--color-text-light)",marginBottom:6},children:e.label}),i.jsx("div",{style:{fontSize:28,fontWeight:800},children:e.value}),i.jsx("p",{style:{margin:0,color:"var(--color-text-muted)",fontSize:13},children:e.helper})]},e.label))}),y=(0,i.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"center"},children:[i.jsx(u.II,{placeholder:e("searchAudit")||"Search actor or action",value:p,onChange:e=>h(e.target.value),style:{marginBottom:0,minWidth:220},icon:i.jsx("span",{"aria-hidden":"true",children:"\uD83D\uDD0D"})}),i.jsx(u.Ph,{value:x,onChange:e=>m(e.target.value),options:[{value:"all",label:e("allActions")||"All actions"},...g.map(e=>({value:e,label:e}))],style:{marginBottom:0,minWidth:200}}),i.jsx(u.zx,{type:"button",variant:"ghost",onClick:()=>window.location.reload(),children:e("refreshData")||"Refresh"})]}),w=(0,i.jsxs)(u.Ct,{variant:"info",children:[b.length," ",e("records")||"records"]});return i.jsx(o.Z,{activeHref:"/admin/audit",title:e("adminAuditTitle"),description:e("adminAuditDesc")||"Every privileged update is mirrored here for compliance.",heroBadge:w,heroAside:j,toolbar:y,actions:(0,i.jsxs)(u.zx,{type:"button",onClick:()=>window.open("/api/admin/audit/export","_blank"),children:["⬇️ ",e("exportCsv")||"Export CSV"]}),heroFooter:i.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:14},children:e("auditHeroFooter")||"Retention: 90 days. Export for long term storage."}),children:(0,i.jsxs)(u.Zb,{hover:!1,children:[i.jsx(u.Ol,{title:e("auditTimeline")||"Audit timeline",subtitle:e("auditTimelineDesc")||"Newest events first with JSON detail",icon:"\uD83D\uDD52",action:(0,i.jsxs)(u.Ct,{variant:"warning",children:[g.length," ",e("actionsTracked")||"actions"]})}),r&&i.jsx(u.TK,{text:e("loading")||"Loading"}),!r&&0===b.length&&i.jsx(u.ub,{icon:"\uD83D\uDCED",title:e("noAuditResults")||"No events found",description:e("noAuditDesc")||"Try clearing search filters to see more history.",action:i.jsx(u.zx,{type:"button",variant:"ghost",onClick:()=>{h(""),m("all")},children:e("resetFilters")||"Reset filters"})}),!r&&b.length>0&&i.jsx("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"table",children:[i.jsx("thead",{children:(0,i.jsxs)("tr",{children:[i.jsx("th",{children:e("timeLabel")}),i.jsx("th",{children:e("userLabel")}),i.jsx("th",{children:e("actionLabel")}),i.jsx("th",{children:e("detailLabel")})]})}),i.jsx("tbody",{children:b.map(e=>(0,i.jsxs)("tr",{children:[i.jsx("td",{children:new Date(e.createdAt).toLocaleString()}),i.jsx("td",{children:e.user?.email??"-"}),i.jsx("td",{children:i.jsx(u.Ct,{variant:"default",children:e.action})}),i.jsx("td",{children:i.jsx("code",{style:{fontSize:12},children:e.detail?JSON.stringify(e.detail):"-"})})]},e.id))})]})})]})})}async function x({locale:e}){return{props:{...await (0,n.serverSideTranslations)(e,["common"])}}}c=(p.then?(await p)():p)[0],r()}catch(e){r(e)}})},1377:e=>{e.exports=require("next-i18next")},5460:e=>{e.exports=require("next-i18next/serverSideTranslations")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9648:e=>{e.exports=import("axios")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[332,839,552,754,20],()=>a(3951));module.exports=r})();