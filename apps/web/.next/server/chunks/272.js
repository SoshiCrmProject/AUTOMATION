"use strict";exports.id=272,exports.ids=[272],exports.modules={6224:(e,a,t)=>{t.d(a,{Z:()=>l});var s=t(997),i=t(5632),n=t(7029);function l(){let e=(0,i.useRouter)(),{pathname:a,query:t,asPath:l,locale:r}=e,o=async s=>{try{await e.push({pathname:a,query:t},l,{locale:s}),(0,n.M)("ja"===s?"言語が日本語に変更されました":"Language changed to English","success")}catch(e){}};return(0,s.jsxs)("div",{role:"group","aria-label":"Language selection",style:{display:"inline-flex",alignItems:"center",gap:8,background:"rgba(255, 255, 255, 0.2)",borderRadius:"var(--radius-full)",padding:"6px 12px",fontSize:13,fontWeight:600},children:[s.jsx("button",{onClick:()=>o("en"),"aria-label":"Switch to English","aria-pressed":"en"===r,style:{background:"en"===r?"white":"transparent",color:"en"===r?"var(--color-primary)":"white",border:"none",borderRadius:"var(--radius-full)",padding:"4px 12px",fontSize:13,fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:4},children:"\uD83C\uDDFA\uD83C\uDDF8 EN"}),s.jsx("button",{onClick:()=>o("ja"),"aria-label":"Switch to Japanese","aria-pressed":"ja"===r,style:{background:"ja"===r?"white":"transparent",color:"ja"===r?"var(--color-primary)":"white",border:"none",borderRadius:"var(--radius-full)",padding:"4px 12px",fontSize:13,fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:4},children:"\uD83C\uDDEF\uD83C\uDDF5 JA"})]})}},8272:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>u});var i=t(997),n=t(6689),l=t(1377),r=t(5632),o=t(1522),d=t(7029),c=t(6224),p=e([o]);function u(){let{t:e}=(0,l.useTranslation)("common"),a=(0,r.useRouter)(),[t,s]=(0,n.useState)(!1),[p,u]=(0,n.useState)(0),[h,g]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!0),[b,y]=(0,n.useState)(""),[f,v]=(0,n.useState)([]),[j,S]=(0,n.useState)({partnerId:"",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"",shopName:""}),[N,w]=(0,n.useState)({email:"",password:""}),[C,D]=(0,n.useState)({includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:7,minExpectedProfit:0,shopIds:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,overrides:[]}),I=(0,n.useMemo)(()=>[{title:e("onboardingModalStep1Title"),desc:e("onboardingModalStep1Desc"),type:"welcome"},{title:e("onboardingModalStep2Title"),desc:e("onboardingModalStep2Desc"),type:"shopee"},{title:e("onboardingModalStep3Title"),desc:e("onboardingModalStep3Desc"),type:"amazon"},{title:e("onboardingModalStep4Title"),desc:e("onboardingModalStep4Desc"),type:"settings"},{title:e("onboardingModalStep5Title"),desc:e("onboardingModalStep5Desc"),type:"done"}],[e]);(0,n.useEffect)(()=>{(async()=>{if("undefined"==typeof globalThis||!globalThis.localStorage)return;let t=localStorage.getItem("token"),i="1"===localStorage.getItem("onboarding_dismissed"),n=a.pathname;if(!t||n.startsWith("/login")||n.startsWith("/signup")||i){x(!1),s(!1);return}try{let[e,a,t,i]=await Promise.allSettled([o.Z.get("/api/shops"),o.Z.get("/api/credentials/shopee"),o.Z.get("/api/credentials/amazon"),o.Z.get("/api/settings")]);if("fulfilled"===e.status){v(e.value.data);let a=e.value.data.map(e=>e.id);D(e=>({...e,shopIds:a}))}if("fulfilled"===a.status&&a.value.data&&S(e=>({...e,partnerId:a.value.data.partnerId??"",baseUrl:a.value.data.baseUrl??e.baseUrl,shopId:a.value.data.shopId??"",shopName:a.value.data.shopName??""})),"fulfilled"===t.status&&t.value.data?.email&&w(e=>({...e,email:t.value.data.email})),"fulfilled"===i.status&&i.value.data){let e=i.value.data;D(a=>({...a,includeAmazonPoints:e.includeAmazonPoints,includeDomesticShipping:e.includeDomesticShipping,domesticShippingCost:e.domesticShippingCost??0,maxShippingDays:e.maxShippingDays,minExpectedProfit:e.minExpectedProfit,shopIds:e.shopSelections?.filter(e=>e.isSelected).map(e=>e.shopId)??a.shopIds,isActive:e.isActive,isDryRun:e.isDryRun??!1,reviewBandPercent:e.reviewBandPercent??0,overrides:e.shopOverrides??[]}))}s(!0)}catch(a){y(a?.response?.data?.error??e("genericError"))}finally{x(!1)}})()},[e,a.pathname]);let k=()=>{"undefined"!=typeof localStorage&&localStorage.setItem("onboarding_dismissed","1"),s(!1)},T=async()=>{if(!j.partnerId||!j.partnerKey||!j.accessToken||!j.shopId)return y(e("fieldRequired")),!1;g(!0),y("");try{return await o.Z.post("/api/credentials/shopee",j),(0,d.M)(e("shopeeSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("shopeeSaveError");return y(a),(0,d.M)(a,"error"),!1}finally{g(!1)}},M=async()=>{if(!N.email||!N.password)return y(e("fieldRequired")),!1;g(!0),y("");try{return await o.Z.post("/api/credentials/amazon",N),w(e=>({...e,password:""})),(0,d.M)(e("credentialsSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("credentialsSaveError");return y(a),(0,d.M)(a,"error"),!1}finally{g(!1)}},P=async()=>{if(!C.shopIds.length&&f.length)return y(e("fieldRequired")),!1;g(!0),y("");try{return await o.Z.post("/api/settings",C),(0,d.M)(e("settingsSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("settingsSaveError");return y(a),(0,d.M)(a,"error"),!1}finally{g(!1)}},z=async()=>{y("");let e=I[p].type;if("welcome"===e||"done"===e){if(p===I.length-1){k();return}u(e=>e+1);return}if("shopee"===e){await T()&&u(e=>e+1);return}if("amazon"===e){await M()&&u(e=>e+1);return}"settings"===e&&await P()&&k()};if(!t||m)return null;let E=I[p];return i.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",justifyContent:"center",padding:20,zIndex:1e4},role:"dialog","aria-modal":"true","aria-labelledby":"onboarding-modal-title",children:(0,i.jsxs)("div",{className:"card",style:{maxWidth:720,width:"100%",padding:28,position:"relative",background:"#fff",boxShadow:"0 25px 60px rgba(15, 23, 42, 0.25)"},children:[i.jsx("button",{onClick:k,"aria-label":e("close"),style:{position:"absolute",top:12,right:12,border:"none",background:"transparent",fontSize:20,cursor:"pointer",color:"#475569"},children:"\xd7"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[i.jsx("p",{style:{margin:0,color:"#0f172a",fontWeight:700,letterSpacing:.5},children:e("onboardingModalTitle")}),i.jsx(c.Z,{})]}),(0,i.jsxs)("div",{style:{marginTop:12},children:[i.jsx("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:I.map((e,a)=>(0,i.jsxs)("span",{className:"pill",style:{background:a===p?"#2563eb":"#e2e8f0",color:a===p?"#fff":"#0f172a"},children:[a+1," / ",I.length]},a))}),i.jsx("h3",{id:"onboarding-modal-title",style:{margin:"8px 0",color:"#0f172a"},children:E.title}),i.jsx("p",{style:{color:"#475569",lineHeight:1.5},children:E.desc}),b&&i.jsx("p",{style:{color:"#ef4444"},children:b}),"welcome"===E.type&&i.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:i.jsx("p",{children:e("onboardingModalWelcomeBlurb")})}),"shopee"===E.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("partnerId")}),i.jsx("input",{className:"input",value:j.partnerId,onChange:e=>S({...j,partnerId:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("partnerKey")}),i.jsx("input",{className:"input",type:"password",value:j.partnerKey,onChange:e=>S({...j,partnerKey:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("accessToken")}),i.jsx("input",{className:"input",type:"password",value:j.accessToken,onChange:e=>S({...j,accessToken:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("baseUrl")}),i.jsx("input",{className:"input",value:j.baseUrl,onChange:e=>S({...j,baseUrl:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("shopId")}),i.jsx("input",{className:"input",value:j.shopId,onChange:e=>S({...j,shopId:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("shopName")}),i.jsx("input",{className:"input",value:j.shopName,onChange:e=>S({...j,shopName:e.currentTarget.value})})]})]}),"amazon"===E.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("amazonEmail")}),i.jsx("input",{className:"input",type:"email",value:N.email,onChange:e=>w({...N,email:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("amazonPassword")}),i.jsx("input",{className:"input",type:"password",value:N.password,onChange:e=>w({...N,password:e.currentTarget.value})})]})]}),"settings"===E.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("maxShippingDays")}),i.jsx("input",{className:"input",type:"number",value:C.maxShippingDays,onChange:e=>D({...C,maxShippingDays:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("minProfit")}),i.jsx("input",{className:"input",type:"number",value:C.minExpectedProfit,onChange:e=>D({...C,minExpectedProfit:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:C.includeAmazonPoints,onChange:e=>D({...C,includeAmazonPoints:e.currentTarget.checked})}),e("includePointsLabel")]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:C.includeDomesticShipping,onChange:e=>D({...C,includeDomesticShipping:e.currentTarget.checked})}),e("includeDomesticLabel")]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("domesticShippingCost")}),i.jsx("input",{className:"input",type:"number",value:C.domesticShippingCost,onChange:e=>D({...C,domesticShippingCost:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:C.isActive,onChange:e=>D({...C,isActive:e.currentTarget.checked})}),e("autoShipping")]})]}),"done"===E.type&&i.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:i.jsx("p",{children:e("onboardingModalCompleteDesc")})}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap"},children:[i.jsx("button",{className:"btn btn-ghost",onClick:()=>u(e=>Math.max(0,e-1)),disabled:0===p||h,children:e("prev")}),i.jsx("button",{className:"btn",onClick:z,disabled:h,children:h?e("loading"):p===I.length-1?e("finish"):e("next")}),i.jsx("button",{className:"btn btn-ghost",onClick:k,children:e("skip")})]})]})]})})}o=(p.then?(await p)():p)[0],s()}catch(e){s(e)}})},1522:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>r});var i=t(9648),n=e([i]);let l=(i=(n.then?(await n)():n)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});l.defaults.adapter,l.interceptors.request.use(e=>{let a=e.url||"";if(a.startsWith("/api/orders/"))e.url=a.replace("/api","");else for(let t of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(a.startsWith(t)){e.url=a.replace("/api","");break}return e}),l.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let r=l;s()}catch(e){s(e)}})}};