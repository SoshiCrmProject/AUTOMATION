"use strict";exports.id=272,exports.ids=[272],exports.modules={8272:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>c});var r=a(997),i=a(6689),n=a(1377),o=a(5632),l=a(1522),d=a(7029),p=e([l]);function c(){let{t:e}=(0,n.useTranslation)("common"),t=(0,o.useRouter)(),[a,s]=(0,i.useState)(!1),[p,c]=(0,i.useState)(0),[u,h]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!0),[x,f]=(0,i.useState)(""),[b,y]=(0,i.useState)([]),[S,v]=(0,i.useState)({partnerId:"",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"",shopName:""}),[j,N]=(0,i.useState)({email:"",password:""}),[T,I]=(0,i.useState)({includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:7,minExpectedProfit:0,shopIds:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,overrides:[]}),k=(0,i.useMemo)(()=>[{title:e("onboardingModalStep1Title"),desc:e("onboardingModalStep1Desc"),type:"welcome"},{title:e("onboardingModalStep2Title"),desc:e("onboardingModalStep2Desc"),type:"shopee"},{title:e("onboardingModalStep3Title"),desc:e("onboardingModalStep3Desc"),type:"amazon"},{title:e("onboardingModalStep4Title"),desc:e("onboardingModalStep4Desc"),type:"settings"},{title:e("onboardingModalStep5Title"),desc:e("onboardingModalStep5Desc"),type:"done"}],[e]);(0,i.useEffect)(()=>{(async()=>{if("undefined"==typeof globalThis||!globalThis.localStorage)return;let a=localStorage.getItem("token"),r="1"===localStorage.getItem("onboarding_dismissed"),i=t.pathname;if(!a||i.startsWith("/login")||i.startsWith("/signup")||r){g(!1),s(!1);return}try{let[e,t,a,r]=await Promise.allSettled([l.Z.get("/api/shops"),l.Z.get("/api/credentials/shopee"),l.Z.get("/api/credentials/amazon"),l.Z.get("/api/settings")]);if("fulfilled"===e.status){y(e.value.data);let t=e.value.data.map(e=>e.id);I(e=>({...e,shopIds:t}))}if("fulfilled"===t.status&&t.value.data&&v(e=>({...e,partnerId:t.value.data.partnerId??"",baseUrl:t.value.data.baseUrl??e.baseUrl,shopId:t.value.data.shopId??"",shopName:t.value.data.shopName??""})),"fulfilled"===a.status&&a.value.data?.email&&N(e=>({...e,email:a.value.data.email})),"fulfilled"===r.status&&r.value.data){let e=r.value.data;I(t=>({...t,includeAmazonPoints:e.includeAmazonPoints,includeDomesticShipping:e.includeDomesticShipping,domesticShippingCost:e.domesticShippingCost??0,maxShippingDays:e.maxShippingDays,minExpectedProfit:e.minExpectedProfit,shopIds:e.shopSelections?.filter(e=>e.isSelected).map(e=>e.shopId)??t.shopIds,isActive:e.isActive,isDryRun:e.isDryRun??!1,reviewBandPercent:e.reviewBandPercent??0,overrides:e.shopOverrides??[]}))}s(!0)}catch(t){f(t?.response?.data?.error??e("genericError"))}finally{g(!1)}})()},[e,t.pathname]);let w=()=>{"undefined"!=typeof localStorage&&localStorage.setItem("onboarding_dismissed","1"),s(!1)},P=async()=>{if(!S.partnerId||!S.partnerKey||!S.accessToken||!S.shopId)return f(e("fieldRequired")),!1;h(!0),f("");try{return await l.Z.post("/api/credentials/shopee",S),(0,d.M)(e("shopeeSaveSuccess")),!0}catch(a){let t=a?.response?.data?.error??e("shopeeSaveError");return f(t),(0,d.M)(t,"error"),!1}finally{h(!1)}},z=async()=>{if(!j.email||!j.password)return f(e("fieldRequired")),!1;h(!0),f("");try{return await l.Z.post("/api/credentials/amazon",j),N(e=>({...e,password:""})),(0,d.M)(e("credentialsSaveSuccess")),!0}catch(a){let t=a?.response?.data?.error??e("credentialsSaveError");return f(t),(0,d.M)(t,"error"),!1}finally{h(!1)}},C=async()=>{if(!T.shopIds.length&&b.length)return f(e("fieldRequired")),!1;h(!0),f("");try{return await l.Z.post("/api/settings",T),(0,d.M)(e("settingsSaveSuccess")),!0}catch(a){let t=a?.response?.data?.error??e("settingsSaveError");return f(t),(0,d.M)(t,"error"),!1}finally{h(!1)}},A=async()=>{f("");let e=k[p].type;if("welcome"===e||"done"===e){if(p===k.length-1){w();return}c(e=>e+1);return}if("shopee"===e){await P()&&c(e=>e+1);return}if("amazon"===e){await z()&&c(e=>e+1);return}"settings"===e&&await C()&&w()};if(!a||m)return null;let D=k[p];return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",justifyContent:"center",padding:20,zIndex:1e4},role:"dialog","aria-modal":"true","aria-labelledby":"onboarding-modal-title",children:(0,r.jsxs)("div",{className:"card",style:{maxWidth:720,width:"100%",padding:28,position:"relative",background:"#fff",boxShadow:"0 25px 60px rgba(15, 23, 42, 0.25)"},children:[r.jsx("button",{onClick:w,"aria-label":e("close"),style:{position:"absolute",top:12,right:12,border:"none",background:"transparent",fontSize:20,cursor:"pointer",color:"#475569"},children:"\xd7"}),r.jsx("p",{style:{margin:0,color:"#0f172a",fontWeight:700,letterSpacing:.5},children:e("onboardingModalTitle")}),(0,r.jsxs)("div",{style:{marginTop:12},children:[r.jsx("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:k.map((e,t)=>(0,r.jsxs)("span",{className:"pill",style:{background:t===p?"#2563eb":"#e2e8f0",color:t===p?"#fff":"#0f172a"},children:[t+1," / ",k.length]},t))}),r.jsx("h3",{id:"onboarding-modal-title",style:{margin:"8px 0",color:"#0f172a"},children:D.title}),r.jsx("p",{style:{color:"#475569",lineHeight:1.5},children:D.desc}),x&&r.jsx("p",{style:{color:"#ef4444"},children:x}),"welcome"===D.type&&r.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:r.jsx("p",{children:e("onboardingModalWelcomeBlurb")})}),"shopee"===D.type&&(0,r.jsxs)("div",{className:"grid grid-2",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("partnerId")}),r.jsx("input",{className:"input",value:S.partnerId,onChange:e=>v({...S,partnerId:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("partnerKey")}),r.jsx("input",{className:"input",type:"password",value:S.partnerKey,onChange:e=>v({...S,partnerKey:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("accessToken")}),r.jsx("input",{className:"input",type:"password",value:S.accessToken,onChange:e=>v({...S,accessToken:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("baseUrl")}),r.jsx("input",{className:"input",value:S.baseUrl,onChange:e=>v({...S,baseUrl:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("shopId")}),r.jsx("input",{className:"input",value:S.shopId,onChange:e=>v({...S,shopId:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("shopName")}),r.jsx("input",{className:"input",value:S.shopName,onChange:e=>v({...S,shopName:e.currentTarget.value})})]})]}),"amazon"===D.type&&(0,r.jsxs)("div",{className:"grid grid-2",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("amazonEmail")}),r.jsx("input",{className:"input",type:"email",value:j.email,onChange:e=>N({...j,email:e.currentTarget.value})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("amazonPassword")}),r.jsx("input",{className:"input",type:"password",value:j.password,onChange:e=>N({...j,password:e.currentTarget.value})})]})]}),"settings"===D.type&&(0,r.jsxs)("div",{className:"grid grid-2",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("maxShippingDays")}),r.jsx("input",{className:"input",type:"number",value:T.maxShippingDays,onChange:e=>I({...T,maxShippingDays:Number(e.currentTarget.value)})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("minProfit")}),r.jsx("input",{className:"input",type:"number",value:T.minExpectedProfit,onChange:e=>I({...T,minExpectedProfit:Number(e.currentTarget.value)})})]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("input",{type:"checkbox",checked:T.includeAmazonPoints,onChange:e=>I({...T,includeAmazonPoints:e.currentTarget.checked})}),e("includePointsLabel")]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("input",{type:"checkbox",checked:T.includeDomesticShipping,onChange:e=>I({...T,includeDomesticShipping:e.currentTarget.checked})}),e("includeDomesticLabel")]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:e("domesticShippingCost")}),r.jsx("input",{className:"input",type:"number",value:T.domesticShippingCost,onChange:e=>I({...T,domesticShippingCost:Number(e.currentTarget.value)})})]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("input",{type:"checkbox",checked:T.isActive,onChange:e=>I({...T,isActive:e.currentTarget.checked})}),e("autoShipping")]})]}),"done"===D.type&&r.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:r.jsx("p",{children:e("onboardingModalCompleteDesc")})}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap"},children:[r.jsx("button",{className:"btn btn-ghost",onClick:()=>c(e=>Math.max(0,e-1)),disabled:0===p||u,children:e("prev")}),r.jsx("button",{className:"btn",onClick:A,disabled:u,children:u?e("loading"):p===k.length-1?e("finish"):e("next")}),r.jsx("button",{className:"btn btn-ghost",onClick:w,children:e("skip")})]})]})]})})}l=(p.then?(await p)():p)[0],s()}catch(e){s(e)}})},1522:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>l});var r=a(9648),i=e([r]);let n=(r=(i.then?(await i)():i)[0]).default.create({baseURL:process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001"}),o=n.defaults.adapter;n.interceptors.request.use(e=>e);{let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async a=>{let s=(a.url||"").replace(/^https?:\/\/[^/]+/,""),r=(a.method||"get").toLowerCase(),i=(e,t=200)=>Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:a});if("/api/auth/login"===s&&"post"===r||"/api/auth/signup"===s&&"post"===r)return i({token:"mock-token"});if("/api/shops"===s&&"get"===r)return i(e.shops);if("/api/credentials/shopee"===s&&"get"===r)return i(e.shopeeCred);if("/api/credentials/shopee"===s&&"post"===r)return e.shopeeCred={...a.data},i({success:!0});if("/api/credentials/amazon"===s&&"get"===r)return i(e.amazonCred);if("/api/credentials/amazon"===s&&"post"===r)return e.amazonCred={...a.data},i({success:!0});if("/api/settings"===s&&"get"===r)return i(e.settings);if("/api/settings"===s&&"post"===r)return e.settings={...a.data,shopSelections:e.settings.shopSelections},i({success:!0});if("/api/orders/recent"===s&&"get"===r)return i(e.orders);if("/api/orders/errors"===s&&"get"===r){let t=e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt})));return i(t)}if(s.startsWith("/api/orders/")&&s.endsWith("/retry")&&"post"===r||s.startsWith("/api/orders/retry/")&&"post"===r||s.startsWith("/api/orders/manual/")&&"post"===r||"/api/orders/poll-now"===s&&"post"===r)return i({success:!0});if("/api/orders/errors/export"===s&&"get"===r)return i("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===s&&"get"===r)return i("orderNumber,status\nSP-002,Processed",200);if(s.startsWith("/api/orders/")&&"get"===r){let t=s.split("/").pop(),a=e.orders.find(e=>e.id===t);return i(a||e.orders[0])}if("/api/ops/queue"===s&&"get"===r)return i({waiting:0,active:0,failed:0,delayed:0});if("/api/ops/amazon-test"===s&&"post"===r)return i({success:!0});if("/api/ops/status"===s&&"get"===r)return i({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}});if("/api/mappings"===s&&"get"===r)return i(e.mappings);if("/api/mappings"===s&&"post"===r)return e.mappings.push({id:`map-${Date.now()}`,...a.data||{}}),i({success:!0});if("/api/mappings/import"===s&&"post"===r||"/api/products/shopee"===s&&"post"===r||"/api/products/amazon"===s&&"post"===r)return i({success:!0});if("/api/products/shopee"===s&&"get"===r){let t=e.mappings.map(e=>e.shopeeProduct);return i(t)}if("/api/products/amazon"===s&&"get"===r){let t=e.mappings.map(e=>e.amazonProduct);return i(t)}return"/api/admin/users"===s&&"get"===r?i(e.adminUsers):s.includes("/api/admin/users/")&&s.endsWith("/toggle")&&"post"===r||s.includes("/api/admin/users/")&&s.endsWith("/reset-password")&&"post"===r?i({success:!0}):"/api/admin/audit"===s&&"get"===r?i(e.audit):o&&"function"==typeof o?o(a):i({},404)}}n.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let l=n;s()}catch(e){s(e)}})}};