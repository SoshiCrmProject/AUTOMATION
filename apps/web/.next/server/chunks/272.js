"use strict";exports.id=272,exports.ids=[272],exports.modules={8272:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>p});var i=t(997),l=t(6689),n=t(1377),r=t(5632),o=t(1522),d=t(7029),c=e([o]);function p(){let{t:e}=(0,n.useTranslation)("common"),a=(0,r.useRouter)(),[t,s]=(0,l.useState)(!1),[c,p]=(0,l.useState)(0),[u,h]=(0,l.useState)(!1),[g,m]=(0,l.useState)(!0),[x,b]=(0,l.useState)(""),[y,v]=(0,l.useState)([]),[f,j]=(0,l.useState)({partnerId:"",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"",shopName:""}),[S,N]=(0,l.useState)({email:"",password:""}),[T,w]=(0,l.useState)({includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:7,minExpectedProfit:0,shopIds:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,overrides:[]}),I=(0,l.useMemo)(()=>[{title:e("onboardingModalStep1Title"),desc:e("onboardingModalStep1Desc"),type:"welcome"},{title:e("onboardingModalStep2Title"),desc:e("onboardingModalStep2Desc"),type:"shopee"},{title:e("onboardingModalStep3Title"),desc:e("onboardingModalStep3Desc"),type:"amazon"},{title:e("onboardingModalStep4Title"),desc:e("onboardingModalStep4Desc"),type:"settings"},{title:e("onboardingModalStep5Title"),desc:e("onboardingModalStep5Desc"),type:"done"}],[e]);(0,l.useEffect)(()=>{(async()=>{if("undefined"==typeof globalThis||!globalThis.localStorage)return;let t=localStorage.getItem("token"),i="1"===localStorage.getItem("onboarding_dismissed"),l=a.pathname;if(!t||l.startsWith("/login")||l.startsWith("/signup")||i){m(!1),s(!1);return}try{let[e,a,t,i]=await Promise.allSettled([o.Z.get("/api/shops"),o.Z.get("/api/credentials/shopee"),o.Z.get("/api/credentials/amazon"),o.Z.get("/api/settings")]);if("fulfilled"===e.status){v(e.value.data);let a=e.value.data.map(e=>e.id);w(e=>({...e,shopIds:a}))}if("fulfilled"===a.status&&a.value.data&&j(e=>({...e,partnerId:a.value.data.partnerId??"",baseUrl:a.value.data.baseUrl??e.baseUrl,shopId:a.value.data.shopId??"",shopName:a.value.data.shopName??""})),"fulfilled"===t.status&&t.value.data?.email&&N(e=>({...e,email:t.value.data.email})),"fulfilled"===i.status&&i.value.data){let e=i.value.data;w(a=>({...a,includeAmazonPoints:e.includeAmazonPoints,includeDomesticShipping:e.includeDomesticShipping,domesticShippingCost:e.domesticShippingCost??0,maxShippingDays:e.maxShippingDays,minExpectedProfit:e.minExpectedProfit,shopIds:e.shopSelections?.filter(e=>e.isSelected).map(e=>e.shopId)??a.shopIds,isActive:e.isActive,isDryRun:e.isDryRun??!1,reviewBandPercent:e.reviewBandPercent??0,overrides:e.shopOverrides??[]}))}s(!0)}catch(a){b(a?.response?.data?.error??e("genericError"))}finally{m(!1)}})()},[e,a.pathname]);let k=()=>{"undefined"!=typeof localStorage&&localStorage.setItem("onboarding_dismissed","1"),s(!1)},C=async()=>{if(!f.partnerId||!f.partnerKey||!f.accessToken||!f.shopId)return b(e("fieldRequired")),!1;h(!0),b("");try{return await o.Z.post("/api/credentials/shopee",f),(0,d.M)(e("shopeeSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("shopeeSaveError");return b(a),(0,d.M)(a,"error"),!1}finally{h(!1)}},D=async()=>{if(!S.email||!S.password)return b(e("fieldRequired")),!1;h(!0),b("");try{return await o.Z.post("/api/credentials/amazon",S),N(e=>({...e,password:""})),(0,d.M)(e("credentialsSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("credentialsSaveError");return b(a),(0,d.M)(a,"error"),!1}finally{h(!1)}},M=async()=>{if(!T.shopIds.length&&y.length)return b(e("fieldRequired")),!1;h(!0),b("");try{return await o.Z.post("/api/settings",T),(0,d.M)(e("settingsSaveSuccess")),!0}catch(t){let a=t?.response?.data?.error??e("settingsSaveError");return b(a),(0,d.M)(a,"error"),!1}finally{h(!1)}},P=async()=>{b("");let e=I[c].type;if("welcome"===e||"done"===e){if(c===I.length-1){k();return}p(e=>e+1);return}if("shopee"===e){await C()&&p(e=>e+1);return}if("amazon"===e){await D()&&p(e=>e+1);return}"settings"===e&&await M()&&k()};if(!t||g)return null;let z=I[c];return i.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",justifyContent:"center",padding:20,zIndex:1e4},role:"dialog","aria-modal":"true","aria-labelledby":"onboarding-modal-title",children:(0,i.jsxs)("div",{className:"card",style:{maxWidth:720,width:"100%",padding:28,position:"relative",background:"#fff",boxShadow:"0 25px 60px rgba(15, 23, 42, 0.25)"},children:[i.jsx("button",{onClick:k,"aria-label":e("close"),style:{position:"absolute",top:12,right:12,border:"none",background:"transparent",fontSize:20,cursor:"pointer",color:"#475569"},children:"\xd7"}),i.jsx("p",{style:{margin:0,color:"#0f172a",fontWeight:700,letterSpacing:.5},children:e("onboardingModalTitle")}),(0,i.jsxs)("div",{style:{marginTop:12},children:[i.jsx("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:I.map((e,a)=>(0,i.jsxs)("span",{className:"pill",style:{background:a===c?"#2563eb":"#e2e8f0",color:a===c?"#fff":"#0f172a"},children:[a+1," / ",I.length]},a))}),i.jsx("h3",{id:"onboarding-modal-title",style:{margin:"8px 0",color:"#0f172a"},children:z.title}),i.jsx("p",{style:{color:"#475569",lineHeight:1.5},children:z.desc}),x&&i.jsx("p",{style:{color:"#ef4444"},children:x}),"welcome"===z.type&&i.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:i.jsx("p",{children:e("onboardingModalWelcomeBlurb")})}),"shopee"===z.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("partnerId")}),i.jsx("input",{className:"input",value:f.partnerId,onChange:e=>j({...f,partnerId:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("partnerKey")}),i.jsx("input",{className:"input",type:"password",value:f.partnerKey,onChange:e=>j({...f,partnerKey:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("accessToken")}),i.jsx("input",{className:"input",type:"password",value:f.accessToken,onChange:e=>j({...f,accessToken:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("baseUrl")}),i.jsx("input",{className:"input",value:f.baseUrl,onChange:e=>j({...f,baseUrl:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("shopId")}),i.jsx("input",{className:"input",value:f.shopId,onChange:e=>j({...f,shopId:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("shopName")}),i.jsx("input",{className:"input",value:f.shopName,onChange:e=>j({...f,shopName:e.currentTarget.value})})]})]}),"amazon"===z.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("amazonEmail")}),i.jsx("input",{className:"input",type:"email",value:S.email,onChange:e=>N({...S,email:e.currentTarget.value})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("amazonPassword")}),i.jsx("input",{className:"input",type:"password",value:S.password,onChange:e=>N({...S,password:e.currentTarget.value})})]})]}),"settings"===z.type&&(0,i.jsxs)("div",{className:"grid grid-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("maxShippingDays")}),i.jsx("input",{className:"input",type:"number",value:T.maxShippingDays,onChange:e=>w({...T,maxShippingDays:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("minProfit")}),i.jsx("input",{className:"input",type:"number",value:T.minExpectedProfit,onChange:e=>w({...T,minExpectedProfit:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:T.includeAmazonPoints,onChange:e=>w({...T,includeAmazonPoints:e.currentTarget.checked})}),e("includePointsLabel")]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:T.includeDomesticShipping,onChange:e=>w({...T,includeDomesticShipping:e.currentTarget.checked})}),e("includeDomesticLabel")]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"label",children:e("domesticShippingCost")}),i.jsx("input",{className:"input",type:"number",value:T.domesticShippingCost,onChange:e=>w({...T,domesticShippingCost:Number(e.currentTarget.value)})})]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:T.isActive,onChange:e=>w({...T,isActive:e.currentTarget.checked})}),e("autoShipping")]})]}),"done"===z.type&&i.jsx("div",{style:{color:"#475569",lineHeight:1.5},children:i.jsx("p",{children:e("onboardingModalCompleteDesc")})}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap"},children:[i.jsx("button",{className:"btn btn-ghost",onClick:()=>p(e=>Math.max(0,e-1)),disabled:0===c||u,children:e("prev")}),i.jsx("button",{className:"btn",onClick:P,disabled:u,children:u?e("loading"):c===I.length-1?e("finish"):e("next")}),i.jsx("button",{className:"btn btn-ghost",onClick:k,children:e("skip")})]})]})]})})}o=(c.then?(await c)():c)[0],s()}catch(e){s(e)}})},1522:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{Z:()=>r});var i=t(9648),l=e([i]);let n=(i=(l.then?(await l)():l)[0]).default.create({baseURL:"https://automation-api-tau.vercel.app"});n.defaults.adapter,n.interceptors.request.use(e=>{let a=e.url||"";if(a.startsWith("/api/orders/"))e.url=a.replace("/api","");else for(let t of["/api/settings","/api/credentials/","/api/shops","/api/admin/","/api/ops/","/api/auth/","/api/mappings","/api/products/","/api/profit/"])if(a.startsWith(t)){e.url=a.replace("/api","");break}return e}),n.interceptors.response.use(e=>e,e=>(e.response?.status,Promise.reject(e)));let r=n;s()}catch(e){s(e)}})}};