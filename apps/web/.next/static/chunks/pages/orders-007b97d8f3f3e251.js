(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[660],{1046:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orders",function(){return s(9456)}])},2684:function(e,r,s){"use strict";s.d(r,{Z:function(){return d}});var t=s(2322),a=s(9097),n=s.n(a),o=s(1297),i=s(34),l=s(2784);function d(e){let{activeHref:r}=e,{t:s}=(0,i.$G)("common"),[a,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!!(localStorage.getItem("token")||sessionStorage.getItem("token")))},[]);let c=[{href:"/",label:s("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:s("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:s("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:s("navSettings"),icon:"⚙️"},{href:"/errors",label:s("navErrors"),icon:"⚠️"},{href:"/review",label:s("navReview"),icon:"✅"},{href:"/ops",label:s("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:s("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:s("navAdmin"),icon:"\uD83D\uDC64"}];return(0,t.jsxs)("header",{className:"nav",children:[(0,t.jsx)("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,t.jsxs)("div",{className:"nav-links",children:[c.map(e=>(0,t.jsxs)(n(),{href:e.href,style:{fontWeight:e.href===r?700:500,color:e.href===r?"var(--color-text)":"var(--color-text-muted)",background:e.href===r?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[(0,t.jsx)("span",{children:e.icon}),e.label]},e.href)),!a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===r?700:500,marginLeft:8},children:s("login")}),(0,t.jsx)(n(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===r?700:500},children:s("signup")})]}),(0,t.jsx)(o.Z,{})]})]})}},1297:function(e,r,s){"use strict";s.d(r,{Z:function(){return o}});var t=s(2322),a=s(5632),n=s(34);function o(){let e=(0,a.useRouter)(),{t:r}=(0,n.$G)("common"),{locale:s,pathname:o,asPath:i,query:l}=e,d="en"===s?"ja":"en",c=r("en"===d?"langEnglish":"langJapanese"),p=r("en"===d?"langEnglishShort":"langJapaneseShort");return(0,t.jsx)("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:o,query:l},i,{locale:d}),"aria-label":r("switchLanguage",{lang:c}),children:p})}},5697:function(e,r,s){"use strict";s.d(r,{Z:function(){return a}});var t=s(2322);function a(e){var r;let{status:s,labels:a}=e,n=(null==s?void 0:null===(r=s.toUpperCase)||void 0===r?void 0:r.call(s))||"",o="#cbd5e1",i="#0f172a",l=s;return["FULFILLED","PLACED"].includes(n)?(o="#dcfce7",i="#166534",l=a.success):["FAILED","SKIPPED"].includes(n)?(o="#fee2e2",i="#991b1b",l=a.error):["QUEUED","PROCESSING","UNPROCESSED"].includes(n)?(o="#e0f2fe",i="#075985",l=a.pending):["MANUAL_REVIEW"].includes(n)&&(o="#e2e8f0",i="#0f172a",l=a.manual),(0,t.jsx)("span",{style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:o,color:i},children:l})}},1522:function(e,r,s){"use strict";var t=s(418),a=s(3542);let n=t.Z.create(),o=n.defaults.adapter;if(n.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(r))}return e}),"1"===a.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},r=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:r,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:r},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async s=>{let t=(s.url||"").replace(/^https?:\/\/[^/]+/,""),a=(s.method||"get").toLowerCase(),n=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:r,statusText:"OK",headers:{},config:s})};if("/api/auth/login"===t&&"post"===a||"/api/auth/signup"===t&&"post"===a)return n({token:"mock-token"});if("/api/shops"===t&&"get"===a)return n(e.shops);if("/api/credentials/shopee"===t&&"get"===a)return n(e.shopeeCred);if("/api/credentials/shopee"===t&&"post"===a)return e.shopeeCred={...s.data},n({success:!0});if("/api/credentials/amazon"===t&&"get"===a)return n(e.amazonCred);if("/api/credentials/amazon"===t&&"post"===a)return e.amazonCred={...s.data},n({success:!0});if("/api/settings"===t&&"get"===a)return n(e.settings);if("/api/settings"===t&&"post"===a)return e.settings={...s.data,shopSelections:e.settings.shopSelections},n({success:!0});if("/api/orders/recent"===t&&"get"===a)return n(e.orders);if("/api/orders/errors"===t&&"get"===a)return n(e.orders.flatMap(e=>e.errorItems.map(r=>({...r,shopeeOrderId:e.orderNumber,productName:r.productName||"Product",createdAt:r.createdAt}))));if(t.startsWith("/api/orders/")&&t.endsWith("/retry")&&"post"===a||t.startsWith("/api/orders/retry/")&&"post"===a||t.startsWith("/api/orders/manual/")&&"post"===a||"/api/orders/poll-now"===t&&"post"===a)return n({success:!0});if("/api/orders/errors/export"===t&&"get"===a)return n("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===t&&"get"===a)return n("orderNumber,status\nSP-002,Processed",200);if(t.startsWith("/api/orders/")&&"get"===a){let r=t.split("/").pop();return n(e.orders.find(e=>e.id===r)||e.orders[0])}return"/api/ops/queue"===t&&"get"===a?n({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===t&&"post"===a?n({success:!0}):"/api/ops/status"===t&&"get"===a?n({lastOrder:r,lastAmazon:{createdAt:r,status:"ok"},lastError:{createdAt:r,reason:"Mock error"}}):"/api/mappings"===t&&"get"===a?n(e.mappings):"/api/mappings"===t&&"post"===a?(e.mappings.push({id:"map-".concat(Date.now()),...s.data||{}}),n({success:!0})):"/api/mappings/import"===t&&"post"===a||"/api/products/shopee"===t&&"post"===a||"/api/products/amazon"===t&&"post"===a?n({success:!0}):"/api/products/shopee"===t&&"get"===a?n(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===t&&"get"===a?n(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===t&&"get"===a?n(e.adminUsers):t.includes("/api/admin/users/")&&t.endsWith("/toggle")&&"post"===a||t.includes("/api/admin/users/")&&t.endsWith("/reset-password")&&"post"===a?n({success:!0}):"/api/admin/audit"===t&&"get"===a?n(e.audit):o&&"function"==typeof o?o(s):n({},404)}}n.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),r.Z=n},9456:function(e,r,s){"use strict";s.r(r),s.d(r,{__N_SSG:function(){return m},default:function(){return g}});var t=s(2322),a=s(6627),n=s(34),o=s(2684),i=s(9097),l=s.n(i),d=s(2784),c=s(1522),p=s(8406),u=s(5697);let h=e=>c.Z.get(e).then(e=>e.data);var m=!0;function g(){var e;let{t:r}=(0,n.$G)("common"),{data:s,error:i}=(0,a.ZP)("/api/orders/recent",h,{revalidateOnFocus:!1}),[m,g]=(0,d.useState)("all"),[f,v]=(0,d.useState)(""),[S,x]=(0,d.useState)(1),[b,y]=(0,d.useState)(!1),[j,D]=(0,d.useState)(new Set),[C,E]=(0,d.useState)(new Set),[P,I]=(0,d.useState)("order"),[k,w]=(0,d.useState)("desc"),O=async()=>{y(!0);try{await c.Z.post("/api/orders/poll-now",{}),(0,p.M)(r("actionPollSuccess"))}catch(a){var e,s,t;(0,p.M)(null!==(t=null==a?void 0:null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)&&void 0!==t?t:r("actionPollError"),"error")}finally{y(!1)}},N=async e=>{D(r=>new Set(r).add(e));try{await c.Z.post("/api/orders/retry/".concat(e)),(0,p.M)(r("retrySuccess"))}catch(e){var s,t,a;(0,p.M)(null!==(a=null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)&&void 0!==a?a:r("actionRetryError"),"error")}finally{D(r=>{let s=new Set(r);return s.delete(e),s})}},z=async e=>{E(r=>new Set(r).add(e));try{await c.Z.post("/api/orders/manual/".concat(e)),(0,p.M)(r("actionManualSuccess"))}catch(e){var s,t,a;(0,p.M)(null!==(a=null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)&&void 0!==a?a:r("actionManualError"),"error")}finally{E(r=>{let s=new Set(r);return s.delete(e),s})}},A=e=>(0,t.jsx)(u.Z,{status:e.processingStatus,labels:{success:r("statusProcessed"),error:r("statusError"),pending:r("statusPending"),manual:r("ordersTableManual")}}),T=(0,d.useMemo)(()=>s?s.filter(e=>"processed"===m?"FULFILLED"===e.processingStatus:"error"===m?"FAILED"===e.processingStatus||"SKIPPED"===e.processingStatus||e.errorItems.length:"pending"!==m||!e.amazonOrder&&("QUEUED"===e.processingStatus||"PROCESSING"===e.processingStatus||"UNPROCESSED"===e.processingStatus)).filter(e=>e.shopeeOrderSn.toLowerCase().includes(f.toLowerCase())).sort((e,r)=>"order"===P?"asc"===k?e.shopeeOrderSn.localeCompare(r.shopeeOrderSn):r.shopeeOrderSn.localeCompare(e.shopeeOrderSn):"asc"===k?e.processingStatus.localeCompare(r.processingStatus):r.processingStatus.localeCompare(e.processingStatus)):[],[s,m,f,P,k]);return(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)(o.Z,{activeHref:"/orders"}),(0,t.jsxs)("div",{className:"card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:r("orders")}),(0,t.jsx)("p",{children:r("ordersDesc")})]}),(0,t.jsx)("div",{style:{display:"flex",gap:8},children:(0,t.jsx)("button",{className:"btn",onClick:O,disabled:b,children:b?r("loading"):r("pollButton")})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap",alignItems:"center"},children:[["all","processed","error","pending"].map(e=>(0,t.jsxs)("button",{className:"button",style:{background:m===e?"#2563eb":"#cbd5e1",color:m===e?"#fff":"#0f172a"},onClick:()=>g(e),children:["all"===e&&r("filterAll"),"processed"===e&&r("filterProcessed"),"error"===e&&r("filterError"),"pending"===e&&r("filterPending")]},e)),(0,t.jsx)("input",{className:"input",placeholder:r("searchOrderId"),style:{maxWidth:240,marginBottom:0},value:f,onChange:e=>{v(e.target.value),x(1)}})]}),!s&&!i&&(0,t.jsx)("p",{children:r("loading")}),i&&(0,t.jsx)("p",{style:{color:"#ef4444"},children:r("genericError")}),0===T.length&&s&&(0,t.jsx)("p",{children:null!==(e=r("noOrdersMsg"))&&void 0!==e?e:r("noOrders")}),T.length>0&&(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:720},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsxs)("th",{style:{cursor:"pointer"},onClick:()=>{I("order"),w(e=>"asc"===e?"desc":"asc")},children:[r("orders")," ","order"===P?"asc"===k?"↑":"↓":""]}),(0,t.jsxs)("th",{style:{cursor:"pointer"},onClick:()=>{I("status"),w(e=>"asc"===e?"desc":"asc")},children:[r("ordersTableStatus")," ","status"===P?"asc"===k?"↑":"↓":""]}),(0,t.jsx)("th",{children:r("ordersTableDecision")}),(0,t.jsx)("th",{children:r("ordersTableAmazon")}),(0,t.jsx)("th",{children:r("ordersTableAction")}),(0,t.jsx)("th",{children:r("ordersTableManual")})]})}),(0,t.jsx)("tbody",{children:T.slice((S-1)*10,10*S).map(e=>{var s,a,n,o;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(l(),{href:"/orders/".concat(e.id),style:{color:"#2563eb"},children:e.shopeeOrderSn})}),(0,t.jsx)("td",{children:A(e)}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.errorItems.length?e.errorItems[0].reason||e.errorItems[0].errorCode:e.processingStatus,e.processingMode?(0,t.jsx)("span",{style:{color:"#475569",fontSize:12},children:e.processingMode}):null]})}),(0,t.jsx)("td",{children:e.amazonOrder?e.amazonOrder.amazonOrderId||r("statusPending"):"-"}),(0,t.jsx)("td",{children:"FULFILLED"!==e.processingStatus&&(0,t.jsx)("button",{className:"btn btn-ghost",onClick:()=>N(e.id),disabled:j.has(e.id),children:j.has(e.id)?r("loading"):r("retry")})}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(null===(s=e.rawPayload)||void 0===s?void 0:s.amazonProductUrl)||(null===(a=e.errorItems[0])||void 0===a?void 0:a.amazonProductUrl)?(0,t.jsx)("a",{className:"btn btn-ghost",href:(null===(n=e.rawPayload)||void 0===n?void 0:n.amazonProductUrl)||(null===(o=e.errorItems[0])||void 0===o?void 0:o.amazonProductUrl),target:"_blank",rel:"noreferrer",children:r("amazonPage")}):null,(0,t.jsx)("button",{className:"btn btn-ghost",onClick:()=>z(e.id),disabled:C.has(e.id),children:C.has(e.id)?r("loading"):r("manualOrder")})]})})]},e.id)})})]})}),T.length>10&&(0,t.jsxs)("div",{style:{display:"flex",gap:8,marginTop:12},children:[(0,t.jsx)("button",{className:"btn btn-ghost",disabled:1===S,onClick:()=>x(e=>Math.max(1,e-1)),children:r("prev")}),(0,t.jsx)("button",{className:"btn btn-ghost",disabled:10*S>=T.length,onClick:()=>x(e=>e+1),children:r("next")})]})]})]})}}},function(e){e.O(0,[418,97,627,888,774,179],function(){return e(e.s=1046)}),_N_E=e.O()}]);