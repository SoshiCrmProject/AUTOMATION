(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{9005:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/errors",function(){return t(2714)}])},2684:function(e,r,t){"use strict";t.d(r,{Z:function(){return d}});var s=t(2322),o=t(9097),a=t.n(o),n=t(1297),i=t(34),l=t(2784);function d(e){let{activeHref:r}=e,{t}=(0,i.$G)("common"),[o,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!!(localStorage.getItem("token")||sessionStorage.getItem("token")))},[]);let c=[{href:"/",label:t("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:t("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:t("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:t("navSettings"),icon:"⚙️"},{href:"/errors",label:t("navErrors"),icon:"⚠️"},{href:"/review",label:t("navReview"),icon:"✅"},{href:"/ops",label:t("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:t("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:t("navAdmin"),icon:"\uD83D\uDC64"}];return(0,s.jsxs)("header",{className:"nav",children:[(0,s.jsx)("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,s.jsxs)("div",{className:"nav-links",children:[c.map(e=>(0,s.jsxs)(a(),{href:e.href,style:{fontWeight:e.href===r?700:500,color:e.href===r?"var(--color-text)":"var(--color-text-muted)",background:e.href===r?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)("span",{children:e.icon}),e.label]},e.href)),!o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===r?700:500,marginLeft:8},children:t("login")}),(0,s.jsx)(a(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===r?700:500},children:t("signup")})]}),(0,s.jsx)(n.Z,{})]})]})}},1297:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});var s=t(2322),o=t(5632),a=t(34);function n(){let e=(0,o.useRouter)(),{t:r}=(0,a.$G)("common"),{locale:t,pathname:n,asPath:i,query:l}=e,d="en"===t?"ja":"en",c=r("en"===d?"langEnglish":"langJapanese"),p=r("en"===d?"langEnglishShort":"langJapaneseShort");return(0,s.jsx)("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:n,query:l},i,{locale:d}),"aria-label":r("switchLanguage",{lang:c}),children:p})}},1522:function(e,r,t){"use strict";var s=t(418),o=t(3542);let a=s.Z.create(),n=a.defaults.adapter;if(a.interceptors.request.use(e=>{{let r=localStorage.getItem("token");r&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(r))}return e}),"1"===o.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},r=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:r,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:r},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),a.defaults.adapter=async t=>{let s=(t.url||"").replace(/^https?:\/\/[^/]+/,""),o=(t.method||"get").toLowerCase(),a=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:r,statusText:"OK",headers:{},config:t})};if("/api/auth/login"===s&&"post"===o||"/api/auth/signup"===s&&"post"===o)return a({token:"mock-token"});if("/api/shops"===s&&"get"===o)return a(e.shops);if("/api/credentials/shopee"===s&&"get"===o)return a(e.shopeeCred);if("/api/credentials/shopee"===s&&"post"===o)return e.shopeeCred={...t.data},a({success:!0});if("/api/credentials/amazon"===s&&"get"===o)return a(e.amazonCred);if("/api/credentials/amazon"===s&&"post"===o)return e.amazonCred={...t.data},a({success:!0});if("/api/settings"===s&&"get"===o)return a(e.settings);if("/api/settings"===s&&"post"===o)return e.settings={...t.data,shopSelections:e.settings.shopSelections},a({success:!0});if("/api/orders/recent"===s&&"get"===o)return a(e.orders);if("/api/orders/errors"===s&&"get"===o)return a(e.orders.flatMap(e=>e.errorItems.map(r=>({...r,shopeeOrderId:e.orderNumber,productName:r.productName||"Product",createdAt:r.createdAt}))));if(s.startsWith("/api/orders/")&&s.endsWith("/retry")&&"post"===o||s.startsWith("/api/orders/retry/")&&"post"===o||s.startsWith("/api/orders/manual/")&&"post"===o||"/api/orders/poll-now"===s&&"post"===o)return a({success:!0});if("/api/orders/errors/export"===s&&"get"===o)return a("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===s&&"get"===o)return a("orderNumber,status\nSP-002,Processed",200);if(s.startsWith("/api/orders/")&&"get"===o){let r=s.split("/").pop();return a(e.orders.find(e=>e.id===r)||e.orders[0])}return"/api/ops/queue"===s&&"get"===o?a({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===s&&"post"===o?a({success:!0}):"/api/ops/status"===s&&"get"===o?a({lastOrder:r,lastAmazon:{createdAt:r,status:"ok"},lastError:{createdAt:r,reason:"Mock error"}}):"/api/mappings"===s&&"get"===o?a(e.mappings):"/api/mappings"===s&&"post"===o?(e.mappings.push({id:"map-".concat(Date.now()),...t.data||{}}),a({success:!0})):"/api/mappings/import"===s&&"post"===o||"/api/products/shopee"===s&&"post"===o||"/api/products/amazon"===s&&"post"===o?a({success:!0}):"/api/products/shopee"===s&&"get"===o?a(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===s&&"get"===o?a(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===s&&"get"===o?a(e.adminUsers):s.includes("/api/admin/users/")&&s.endsWith("/toggle")&&"post"===o||s.includes("/api/admin/users/")&&s.endsWith("/reset-password")&&"post"===o?a({success:!0}):"/api/admin/audit"===s&&"get"===o?a(e.audit):n&&"function"==typeof n?n(t):a({},404)}}a.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),r.Z=a},2714:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSG:function(){return u},default:function(){return h}});var s=t(2322),o=t(6627),a=t(34),n=t(2684);function i(e){let{items:r,selectable:t,selected:o,onToggle:n}=e,{t:i}=(0,a.$G)("common");return r.length?(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[t&&(0,s.jsx)("th",{}),(0,s.jsx)("th",{style:{textAlign:"left"},children:i("orders")}),(0,s.jsx)("th",{style:{textAlign:"left"},children:i("reason")}),(0,s.jsx)("th",{style:{textAlign:"left"},children:i("amazon")}),(0,s.jsx)("th",{style:{textAlign:"left"},children:i("createdAt")})]})}),(0,s.jsx)("tbody",{children:r.map(e=>{var r,a,l,d,c;let p=null!==(a=e.shopeeOrderId)&&void 0!==a?a:e.id,u=null!==(l=null==o?void 0:o.has(p))&&void 0!==l&&l;return(0,s.jsxs)("tr",{children:[t&&(0,s.jsx)("td",{children:(0,s.jsx)("input",{type:"checkbox",checked:u,onChange:()=>{var r;return null==n?void 0:n(e.id,null!==(r=e.shopeeOrderId)&&void 0!==r?r:void 0)}})}),(0,s.jsx)("td",{style:{padding:"6px 4px"},children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,s.jsx)("strong",{children:null!==(d=e.shopeeOrderId)&&void 0!==d?d:p}),e.amazonProductUrl?(0,s.jsx)("a",{href:e.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:i("amazonPage")}):null]})}),(0,s.jsx)("td",{children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,s.jsx)("span",{children:e.reason||e.errorCode}),e.errorCode&&(0,s.jsx)("span",{style:{color:"#475569",fontSize:12},children:e.errorCode}),e.filterFailureType&&(0,s.jsx)("span",{style:{color:"#475569",fontSize:12},children:e.filterFailureType}),null!==e.profitValue&&void 0!==e.profitValue&&(0,s.jsxs)("span",{style:{color:"#475569",fontSize:12},children:[i("minProfit"),": ",e.profitValue]}),null!==e.shippingDays&&void 0!==e.shippingDays&&(0,s.jsxs)("span",{style:{color:"#475569",fontSize:12},children:[null!==(c=i("shippingDaysLabel"))&&void 0!==c?c:"Shipping days",": ",e.shippingDays]}),(null===(r=e.metadata)||void 0===r?void 0:r.screenshot)&&(0,s.jsx)("a",{href:e.metadata.screenshot,target:"_blank",rel:"noreferrer",style:{color:"#2563eb",fontSize:12},children:i("openLink")})]})}),(0,s.jsx)("td",{children:e.amazonProductUrl?(0,s.jsx)("a",{href:e.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:i("amazonPage")}):"—"}),(0,s.jsx)("td",{children:new Date(e.createdAt).toLocaleString()})]},e.id)})})]}):(0,s.jsx)("p",{children:i("noErrors")})}var l=t(2784),d=t(1522),c=t(8406);let p=e=>d.Z.get(e).then(e=>e.data);var u=!0;function h(){let{t:e}=(0,a.$G)("common"),{data:r,error:t}=(0,o.ZP)("/api/orders/errors",p,{revalidateOnFocus:!1}),[u,h]=(0,l.useState)(""),[m,g]=(0,l.useState)(new Set),[f,v]=(0,l.useState)(!1),[x,y]=(0,l.useState)(!1),[b,S]=(0,l.useState)("desc"),j=async()=>{v(!0);try{let r=await d.Z.get("/api/orders/errors/export",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([r.data])),s=document.createElement("a");s.href=t,s.setAttribute("download",e("errorItemsFile")),document.body.appendChild(s),s.click()}catch(o){var r,t,s;(0,c.M)(null!==(s=null==o?void 0:null===(t=o.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.error)&&void 0!==s?s:e("downloadError"),"error")}finally{v(!1)}},D=async()=>{y(!0);try{await Promise.all(Array.from(m).map(e=>d.Z.post("/api/orders/retry/".concat(e)))),g(new Set),(0,c.M)(e("actionRetrySelectedSuccess"))}catch(o){var r,t,s;(0,c.M)(null!==(s=null==o?void 0:null===(t=o.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.error)&&void 0!==s?s:e("actionRetrySelectedError"),"error")}finally{y(!1)}},w=(0,l.useMemo)(()=>(null!=r?r:[]).filter(e=>{var r,t,s,o;let a=u.toLowerCase();return(null!==(r=e.reason)&&void 0!==r?r:"").toLowerCase().includes(a)||(null!==(t=e.errorCode)&&void 0!==t?t:"").toLowerCase().includes(a)||(null!==(s=e.amazonProductUrl)&&void 0!==s?s:"").toLowerCase().includes(a)||(null!==(o=e.shopeeOrderId)&&void 0!==o?o:"").toLowerCase().includes(a)}).sort((e,r)=>{let t=new Date(e.createdAt).getTime(),s=new Date(r.createdAt).getTime();return"asc"===b?t-s:s-t}),[r,u,b]);return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)(n.Z,{activeHref:"/errors"}),(0,s.jsx)("h1",{children:e("errorFile")}),(0,s.jsx)("p",{children:e("errorFileDesc")}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:j,disabled:f,children:f?e("loading"):e("openFile")}),m.size>0&&(0,s.jsx)("button",{className:"btn",onClick:D,disabled:x,children:x?e("loading"):e("retrySelectedLabel",{count:m.size})})]}),(0,s.jsxs)("div",{className:"card",style:{marginTop:"16px"},children:[(0,s.jsx)("input",{className:"input",placeholder:e("search")||"Search",style:{maxWidth:300},value:u,onChange:e=>h(e.target.value)}),(0,s.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center"},children:(0,s.jsxs)("button",{className:"btn btn-ghost",onClick:()=>S(e=>"asc"===e?"desc":"asc"),children:[e("createdAt")," ","asc"===b?"↑":"↓"]})}),!r&&!t&&(0,s.jsx)("p",{children:e("loading")}),t&&(0,s.jsx)("p",{style:{color:"#ef4444"},children:e("genericError")}),r&&(0,s.jsx)("div",{className:"table-responsive",children:(0,s.jsx)(i,{selectable:!0,selected:m,onToggle:(e,r)=>{let t=null!=r?r:e,s=new Set(m);s.has(t)?s.delete(t):s.add(t),g(s)},items:w})})]})]})}}},function(e){e.O(0,[418,97,627,888,774,179],function(){return e(e.s=9005)}),_N_E=e.O()}]);