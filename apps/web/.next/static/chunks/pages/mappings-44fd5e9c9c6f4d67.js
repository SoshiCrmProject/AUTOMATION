(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[679],{6096:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mappings",function(){return s(760)}])},2684:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(2322),r=s(9097),n=s.n(r),o=s(1297),i=s(34),l=s(2784);function d(e){let{activeHref:t}=e,{t:s}=(0,i.$G)("common"),[r,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!!(localStorage.getItem("token")||sessionStorage.getItem("token")))},[]);let p=[{href:"/",label:s("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:s("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:s("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:s("navSettings"),icon:"⚙️"},{href:"/errors",label:s("navErrors"),icon:"⚠️"},{href:"/review",label:s("navReview"),icon:"✅"},{href:"/ops",label:s("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:s("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:s("navAdmin"),icon:"\uD83D\uDC64"}];return(0,a.jsxs)("header",{className:"nav",children:[(0,a.jsx)("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,a.jsxs)("div",{className:"nav-links",children:[p.map(e=>(0,a.jsxs)(n(),{href:e.href,style:{fontWeight:e.href===t?700:500,color:e.href===t?"var(--color-text)":"var(--color-text-muted)",background:e.href===t?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{children:e.icon}),e.label]},e.href)),!r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===t?700:500,marginLeft:8},children:s("login")}),(0,a.jsx)(n(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===t?700:500},children:s("signup")})]}),(0,a.jsx)(o.Z,{})]})]})}},1297:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(2322),r=s(5632),n=s(34);function o(){let e=(0,r.useRouter)(),{t}=(0,n.$G)("common"),{locale:s,pathname:o,asPath:i,query:l}=e,d="en"===s?"ja":"en",p=t("en"===d?"langEnglish":"langJapanese"),c=t("en"===d?"langEnglishShort":"langJapaneseShort");return(0,a.jsx)("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:o,query:l},i,{locale:d}),"aria-label":t("switchLanguage",{lang:p}),children:c})}},1522:function(e,t,s){"use strict";var a=s(418),r=s(3542);let n=a.Z.create(),o=n.defaults.adapter;if(n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t))}return e}),"1"===r.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async s=>{let a=(s.url||"").replace(/^https?:\/\/[^/]+/,""),r=(s.method||"get").toLowerCase(),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:s})};if("/api/auth/login"===a&&"post"===r||"/api/auth/signup"===a&&"post"===r)return n({token:"mock-token"});if("/api/shops"===a&&"get"===r)return n(e.shops);if("/api/credentials/shopee"===a&&"get"===r)return n(e.shopeeCred);if("/api/credentials/shopee"===a&&"post"===r)return e.shopeeCred={...s.data},n({success:!0});if("/api/credentials/amazon"===a&&"get"===r)return n(e.amazonCred);if("/api/credentials/amazon"===a&&"post"===r)return e.amazonCred={...s.data},n({success:!0});if("/api/settings"===a&&"get"===r)return n(e.settings);if("/api/settings"===a&&"post"===r)return e.settings={...s.data,shopSelections:e.settings.shopSelections},n({success:!0});if("/api/orders/recent"===a&&"get"===r)return n(e.orders);if("/api/orders/errors"===a&&"get"===r)return n(e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt}))));if(a.startsWith("/api/orders/")&&a.endsWith("/retry")&&"post"===r||a.startsWith("/api/orders/retry/")&&"post"===r||a.startsWith("/api/orders/manual/")&&"post"===r||"/api/orders/poll-now"===a&&"post"===r)return n({success:!0});if("/api/orders/errors/export"===a&&"get"===r)return n("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===a&&"get"===r)return n("orderNumber,status\nSP-002,Processed",200);if(a.startsWith("/api/orders/")&&"get"===r){let t=a.split("/").pop();return n(e.orders.find(e=>e.id===t)||e.orders[0])}return"/api/ops/queue"===a&&"get"===r?n({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===a&&"post"===r?n({success:!0}):"/api/ops/status"===a&&"get"===r?n({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}}):"/api/mappings"===a&&"get"===r?n(e.mappings):"/api/mappings"===a&&"post"===r?(e.mappings.push({id:"map-".concat(Date.now()),...s.data||{}}),n({success:!0})):"/api/mappings/import"===a&&"post"===r||"/api/products/shopee"===a&&"post"===r||"/api/products/amazon"===a&&"post"===r?n({success:!0}):"/api/products/shopee"===a&&"get"===r?n(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===a&&"get"===r?n(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===a&&"get"===r?n(e.adminUsers):a.includes("/api/admin/users/")&&a.endsWith("/toggle")&&"post"===r||a.includes("/api/admin/users/")&&a.endsWith("/reset-password")&&"post"===r?n({success:!0}):"/api/admin/audit"===a&&"get"===r?n(e.audit):o&&"function"==typeof o?o(s):n({},404)}}n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),t.Z=n},760:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSG:function(){return d},default:function(){return p}});var a=s(2322),r=s(2784),n=s(34),o=s(2684),i=s(1522),l=s(8406),d=!0;function p(){var e;let{t}=(0,n.$G)("common"),[s,d]=(0,r.useState)([]),[p,c]=(0,r.useState)([]),[u,h]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[v,f]=(0,r.useState)(""),[x,S]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[y,D]=(0,r.useState)(""),[N,C]=(0,r.useState)(""),[I,k]=(0,r.useState)(!1),[P,z]=(0,r.useState)(!1),[w,A]=(0,r.useState)(!1),E=async()=>{k(!0);try{let[e,t]=await Promise.all([i.Z.get("/api/shops"),i.Z.get("/api/mappings")]);c(e.data||[]),d(t.data||[])}catch(r){var e,s,a;(0,l.M)(null!==(a=null==r?void 0:null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)&&void 0!==a?a:t("genericError"),"error")}finally{k(!1)}};(0,r.useEffect)(()=>{E()},[]);let T=async()=>{if(b(""),!u||!m||!v){(0,l.M)(t("fieldRequired"),"error");return}z(!0);try{await i.Z.post("/api/mappings",{shopId:u,shopeeItemId:m,amazonProductUrl:v,notes:x||void 0}),h(""),g(""),f(""),S(""),b(t("mappingSaved")),(0,l.M)(t("mappingSaved")),E()}catch(r){var e,s,a;(0,l.M)(null!==(a=null==r?void 0:null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)&&void 0!==a?a:t("genericError"),"error")}finally{z(!1)}},O=(0,r.useMemo)(()=>s.filter(e=>{var t;let s=(null===(t=p.find(t=>t.id===e.shopId))||void 0===t?void 0:t.name)||"",a=y.toLowerCase();return e.shopeeItemId.toLowerCase().includes(a)||e.amazonProductUrl.toLowerCase().includes(a)||s.toLowerCase().includes(a)}),[y,s,p]);return(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)(o.Z,{activeHref:"/mappings"}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h1",{children:t("mappingsTitle")}),(0,a.jsx)("p",{style:{color:"#475569"},children:t("mappingsDescFull")}),(0,a.jsxs)("div",{className:"grid grid-3",style:{marginBottom:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:t("shopSelection")}),(0,a.jsxs)("select",{className:"select",value:u,onChange:e=>h(e.target.value),children:[(0,a.jsx)("option",{value:"",children:t("selectPlaceholder")}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:t("shopeeItemId")}),(0,a.jsx)("input",{className:"input",value:m,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:t("amazonProduct")}),(0,a.jsx)("input",{className:"input",value:v,onChange:e=>f(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-1",style:{marginBottom:12},children:[(0,a.jsx)("label",{className:"label",children:t("notes")||"Notes"}),(0,a.jsx)("textarea",{className:"input",value:x,onChange:e=>S(e.target.value)})]}),(0,a.jsx)("button",{className:"btn",onClick:T,disabled:P,children:P?t("loading"):t("saveMappingBtn")}),j&&(0,a.jsx)("p",{children:j})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{children:t("mappingsTitle")}),I&&(0,a.jsx)("p",{children:t("loading")}),(0,a.jsx)("input",{className:"input",placeholder:t("searchMappings")||"Search mappings...",style:{maxWidth:300},value:y,onChange:e=>D(e.target.value)}),0!==O.length||I?(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table",style:{minWidth:720},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:t("shopSelection")}),(0,a.jsx)("th",{children:t("shopeeProduct")}),(0,a.jsx)("th",{children:t("amazonProduct")}),(0,a.jsx)("th",{children:t("status")||"Status"})]})}),(0,a.jsx)("tbody",{children:O.map(e=>{var s,r;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:null!==(r=null===(s=p.find(t=>t.id===e.shopId))||void 0===s?void 0:s.name)&&void 0!==r?r:e.shopId}),(0,a.jsx)("td",{children:e.shopeeItemId}),(0,a.jsxs)("td",{children:[(0,a.jsx)("a",{href:e.amazonProductUrl,target:"_blank",rel:"noreferrer",style:{color:"#2563eb"},children:e.amazonProductUrl}),e.notes?(0,a.jsx)("div",{style:{color:"#475569",fontSize:12},children:e.notes}):null]}),(0,a.jsx)("td",{children:e.isActive?t("on"):t("off")})]},e.id)})})]})}):(0,a.jsx)("p",{children:null!==(e=t("noMappings"))&&void 0!==e?e:"No mappings yet."})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{children:t("bulkImportHint")}),(0,a.jsx)("textarea",{className:"input",style:{minHeight:120},placeholder:t("csvPlaceholder"),value:N,onChange:e=>C(e.target.value)}),(0,a.jsx)("button",{className:"btn btn-ghost",onClick:async()=>{A(!0);try{let e=N.split("\n").map(e=>e.trim()).filter(Boolean).map(e=>{let[t,s,a,r]=e.split(",");return{shopId:t,shopeeItemId:s,amazonProductUrl:a,notes:r}});await i.Z.post("/api/mappings/import",{rows:e}),C(""),E(),(0,l.M)(t("mappingSaved"))}catch(r){var e,s,a;(0,l.M)(null!==(a=null==r?void 0:null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)&&void 0!==a?a:t("genericError"),"error")}finally{A(!1)}},disabled:w,children:w?t("loading"):t("importCsvBtn")})]})]})}}},function(e){e.O(0,[418,97,888,774,179],function(){return e(e.s=6096)}),_N_E=e.O()}]);