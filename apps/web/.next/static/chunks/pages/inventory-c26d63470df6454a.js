(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[157],{7931:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/inventory",function(){return s(7010)}])},2684:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var r=s(2322),a=s(9097),n=s.n(a),o=s(1297),i=s(34),l=s(2784);function d(e){let{activeHref:t}=e,{t:s}=(0,i.$G)("common"),[a,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!!(localStorage.getItem("token")||sessionStorage.getItem("token")))},[]);let c=[{href:"/",label:s("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:s("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:s("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:s("navSettings"),icon:"⚙️"},{href:"/errors",label:s("navErrors"),icon:"⚠️"},{href:"/review",label:s("navReview"),icon:"✅"},{href:"/ops",label:s("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:s("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:s("navAdmin"),icon:"\uD83D\uDC64"}];return(0,r.jsxs)("header",{className:"nav",children:[(0,r.jsx)("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,r.jsxs)("div",{className:"nav-links",children:[c.map(e=>(0,r.jsxs)(n(),{href:e.href,style:{fontWeight:e.href===t?700:500,color:e.href===t?"var(--color-text)":"var(--color-text-muted)",background:e.href===t?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[(0,r.jsx)("span",{children:e.icon}),e.label]},e.href)),!a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===t?700:500,marginLeft:8},children:s("login")}),(0,r.jsx)(n(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===t?700:500},children:s("signup")})]}),(0,r.jsx)(o.Z,{})]})]})}},1297:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var r=s(2322),a=s(5632),n=s(34);function o(){let e=(0,a.useRouter)(),{t}=(0,n.$G)("common"),{locale:s,pathname:o,asPath:i,query:l}=e,d="en"===s?"ja":"en",c=t("en"===d?"langEnglish":"langJapanese"),p=t("en"===d?"langEnglishShort":"langJapaneseShort");return(0,r.jsx)("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:o,query:l},i,{locale:d}),"aria-label":t("switchLanguage",{lang:c}),children:p})}},1522:function(e,t,s){"use strict";var r=s(418),a=s(3542);let n=r.Z.create(),o=n.defaults.adapter;if(n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t))}return e}),"1"===a.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async s=>{let r=(s.url||"").replace(/^https?:\/\/[^/]+/,""),a=(s.method||"get").toLowerCase(),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:s})};if("/api/auth/login"===r&&"post"===a||"/api/auth/signup"===r&&"post"===a)return n({token:"mock-token"});if("/api/shops"===r&&"get"===a)return n(e.shops);if("/api/credentials/shopee"===r&&"get"===a)return n(e.shopeeCred);if("/api/credentials/shopee"===r&&"post"===a)return e.shopeeCred={...s.data},n({success:!0});if("/api/credentials/amazon"===r&&"get"===a)return n(e.amazonCred);if("/api/credentials/amazon"===r&&"post"===a)return e.amazonCred={...s.data},n({success:!0});if("/api/settings"===r&&"get"===a)return n(e.settings);if("/api/settings"===r&&"post"===a)return e.settings={...s.data,shopSelections:e.settings.shopSelections},n({success:!0});if("/api/orders/recent"===r&&"get"===a)return n(e.orders);if("/api/orders/errors"===r&&"get"===a)return n(e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt}))));if(r.startsWith("/api/orders/")&&r.endsWith("/retry")&&"post"===a||r.startsWith("/api/orders/retry/")&&"post"===a||r.startsWith("/api/orders/manual/")&&"post"===a||"/api/orders/poll-now"===r&&"post"===a)return n({success:!0});if("/api/orders/errors/export"===r&&"get"===a)return n("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===r&&"get"===a)return n("orderNumber,status\nSP-002,Processed",200);if(r.startsWith("/api/orders/")&&"get"===a){let t=r.split("/").pop();return n(e.orders.find(e=>e.id===t)||e.orders[0])}return"/api/ops/queue"===r&&"get"===a?n({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===r&&"post"===a?n({success:!0}):"/api/ops/status"===r&&"get"===a?n({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}}):"/api/mappings"===r&&"get"===a?n(e.mappings):"/api/mappings"===r&&"post"===a?(e.mappings.push({id:"map-".concat(Date.now()),...s.data||{}}),n({success:!0})):"/api/mappings/import"===r&&"post"===a||"/api/products/shopee"===r&&"post"===a||"/api/products/amazon"===r&&"post"===a?n({success:!0}):"/api/products/shopee"===r&&"get"===a?n(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===r&&"get"===a?n(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===r&&"get"===a?n(e.adminUsers):r.includes("/api/admin/users/")&&r.endsWith("/toggle")&&"post"===a||r.includes("/api/admin/users/")&&r.endsWith("/reset-password")&&"post"===a?n({success:!0}):"/api/admin/audit"===r&&"get"===a?n(e.audit):o&&"function"==typeof o?o(s):n({},404)}}n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),t.Z=n},7010:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSG:function(){return h},default:function(){return m}});var r=s(2322),a=s(2784),n=s(6627),o=s(34),i=s(1522),l=s(2684);function d(e){let{isOpen:t,onClose:s,title:n,children:i,size:l="md",showCloseButton:d=!0}=e,{t:c}=(0,o.$G)("common");return((0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&s()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,s]),t)?(0,r.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,r.jsxs)("div",{className:"modal-content ".concat({sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"}[l]),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"modal-header",children:[(0,r.jsx)("h2",{className:"modal-title",children:n}),d&&(0,r.jsx)("button",{className:"modal-close",onClick:s,"aria-label":"Close",children:"✕"})]}),(0,r.jsx)("div",{className:"modal-body",children:i})]})}):null}function c(e){let{isOpen:t,onClose:s,onSubmit:n,title:i,fields:l,size:c="md",submitLabel:p,cancelLabel:u}=e,{t:h}=(0,o.$G)("common"),[m,g]=(0,a.useState)({}),[x,v]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),f=(e,t)=>{g(s=>({...s,[e]:t}))},b=async e=>{e.preventDefault(),y(null),v(!0);try{await n(m),g({}),s()}catch(e){y(e.message||"An error occurred")}finally{v(!1)}},S=()=>{g({}),y(null),s()};return(0,r.jsx)(d,{isOpen:t,onClose:S,title:i,size:c,children:(0,r.jsxs)("form",{onSubmit:b,className:"form-modal",children:[j&&(0,r.jsx)("div",{className:"alert alert-error",children:(0,r.jsxs)("span",{children:["⚠️ ",j]})}),(0,r.jsx)("div",{className:"form-grid",children:l.map(e=>{var t;return(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsxs)("label",{htmlFor:e.name,className:"form-label",children:[e.label,e.required&&(0,r.jsx)("span",{className:"text-danger",children:" *"})]}),"select"===e.type?(0,r.jsxs)("select",{id:e.name,value:m[e.name]||"",onChange:t=>f(e.name,t.target.value),required:e.required,className:"form-select",children:[(0,r.jsx)("option",{value:"",children:"Select..."}),null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}):"textarea"===e.type?(0,r.jsx)("textarea",{id:e.name,value:m[e.name]||"",onChange:t=>f(e.name,t.target.value),placeholder:e.placeholder,required:e.required,rows:4,className:"form-textarea"}):(0,r.jsx)("input",{id:e.name,type:e.type,value:m[e.name]||"",onChange:t=>f(e.name,"number"===e.type?Number(t.target.value):t.target.value),placeholder:e.placeholder,required:e.required,className:"form-input"})]},e.name)})}),(0,r.jsxs)("div",{className:"modal-footer",children:[(0,r.jsx)("button",{type:"button",onClick:S,className:"btn btn-secondary",disabled:x,children:u||h("cancel")}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?h("saving"):p||h("save")})]})]})})}var p=s(8406);let u=e=>i.Z.get(e).then(e=>e.data);var h=!0;function m(){let{t:e}=(0,o.$G)("common"),[t,s]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[y,f]=(0,a.useState)(null),{data:b,mutate:S}=(0,n.ZP)(t?"/api/inventory/".concat(t):null,u),{data:N,mutate:k}=(0,n.ZP)(t?"/api/inventory/alerts/low-stock?shopId=".concat(t):null,u),{data:w}=(0,n.ZP)(y?"/api/inventory/movements?productId=".concat(y.productId):null,u),C=e=>{switch(e){case"IN_STOCK":return"success";case"LOW_STOCK":return"warning";case"OUT_OF_STOCK":return"error";default:return"info"}},D=async t=>{try{await i.Z.post("/api/inventory/alerts/".concat(t,"/acknowledge")),(0,p.M)(e("acknowledged"),"success"),k()}catch(e){(0,p.M)("Failed to acknowledge alert","error")}},I=async e=>{try{await i.Z.post("/api/inventory/stock/adjust",{shopId:t,productId:e.productId,quantityChange:Number(e.quantity),reason:e.reason,location:e.location}),(0,p.M)("Stock added successfully","success"),S()}catch(e){var s,r;throw Error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Failed to add stock")}},T=async e=>{try{await i.Z.put("/api/inventory/".concat(null==y?void 0:y.id,"/threshold"),{threshold:Number(e.threshold)}),(0,p.M)("Threshold updated successfully","success"),S()}catch(e){var t,s;throw Error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Failed to update threshold")}};return(0,r.jsxs)("div",{className:"shell",children:[(0,r.jsx)(l.Z,{activeHref:"/inventory"}),(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("div",{className:"hero",style:{marginBottom:32},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{style:{fontSize:36,margin:0},children:["\uD83D\uDCE6 ",e("inventoryTitle")]}),(0,r.jsx)("p",{style:{color:"var(--text-secondary)",marginTop:8},children:e("inventoryDesc")})]}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>m(!0),disabled:!t,children:["+ ",e("addStock")]})]}),(0,r.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,r.jsx)("label",{className:"form-label",children:e("shopId")}),(0,r.jsx)("input",{className:"form-input",type:"text",placeholder:e("enterShopId"),value:t,onChange:e=>s(e.target.value)})]}),!t&&(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:"\uD83D\uDCE6"}),(0,r.jsx)("h3",{children:e("getStarted")}),(0,r.jsx)("p",{children:e("enterShopIdDesc")})]}),t&&(0,r.jsxs)(r.Fragment,{children:[N&&N.length>0&&(0,r.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,r.jsxs)("h3",{style:{marginTop:0,display:"flex",alignItems:"center",gap:12},children:[(0,r.jsx)("span",{children:"⚠️"})," ",e("lowStockAlerts"),(0,r.jsx)("span",{className:"badge badge-error",children:N.length})]}),(0,r.jsx)("div",{style:{display:"grid",gap:16},children:N.map(t=>(0,r.jsxs)("div",{className:"alert alert-warning",style:{justifyContent:"space-between"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:[e("productId"),": ",t.productId]}),(0,r.jsxs)("div",{style:{fontSize:"0.875rem",marginTop:4},children:[e("currentStock"),": ",t.currentStock," / ",e("threshold"),": ",t.threshold]})]}),!t.acknowledged&&(0,r.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>D(t.id),children:e("acknowledge")})]},t.id))})]}),b&&b.length>0&&(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h3",{style:{marginTop:0},children:e("inventoryOverview")}),(0,r.jsx)("div",{className:"table-wrapper",children:(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:e("sku")}),(0,r.jsx)("th",{children:e("productId")}),(0,r.jsx)("th",{children:e("quantity")}),(0,r.jsx)("th",{children:e("location")}),(0,r.jsx)("th",{children:e("status")}),(0,r.jsx)("th",{children:e("threshold")}),(0,r.jsx)("th",{children:e("lastUpdated")}),(0,r.jsx)("th",{children:"Actions"})]})}),(0,r.jsx)("tbody",{children:b.map(t=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("code",{children:t.sku})}),(0,r.jsx)("td",{children:t.productId}),(0,r.jsx)("td",{children:(0,r.jsx)("strong",{children:t.quantity})}),(0,r.jsx)("td",{children:t.location}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"badge badge-".concat(C(t.status)),children:t.status})}),(0,r.jsx)("td",{children:t.lowStockThreshold}),(0,r.jsx)("td",{children:new Date(t.updatedAt).toLocaleDateString()}),(0,r.jsx)("td",{children:(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>{f(t),x(!0)},children:e("updateThreshold")}),(0,r.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>{f(t),j(!0)},children:e("stockHistory")})]})})]},t.id))})]})})]})]})]}),(0,r.jsx)(c,{isOpen:h,onClose:()=>m(!1),onSubmit:I,title:e("addStock"),submitLabel:e("add"),fields:[{name:"productId",label:e("productId"),type:"text",required:!0},{name:"quantity",label:e("quantity"),type:"number",required:!0},{name:"location",label:e("location"),type:"text",required:!0},{name:"reason",label:"Reason",type:"textarea",placeholder:"Restock, return, etc."}]}),(0,r.jsx)(c,{isOpen:g,onClose:()=>{x(!1),f(null)},onSubmit:T,title:e("updateThreshold"),submitLabel:e("update"),fields:[{name:"threshold",label:e("threshold"),type:"number",required:!0,placeholder:String((null==y?void 0:y.lowStockThreshold)||10)}]}),(0,r.jsx)(d,{isOpen:v,onClose:()=>{j(!1),f(null)},title:e("stockHistory"),size:"lg",children:w&&w.length>0?(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:e("date")}),(0,r.jsx)("th",{children:"Type"}),(0,r.jsx)("th",{children:"Change"}),(0,r.jsx)("th",{children:"Reason"}),(0,r.jsx)("th",{children:e("location")})]})}),(0,r.jsx)("tbody",{children:w.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"badge badge-".concat("IN"===e.movementType?"success":"warning"),children:e.movementType})}),(0,r.jsx)("td",{children:(0,r.jsxs)("strong",{style:{color:e.quantityChange>0?"var(--success)":"var(--warning)"},children:[e.quantityChange>0?"+":"",e.quantityChange]})}),(0,r.jsx)("td",{children:e.reason||"N/A"}),(0,r.jsx)("td",{children:e.location||"N/A"})]},e.id))})]}):(0,r.jsx)("p",{style:{textAlign:"center",padding:"2rem",color:"var(--text-secondary)"},children:"No history available"})}),(0,r.jsx)(p.Z,{})]})}}},function(e){e.O(0,[418,97,627,888,774,179],function(){return e(e.s=7931)}),_N_E=e.O()}]);