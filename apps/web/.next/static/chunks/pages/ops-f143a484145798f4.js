(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{7940:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ops",function(){return r(5153)}])},2684:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var s=r(2322),a=r(9097),n=r.n(a),o=r(1297),i=r(34),l=r(2784);function d(e){let{activeHref:t}=e,{t:r}=(0,i.$G)("common"),[a,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{d(!!(localStorage.getItem("token")||sessionStorage.getItem("token")))},[]);let c=[{href:"/",label:r("navHome"),icon:"\uD83C\uDFE0"},{href:"/dashboard",label:r("navDashboard"),icon:"\uD83D\uDCCA"},{href:"/analytics",label:"Analytics",icon:"\uD83D\uDCC8"},{href:"/inventory",label:"Inventory",icon:"\uD83D\uDCE6"},{href:"/crm",label:"CRM",icon:"\uD83D\uDC65"},{href:"/orders",label:r("navOrders"),icon:"\uD83D\uDED2"},{href:"/settings",label:r("navSettings"),icon:"⚙️"},{href:"/errors",label:r("navErrors"),icon:"⚠️"},{href:"/review",label:r("navReview"),icon:"✅"},{href:"/ops",label:r("navOps"),icon:"\uD83D\uDD27"},{href:"/mappings",label:r("navMappings"),icon:"\uD83D\uDD17"},{href:"/admin/users",label:r("navAdmin"),icon:"\uD83D\uDC64"}];return(0,s.jsxs)("header",{className:"nav",children:[(0,s.jsx)("div",{style:{fontWeight:800,fontSize:20,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"\uD83D\uDE80 AutoShip X"}),(0,s.jsxs)("div",{className:"nav-links",children:[c.map(e=>(0,s.jsxs)(n(),{href:e.href,style:{fontWeight:e.href===t?700:500,color:e.href===t?"var(--color-text)":"var(--color-text-muted)",background:e.href===t?"var(--color-elevated)":"transparent",display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)("span",{children:e.icon}),e.label]},e.href)),!a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{href:"/login",className:"btn btn-ghost",style:{fontWeight:"/login"===t?700:500,marginLeft:8},children:r("login")}),(0,s.jsx)(n(),{href:"/signup",className:"btn",style:{fontWeight:"/signup"===t?700:500},children:r("signup")})]}),(0,s.jsx)(o.Z,{})]})]})}},1297:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var s=r(2322),a=r(5632),n=r(34);function o(){let e=(0,a.useRouter)(),{t}=(0,n.$G)("common"),{locale:r,pathname:o,asPath:i,query:l}=e,d="en"===r?"ja":"en",c=t("en"===d?"langEnglish":"langJapanese"),p=t("en"===d?"langEnglishShort":"langJapaneseShort");return(0,s.jsx)("button",{className:"btn btn-ghost",style:{padding:"6px 10px",fontSize:13},onClick:()=>e.push({pathname:o,query:l},i,{locale:d}),"aria-label":t("switchLanguage",{lang:c}),children:p})}},5697:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(2322);function a(e){var t;let{status:r,labels:a}=e,n=(null==r?void 0:null===(t=r.toUpperCase)||void 0===t?void 0:t.call(r))||"",o="#cbd5e1",i="#0f172a",l=r;return["FULFILLED","PLACED"].includes(n)?(o="#dcfce7",i="#166534",l=a.success):["FAILED","SKIPPED"].includes(n)?(o="#fee2e2",i="#991b1b",l=a.error):["QUEUED","PROCESSING","UNPROCESSED"].includes(n)?(o="#e0f2fe",i="#075985",l=a.pending):["MANUAL_REVIEW"].includes(n)&&(o="#e2e8f0",i="#0f172a",l=a.manual),(0,s.jsx)("span",{style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:o,color:i},children:l})}},1522:function(e,t,r){"use strict";var s=r(418),a=r(3542);let n=s.Z.create(),o=n.defaults.adapter;if(n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t))}return e}),"1"===a.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),n.defaults.adapter=async r=>{let s=(r.url||"").replace(/^https?:\/\/[^/]+/,""),a=(r.method||"get").toLowerCase(),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:r})};if("/api/auth/login"===s&&"post"===a||"/api/auth/signup"===s&&"post"===a)return n({token:"mock-token"});if("/api/shops"===s&&"get"===a)return n(e.shops);if("/api/credentials/shopee"===s&&"get"===a)return n(e.shopeeCred);if("/api/credentials/shopee"===s&&"post"===a)return e.shopeeCred={...r.data},n({success:!0});if("/api/credentials/amazon"===s&&"get"===a)return n(e.amazonCred);if("/api/credentials/amazon"===s&&"post"===a)return e.amazonCred={...r.data},n({success:!0});if("/api/settings"===s&&"get"===a)return n(e.settings);if("/api/settings"===s&&"post"===a)return e.settings={...r.data,shopSelections:e.settings.shopSelections},n({success:!0});if("/api/orders/recent"===s&&"get"===a)return n(e.orders);if("/api/orders/errors"===s&&"get"===a)return n(e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt}))));if(s.startsWith("/api/orders/")&&s.endsWith("/retry")&&"post"===a||s.startsWith("/api/orders/retry/")&&"post"===a||s.startsWith("/api/orders/manual/")&&"post"===a||"/api/orders/poll-now"===s&&"post"===a)return n({success:!0});if("/api/orders/errors/export"===s&&"get"===a)return n("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===s&&"get"===a)return n("orderNumber,status\nSP-002,Processed",200);if(s.startsWith("/api/orders/")&&"get"===a){let t=s.split("/").pop();return n(e.orders.find(e=>e.id===t)||e.orders[0])}return"/api/ops/queue"===s&&"get"===a?n({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===s&&"post"===a?n({success:!0}):"/api/ops/status"===s&&"get"===a?n({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}}):"/api/mappings"===s&&"get"===a?n(e.mappings):"/api/mappings"===s&&"post"===a?(e.mappings.push({id:"map-".concat(Date.now()),...r.data||{}}),n({success:!0})):"/api/mappings/import"===s&&"post"===a||"/api/products/shopee"===s&&"post"===a||"/api/products/amazon"===s&&"post"===a?n({success:!0}):"/api/products/shopee"===s&&"get"===a?n(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===s&&"get"===a?n(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===s&&"get"===a?n(e.adminUsers):s.includes("/api/admin/users/")&&s.endsWith("/toggle")&&"post"===a||s.includes("/api/admin/users/")&&s.endsWith("/reset-password")&&"post"===a?n({success:!0}):"/api/admin/audit"===s&&"get"===a?n(e.audit):o&&"function"==typeof o?o(r):n({},404)}}n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),t.Z=n},5153:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSG:function(){return d},default:function(){return c}});var s=r(2322),a=r(2784),n=r(34),o=r(2684),i=r(1522),l=r(5697),d=!0;function c(){var e,t,r,d,c;let{t:u}=(0,n.$G)("common"),[h,m]=(0,a.useState)(null),[g,f]=(0,a.useState)(null),[v,x]=(0,a.useState)(""),[S,b]=(0,a.useState)(""),[D,y]=(0,a.useState)(!1),[j,E]=(0,a.useState)(!1),[A,k]=(0,a.useState)(null),z=async()=>{y(!0);try{let[e,t,r]=await Promise.allSettled([i.Z.get("/api/ops/queue"),i.Z.get("/api/ops/status"),i.Z.get("/health")]);"fulfilled"===e.status&&m(e.value.data),"fulfilled"===t.status&&f(t.value.data),"fulfilled"===r.status&&k(r.value.data)}catch(s){var e,t,r;b(null!==(r=null==s?void 0:null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)&&void 0!==r?r:u("genericError"))}finally{y(!1)}};(0,a.useEffect)(()=>{z()},[]);let I=async()=>{b(""),E(!0);try{await i.Z.post("/api/ops/amazon-test",{productUrl:v}),b(u("testScrapeQueued"))}catch(s){var e,t,r;b(null!==(r=null==s?void 0:null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)&&void 0!==r?r:u("genericError"))}finally{E(!1)}};return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)(o.Z,{activeHref:"/ops"}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h1",{children:u("ops")}),(0,s.jsx)("p",{children:u("opsDesc")}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[(0,s.jsx)(l.Z,{status:A?"FULFILLED":"FAILED",labels:{success:u("statusProcessed"),error:u("statusError"),pending:u("statusPending"),manual:u("ordersTableManual")}}),(0,s.jsx)("span",{style:{color:"#475569"},children:A?null!==(e=u("statusHealthy"))&&void 0!==e?e:"Healthy":u("genericError")})]})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{children:u("queueHealth")}),h?(0,s.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,s.jsx)(p,{label:u("waiting"),value:h.waiting}),(0,s.jsx)(p,{label:u("active"),value:h.active}),(0,s.jsx)(p,{label:u("failed"),value:h.failed}),(0,s.jsx)(p,{label:u("delayed"),value:h.delayed})]}):(0,s.jsx)("p",{children:D?u("loading"):u("genericError")})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{children:null!==(t=u("opsStatusSummary"))&&void 0!==t?t:"Recent activity"}),g?(0,s.jsxs)("ul",{style:{color:"#475569"},children:[(0,s.jsxs)("li",{children:[null!==(r=u("lastOrderLabel"))&&void 0!==r?r:"Last Shopee order",":"," ",g.lastOrder?new Date(g.lastOrder).toLocaleString():u("none")]}),(0,s.jsxs)("li",{children:[null!==(d=u("lastAmazonLabel"))&&void 0!==d?d:"Last Amazon action",":"," ",g.lastAmazon?"".concat(new Date(g.lastAmazon.createdAt).toLocaleString()," (").concat(g.lastAmazon.status,")"):u("none")]}),(0,s.jsxs)("li",{children:[null!==(c=u("lastErrorLabel"))&&void 0!==c?c:"Last error",":"," ",g.lastError?"".concat(new Date(g.lastError.createdAt).toLocaleString()," - ").concat(g.lastError.reason):u("none")]})]}):(0,s.jsx)("p",{children:D?u("loading"):u("genericError")})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{children:u("testScrape")}),(0,s.jsx)("input",{className:"input",placeholder:u("productUrl"),value:v,onChange:e=>x(e.target.value)}),(0,s.jsx)("button",{className:"button",onClick:I,disabled:!v||j,children:j?u("loading"):u("run")}),S&&(0,s.jsx)("p",{children:S})]})]})}function p(e){let{label:t,value:r}=e;return(0,s.jsxs)("div",{style:{background:"#e2e8f0",borderRadius:8,padding:"8px 12px",minWidth:80},children:[(0,s.jsx)("div",{style:{fontSize:12,color:"#475569"},children:t}),(0,s.jsx)("div",{style:{fontWeight:700},children:r})]})}}},function(e){e.O(0,[418,97,888,774,179],function(){return e(e.s=7940)}),_N_E=e.O()}]);