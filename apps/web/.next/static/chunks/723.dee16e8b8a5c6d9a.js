"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[723],{8272:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=a(2322),i=a(2784),r=a(34),n=a(5632),o=a(1522),l=a(8406);function d(){let{t:e}=(0,r.$G)("common"),t=(0,n.useRouter)(),[a,d]=(0,i.useState)(!1),[p,c]=(0,i.useState)(0),[u,h]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!0),[v,x]=(0,i.useState)(""),[b,f]=(0,i.useState)([]),[S,y]=(0,i.useState)({partnerId:"",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"",shopName:""}),[j,N]=(0,i.useState)({email:"",password:""}),[I,T]=(0,i.useState)({includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:7,minExpectedProfit:0,shopIds:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,overrides:[]}),k=(0,i.useMemo)(()=>[{title:e("onboardingModalStep1Title"),desc:e("onboardingModalStep1Desc"),type:"welcome"},{title:e("onboardingModalStep2Title"),desc:e("onboardingModalStep2Desc"),type:"shopee"},{title:e("onboardingModalStep3Title"),desc:e("onboardingModalStep3Desc"),type:"amazon"},{title:e("onboardingModalStep4Title"),desc:e("onboardingModalStep4Desc"),type:"settings"},{title:e("onboardingModalStep5Title"),desc:e("onboardingModalStep5Desc"),type:"done"}],[e]);(0,i.useEffect)(()=>{(async()=>{var a,s,i,r;if("undefined"==typeof globalThis||!globalThis.localStorage)return;let n=localStorage.getItem("token"),l="1"===localStorage.getItem("onboarding_dismissed"),p=t.pathname;if(!n||p.startsWith("/login")||p.startsWith("/signup")||l){g(!1),d(!1);return}try{let[e,t,s,i]=await Promise.allSettled([o.Z.get("/api/shops"),o.Z.get("/api/credentials/shopee"),o.Z.get("/api/credentials/amazon"),o.Z.get("/api/settings")]);if("fulfilled"===e.status){f(e.value.data);let t=e.value.data.map(e=>e.id);T(e=>({...e,shopIds:t}))}if("fulfilled"===t.status&&t.value.data&&y(e=>{var a,s,i,r;return{...e,partnerId:null!==(a=t.value.data.partnerId)&&void 0!==a?a:"",baseUrl:null!==(s=t.value.data.baseUrl)&&void 0!==s?s:e.baseUrl,shopId:null!==(i=t.value.data.shopId)&&void 0!==i?i:"",shopName:null!==(r=t.value.data.shopName)&&void 0!==r?r:""}}),"fulfilled"===s.status&&(null===(a=s.value.data)||void 0===a?void 0:a.email)&&N(e=>({...e,email:s.value.data.email})),"fulfilled"===i.status&&i.value.data){let e=i.value.data;T(t=>{var a,s,i,r,n,o;return{...t,includeAmazonPoints:e.includeAmazonPoints,includeDomesticShipping:e.includeDomesticShipping,domesticShippingCost:null!==(s=e.domesticShippingCost)&&void 0!==s?s:0,maxShippingDays:e.maxShippingDays,minExpectedProfit:e.minExpectedProfit,shopIds:null!==(i=null===(a=e.shopSelections)||void 0===a?void 0:a.filter(e=>e.isSelected).map(e=>e.shopId))&&void 0!==i?i:t.shopIds,isActive:e.isActive,isDryRun:null!==(r=e.isDryRun)&&void 0!==r&&r,reviewBandPercent:null!==(n=e.reviewBandPercent)&&void 0!==n?n:0,overrides:null!==(o=e.shopOverrides)&&void 0!==o?o:[]}})}d(!0)}catch(t){x(null!==(r=null==t?void 0:null===(i=t.response)||void 0===i?void 0:null===(s=i.data)||void 0===s?void 0:s.error)&&void 0!==r?r:e("genericError"))}finally{g(!1)}})()},[e,t.pathname]);let w=()=>{"undefined"!=typeof localStorage&&localStorage.setItem("onboarding_dismissed","1"),d(!1)},C=async()=>{if(!S.partnerId||!S.partnerKey||!S.accessToken||!S.shopId)return x(e("fieldRequired")),!1;h(!0),x("");try{return await o.Z.post("/api/credentials/shopee",S),(0,l.M)(e("shopeeSaveSuccess")),!0}catch(r){var t,a,s;let i=null!==(s=null==r?void 0:null===(a=r.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)&&void 0!==s?s:e("shopeeSaveError");return x(i),(0,l.M)(i,"error"),!1}finally{h(!1)}},P=async()=>{if(!j.email||!j.password)return x(e("fieldRequired")),!1;h(!0),x("");try{return await o.Z.post("/api/credentials/amazon",j),N(e=>({...e,password:""})),(0,l.M)(e("credentialsSaveSuccess")),!0}catch(r){var t,a,s;let i=null!==(s=null==r?void 0:null===(a=r.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)&&void 0!==s?s:e("credentialsSaveError");return x(i),(0,l.M)(i,"error"),!1}finally{h(!1)}},z=async()=>{if(!I.shopIds.length&&b.length)return x(e("fieldRequired")),!1;h(!0),x("");try{return await o.Z.post("/api/settings",I),(0,l.M)(e("settingsSaveSuccess")),!0}catch(r){var t,a,s;let i=null!==(s=null==r?void 0:null===(a=r.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)&&void 0!==s?s:e("settingsSaveError");return x(i),(0,l.M)(i,"error"),!1}finally{h(!1)}},A=async()=>{x("");let e=k[p].type;if("welcome"===e||"done"===e){if(p===k.length-1){w();return}c(e=>e+1);return}if("shopee"===e){await C()&&c(e=>e+1);return}if("amazon"===e){await P()&&c(e=>e+1);return}"settings"===e&&await z()&&w()};if(!a||m)return null;let D=k[p];return(0,s.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(15,23,42,0.45)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",justifyContent:"center",padding:20,zIndex:1e4},role:"dialog","aria-modal":"true","aria-labelledby":"onboarding-modal-title",children:(0,s.jsxs)("div",{className:"card",style:{maxWidth:720,width:"100%",padding:28,position:"relative",background:"#fff",boxShadow:"0 25px 60px rgba(15, 23, 42, 0.25)"},children:[(0,s.jsx)("button",{onClick:w,"aria-label":e("close"),style:{position:"absolute",top:12,right:12,border:"none",background:"transparent",fontSize:20,cursor:"pointer",color:"#475569"},children:"\xd7"}),(0,s.jsx)("p",{style:{margin:0,color:"#0f172a",fontWeight:700,letterSpacing:.5},children:e("onboardingModalTitle")}),(0,s.jsxs)("div",{style:{marginTop:12},children:[(0,s.jsx)("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:k.map((e,t)=>(0,s.jsxs)("span",{className:"pill",style:{background:t===p?"#2563eb":"#e2e8f0",color:t===p?"#fff":"#0f172a"},children:[t+1," / ",k.length]},t))}),(0,s.jsx)("h3",{id:"onboarding-modal-title",style:{margin:"8px 0",color:"#0f172a"},children:D.title}),(0,s.jsx)("p",{style:{color:"#475569",lineHeight:1.5},children:D.desc}),v&&(0,s.jsx)("p",{style:{color:"#ef4444"},children:v}),"welcome"===D.type&&(0,s.jsx)("div",{style:{color:"#475569",lineHeight:1.5},children:(0,s.jsx)("p",{children:e("onboardingModalWelcomeBlurb")})}),"shopee"===D.type&&(0,s.jsxs)("div",{className:"grid grid-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("partnerId")}),(0,s.jsx)("input",{className:"input",value:S.partnerId,onChange:e=>y({...S,partnerId:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("partnerKey")}),(0,s.jsx)("input",{className:"input",type:"password",value:S.partnerKey,onChange:e=>y({...S,partnerKey:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("accessToken")}),(0,s.jsx)("input",{className:"input",type:"password",value:S.accessToken,onChange:e=>y({...S,accessToken:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("baseUrl")}),(0,s.jsx)("input",{className:"input",value:S.baseUrl,onChange:e=>y({...S,baseUrl:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("shopId")}),(0,s.jsx)("input",{className:"input",value:S.shopId,onChange:e=>y({...S,shopId:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("shopName")}),(0,s.jsx)("input",{className:"input",value:S.shopName,onChange:e=>y({...S,shopName:e.currentTarget.value})})]})]}),"amazon"===D.type&&(0,s.jsxs)("div",{className:"grid grid-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("amazonEmail")}),(0,s.jsx)("input",{className:"input",type:"email",value:j.email,onChange:e=>N({...j,email:e.currentTarget.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("amazonPassword")}),(0,s.jsx)("input",{className:"input",type:"password",value:j.password,onChange:e=>N({...j,password:e.currentTarget.value})})]})]}),"settings"===D.type&&(0,s.jsxs)("div",{className:"grid grid-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("maxShippingDays")}),(0,s.jsx)("input",{className:"input",type:"number",value:I.maxShippingDays,onChange:e=>T({...I,maxShippingDays:Number(e.currentTarget.value)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("minProfit")}),(0,s.jsx)("input",{className:"input",type:"number",value:I.minExpectedProfit,onChange:e=>T({...I,minExpectedProfit:Number(e.currentTarget.value)})})]}),(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("input",{type:"checkbox",checked:I.includeAmazonPoints,onChange:e=>T({...I,includeAmazonPoints:e.currentTarget.checked})}),e("includePointsLabel")]}),(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("input",{type:"checkbox",checked:I.includeDomesticShipping,onChange:e=>T({...I,includeDomesticShipping:e.currentTarget.checked})}),e("includeDomesticLabel")]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:e("domesticShippingCost")}),(0,s.jsx)("input",{className:"input",type:"number",value:I.domesticShippingCost,onChange:e=>T({...I,domesticShippingCost:Number(e.currentTarget.value)})})]}),(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("input",{type:"checkbox",checked:I.isActive,onChange:e=>T({...I,isActive:e.currentTarget.checked})}),e("autoShipping")]})]}),"done"===D.type&&(0,s.jsx)("div",{style:{color:"#475569",lineHeight:1.5},children:(0,s.jsx)("p",{children:e("onboardingModalCompleteDesc")})}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap"},children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>c(e=>Math.max(0,e-1)),disabled:0===p||u,children:e("prev")}),(0,s.jsx)("button",{className:"btn",onClick:A,disabled:u,children:u?e("loading"):p===k.length-1?e("finish"):e("next")}),(0,s.jsx)("button",{className:"btn btn-ghost",onClick:w,children:e("skip")})]})]})]})})}},1522:function(e,t,a){var s=a(418),i=a(3542);let r=s.Z.create(),n=r.defaults.adapter;if(r.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t))}return e}),"1"===i.env.NEXT_PUBLIC_MOCK_API){let e={shops:[{id:"shop1",name:"Tokyo Shop"},{id:"shop2",name:"Osaka Shop"}],shopeeCred:{partnerId:"demo-partner-id",partnerKey:"",accessToken:"",baseUrl:"https://partner.shopeemobile.com",shopId:"shop1",shopName:"Tokyo Shop"},amazonCred:{email:"demo@example.com"},settings:{includeAmazonPoints:!1,includeDomesticShipping:!1,domesticShippingCost:0,maxShippingDays:5,minExpectedProfit:0,shopSelections:[],isActive:!0,isDryRun:!1,reviewBandPercent:0,shopOverrides:[]},orders:[],mappings:[{id:"map1",priority:1,isActive:!0,shopeeProduct:{id:"sp1",title:"Shopee Widget",sku:"SKU-1",shopeeItemId:"111",shop:{name:"Tokyo Shop"}},amazonProduct:{id:"ap1",title:"Amazon Widget",asin:"B00TEST",url:"https://amazon.co.jp/dp/B00TEST"}}],audit:[{id:"a1",action:"login",detail:{ip:"127.0.0.1"},createdAt:new Date().toISOString(),user:{email:"admin@example.com"}}],adminUsers:[{id:"u1",email:"admin@example.com",role:"admin",isActive:!0,createdAt:new Date().toISOString()},{id:"u2",email:"user@example.com",role:"user",isActive:!1,createdAt:new Date().toISOString()}]},t=new Date().toISOString();e.orders=[{id:"ord1",orderNumber:"SP-001",shop:e.shops[0],status:"pending",totalAmount:5e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST",amazonOrder:null,errorItems:[{id:"err1",reason:"Out of stock",createdAt:t,amazonProductUrl:"https://amazon.co.jp/dp/B00TEST",productName:"Widget",shopeeOrderId:"SP-001"}]},{id:"ord2",orderNumber:"SP-002",shop:e.shops[1],status:"processed",totalAmount:12e3,currency:"JPY",productUrl:"https://amazon.co.jp/dp/B00TEST2",amazonOrder:{amazonOrderId:"AMZ-123",status:"Shipped",createdAt:t},errorItems:[]}],e.settings.shopSelections=e.shops.map(e=>({shopId:e.id,isSelected:!0})),r.defaults.adapter=async a=>{let s=(a.url||"").replace(/^https?:\/\/[^/]+/,""),i=(a.method||"get").toLowerCase(),r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return Promise.resolve({data:e,status:t,statusText:"OK",headers:{},config:a})};if("/api/auth/login"===s&&"post"===i||"/api/auth/signup"===s&&"post"===i)return r({token:"mock-token"});if("/api/shops"===s&&"get"===i)return r(e.shops);if("/api/credentials/shopee"===s&&"get"===i)return r(e.shopeeCred);if("/api/credentials/shopee"===s&&"post"===i)return e.shopeeCred={...a.data},r({success:!0});if("/api/credentials/amazon"===s&&"get"===i)return r(e.amazonCred);if("/api/credentials/amazon"===s&&"post"===i)return e.amazonCred={...a.data},r({success:!0});if("/api/settings"===s&&"get"===i)return r(e.settings);if("/api/settings"===s&&"post"===i)return e.settings={...a.data,shopSelections:e.settings.shopSelections},r({success:!0});if("/api/orders/recent"===s&&"get"===i)return r(e.orders);if("/api/orders/errors"===s&&"get"===i)return r(e.orders.flatMap(e=>e.errorItems.map(t=>({...t,shopeeOrderId:e.orderNumber,productName:t.productName||"Product",createdAt:t.createdAt}))));if(s.startsWith("/api/orders/")&&s.endsWith("/retry")&&"post"===i||s.startsWith("/api/orders/retry/")&&"post"===i||s.startsWith("/api/orders/manual/")&&"post"===i||"/api/orders/poll-now"===s&&"post"===i)return r({success:!0});if("/api/orders/errors/export"===s&&"get"===i)return r("product,reason\nWidget,Out of stock",200);if("/api/orders/processed/export"===s&&"get"===i)return r("orderNumber,status\nSP-002,Processed",200);if(s.startsWith("/api/orders/")&&"get"===i){let t=s.split("/").pop();return r(e.orders.find(e=>e.id===t)||e.orders[0])}return"/api/ops/queue"===s&&"get"===i?r({waiting:0,active:0,failed:0,delayed:0}):"/api/ops/amazon-test"===s&&"post"===i?r({success:!0}):"/api/ops/status"===s&&"get"===i?r({lastOrder:t,lastAmazon:{createdAt:t,status:"ok"},lastError:{createdAt:t,reason:"Mock error"}}):"/api/mappings"===s&&"get"===i?r(e.mappings):"/api/mappings"===s&&"post"===i?(e.mappings.push({id:"map-".concat(Date.now()),...a.data||{}}),r({success:!0})):"/api/mappings/import"===s&&"post"===i||"/api/products/shopee"===s&&"post"===i||"/api/products/amazon"===s&&"post"===i?r({success:!0}):"/api/products/shopee"===s&&"get"===i?r(e.mappings.map(e=>e.shopeeProduct)):"/api/products/amazon"===s&&"get"===i?r(e.mappings.map(e=>e.amazonProduct)):"/api/admin/users"===s&&"get"===i?r(e.adminUsers):s.includes("/api/admin/users/")&&s.endsWith("/toggle")&&"post"===i||s.includes("/api/admin/users/")&&s.endsWith("/reset-password")&&"post"===i?r({success:!0}):"/api/admin/audit"===s&&"get"===i?r(e.audit):n&&"function"==typeof n?n(a):r({},404)}}r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),t.Z=r}}]);